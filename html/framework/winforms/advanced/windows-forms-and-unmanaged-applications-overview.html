<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#1054;&#1073;&#1097;&#1080;&#1077; &#1089;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1103; &#1086; Windows Forms &#1080; &#1085;&#1077;&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;&#1099;&#1093; &#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1103;&#1093; | &#1053;&#1077;&#1086;&#1092;&#1080;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1072;&#1103; &#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1094;&#1080;&#1103; .NET </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#1054;&#1073;&#1097;&#1080;&#1077; &#1089;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1103; &#1086; Windows Forms &#1080; &#1085;&#1077;&#1091;&#1087;&#1088;&#1072;&#1074;&#1083;&#1103;&#1077;&#1084;&#1099;&#1093; &#1087;&#1088;&#1080;&#1083;&#1086;&#1078;&#1077;&#1085;&#1080;&#1103;&#1093; | &#1053;&#1077;&#1086;&#1092;&#1080;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1072;&#1103; &#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1094;&#1080;&#1103; .NET ">
    <meta name="generator" content="docfx 2.40.12.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="windows-forms-and-unmanaged-applications-overview">Общие сведения о Windows Forms и неуправляемых приложениях</h1>

<p>Приложения и элементы управления Windows Forms могут взаимодействовать с неуправляемыми приложениями, но с некоторыми оговорками. В следующих разделах описываются сценарии и конфигурации, которые поддерживаются и не поддерживаются элементами управления и приложениями Windows Forms.</p>
<h2 id="windows-forms-controls-and-activex-applications">Элементы управления Windows Forms и приложения ActiveX</h2>
<p>За исключением Microsoft Internet Explorer и Microsoft Foundation Classes (MFC), элементы управления Windows Forms не поддерживаются в приложениях, предназначенных для размещения элементов управления ActiveX. Другие приложения и средства разработки, способные размещать элементы управления ActiveX, включая контейнеры для тестирования ActiveX из версий Visual Studio, предшествующих Visual Studio .NET 2003, не поддерживают размещение элементов управления Windows Forms.</p>
<p>Эти ограничения также применимы к использованию элементов управления Windows Forms посредством COM-взаимодействия. Использование элемента управления Windows Forms с помощью вызываемой оболочки COM (CCW) поддерживается только в Internet Explorer. Подробнее о COM-взаимодействии см. в разделе</p>
<p><a href="../../../visual-basic/programming-guide/com-interop/index.md">COM Interop</a>.</p>
<p>В таблице ниже показаны доступные средства размещения ActiveX для элементов управления Windows Forms.</p>
<table>
<thead>
<tr>
<th>Версия Windows Forms</th>
<th>Поддержка</th>
</tr>
</thead>
<tbody>
<tr>
<td>.NET Framework 1.0</td>
<td>Internet Explorer 5.01 и более поздние версии</td>
</tr>
<tr>
<td>.NET Framework 1.1 и более поздние версии</td>
<td>Internet Explorer 5.01 и более поздние версии<br><br> Microsoft Foundation Classes (MFC) 7.0 и более поздние версии</td>
</tr>
</tbody>
</table>
<h2 id="hosting-windows-forms-components-as-activex-controls">Размещение компонентов Windows Forms в качестве элементов управления ActiveX</h2>
<p>В .NET Framework 1.1 поддержка была расширена для включения MFC 7.0 и более поздних версий. Эта поддержка включает в себя любой контейнер, полностью совместимый с MFC 7.0 или с более поздней версией контейнера элементов управления ActiveX.</p>
<p>Однако регистрация элементов управления Windows Forms как элементов управления ActiveX не поддерживается. Также не поддерживается вызов метода <code>com.ms.win32.Ole32.CoCreateInstance</code> для элементов управления Windows Forms. Поддерживается только управляемая активация элементов управления Windows Forms. После создания элемента управления Windows Forms его можно размещать в приложении MFC так же, как элемент управления ActiveX.</p>
<p>Чтобы использовать элементы управления Windows Forms в неуправляемом приложении, необходимо либо разместить среду CLR с помощью неуправляемых интерфейсов API размещения среды CLR, либо использовать возможности взаимодействия C++. Рекомендуемым решением является использование возможностей взаимодействия C++.</p>
<h2 id="windows-forms-in-com-client-applications">Windows Forms в клиентских приложениях COM</h2>
<p>При открытии формы Windows Forms из клиентского приложения COM, такого как приложение Visual Basic 6.0 или приложение MFC, форма может вести себя не так, как ожидается. Например, при нажатии клавиши TAB фокус не переходит от одного элемента управления к другому. При нажатии клавиши ВВОД, если фокус установлен на кнопке, событие кнопки <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.forms.control.click">Click</a> не возникает. Также может наблюдаться и другое неожиданное поведение при нажатии клавиш или действиях мышью.</p>
<p>Это происходит из-за того, что неуправляемое приложение не реализует поддержку цикла обработки сообщений, которая необходима для правильной работы формы Windows Forms. Цикл обработки сообщений, реализуемый в клиентском приложении COM, существенно отличается от цикла обработки сообщений Windows Forms.</p>
<p>Цикл обработки сообщений приложения является внутренним циклом программы, который получает сообщения из очереди сообщений потока, преобразует их и отправляет приложению для обработки. Архитектура цикла обработки сообщений для формы Windows Forms отличается от архитектуры, используемой в более ранних приложениях, таких как приложения Visual Basic 6.0 и приложения MFC. Сообщения окна, которые отправляются в цикл обработки сообщений, могут обрабатываться не так, как ожидает форма Windows Forms. Таким образом, может наблюдаться неожиданное поведение. Могут не работать некоторые сочетания клавиш и некоторые действия мыши, а также могут не возникать некоторые события.</p>
<h2 id="resolving-interoperability-issues">Устранение проблем взаимодействия</h2>
<p>Эти проблемы можно устранить путем отображения формы в цикле обработки сообщений .NET Framework , который создается с помощью метода <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.forms.application.run">Application.Run</a> .</p>
<p>Чтобы исправить работу формы Windows Forms из клиентского приложения COM, необходимо запустить его в цикле обработки сообщений Windows Forms. Для этого воспользуйтесь одним из перечисленных ниже подходов.</p>
<ul>
<li><p>Используйте метод <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.forms.form.showdialog">Form.ShowDialog</a> для отображения Windows Form. Дополнительные сведения см. в разделе <a href="com-interop-by-displaying-a-windows-form-shadow.html">Как Поддержка COM-взаимодействия путем отображения формы Windows Forms с помощью метода ShowDialog</a>.</p>
</li>
<li><p>Запускайте каждую форму Windows Forms в новом потоке. Дополнительные сведения см. в разделе <a href="how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.html">Как Поддержка COM-взаимодействия путем отображения каждой формы Windows Forms в отдельном потоке</a>.</p>
</li>
</ul>
<h2 id="see-also">См. также</h2>
<ul>
<li><a href="windows-forms-and-unmanaged-applications.html">Windows Forms и неуправляемые приложения</a></li>
<li><a href="../../../visual-basic/programming-guide/com-interop/index.md">COM-взаимодействие</a></li>
<li><a href="../../../visual-basic/programming-guide/com-interop/com-interoperability-in-net-framework-applications.md">COM-взаимодействие в приложениях .NET Framework</a></li>
<li><a href="https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2008/cxcz83xf(v=vs.90)">Примеры COM-взаимодействия</a></li>
<li><a href="../../tools/aximp-exe-windows-forms-activex-control-importer.md">Aximp.exe (программа импорта элементов ActiveX форм Windows)</a></li>
<li><a href="../../interop/exposing-dotnet-components-to-com.md">Предоставление COM-клиентам доступа к компонентам .NET Framework</a></li>
<li><a href="../../interop/packaging-an-assembly-for-com.md">Упаковка сборки для модели COM</a></li>
<li><a href="../../interop/registering-assemblies-with-com.md">Регистрация сборок в COM</a></li>
<li><a href="com-interop-by-displaying-a-windows-form-shadow.html">Практическое руководство. Обеспечение поддержки COM-взаимодействия путем отображения формы Windows Forms с помощью метода ShowDialog</a></li>
<li><a href="how-to-support-com-interop-by-displaying-each-windows-form-on-its-own-thread.html">Практическое руководство. Поддержка COM-взаимодействия путем отображения каждой формы Windows Forms в отдельном потоке</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span><a href="https://github.com/MSDN-WhiteKnight/dotnet-docs-ru">Неофициальная документация по .NET на русском языке</a>. Лицензия: <a href="https://github.com/MSDN-WhiteKnight/dotnet-docs-ru/blob/main/LICENSE">CC-BY 4.0</a>. Основано на <a href="https://docs.microsoft.com/ru-ru/dotnet/">документации по .NET с Microsoft Docs</a><br>Generated by <strong>DocFX</strong></span><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(65150713, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/65150713" style="position:absolute; left:-9999px;" alt=""></div></noscript>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
