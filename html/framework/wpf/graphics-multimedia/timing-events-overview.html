<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#1054;&#1073;&#1097;&#1080;&#1077; &#1089;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1103; &#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1099;&#1093; &#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1103;&#1093; | &#1053;&#1077;&#1086;&#1092;&#1080;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1072;&#1103; &#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1094;&#1080;&#1103; .NET </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="&#1054;&#1073;&#1097;&#1080;&#1077; &#1089;&#1074;&#1077;&#1076;&#1077;&#1085;&#1080;&#1103; &#1086; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1099;&#1093; &#1089;&#1086;&#1073;&#1099;&#1090;&#1080;&#1103;&#1093; | &#1053;&#1077;&#1086;&#1092;&#1080;&#1094;&#1080;&#1072;&#1083;&#1100;&#1085;&#1072;&#1103; &#1076;&#1086;&#1082;&#1091;&#1084;&#1077;&#1085;&#1090;&#1072;&#1094;&#1080;&#1103; .NET ">
    <meta name="generator" content="docfx 2.40.12.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="timing-events-overview">Общие сведения о временных событиях</h1>

<p>В этом разделе описываются способы использования пяти временных событий, доступных на <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline">Timeline</a> и <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> объектов.</p>
<h2 id="prerequisites">Предварительные требования</h2>
<p>Для понимания этого раздела вы должны знать, как создавать и использовать анимации. Чтобы приступить к работе с анимацией, см. в разделе <a href="animation-overview.html">Общие сведения об анимации</a>.</p>
<p>Существует несколько способов анимирования свойств в WPF:</p>
<ul>
<li><p><strong>Использование объектов раскадровки</strong> (разметки и кода): Можно использовать <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.storyboard">Storyboard</a> упорядочить анимации для одного или нескольких объектов и объектов. Например, см. в разделе <a href="how-to-animate-a-property-by-using-a-storyboard.html">анимация свойства с помощью раскадровки</a>.</p>
</li>
<li><p><strong>Использование локальных анимаций</strong> (только в коде): Можно применить <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.animationtimeline">AnimationTimeline</a> объекты непосредственно к анимируемым свойствам. Пример см. в разделе <a href="how-to-animate-a-property-without-using-a-storyboard.html">Анимация свойства без использования раскадровки</a>.</p>
</li>
<li><p><strong>Использование часов</strong> (только в коде): Кроме того, можно явно управлять созданием часов и самостоятельно распределять часы для анимации.  Например, см. в разделе <a href="how-to-animate-a-property-by-using-an-animationclock.html">Анимирование свойства с помощью AnimationClock</a>.</p>
</li>
</ul>
<p>Так как их можно использовать в разметке и коде, в примерах в этом обзоре используются <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.storyboard">Storyboard</a> объектов. Тем не менее описанные здесь идеи также применяются к другим методам анимирования свойств.</p>
<h3 id="what-is-a-clock">Что такое часы?</h3>
<p>Временная шкала сама по себе просто описывает сегмент времени. Он является временной шкалы <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> объект, который не работает: он обеспечивает связана со временем состояние времени выполнения для временной шкалы. В большинстве случаев, например при использовании раскадровок, часы для временной шкалы создаются автоматически. Вы также можете создать <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> явным образом с помощью <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.createclock">CreateClock</a> метод. Дополнительные сведения о <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> объектов, см. в разделе <a href="animation-and-timing-system-overview.html">анимации и общие сведения о характере системы</a>.</p>
<h2 id="why-use-events">Зачем использовать события?</h2>
<p>Все интерактивные временные операции являются асинхронными. Исключение составляет лишь поиск, который выравнивается по последнему такту. Точно определить, когда будут выполнены операции, невозможно. При наличии другого кода, который зависит от вашей операции, это может вызвать проблемы. Предположим, что вы хотите остановить временную шкалу, которая анимировала прямоугольник. После остановки временной шкалы вы изменяете цвет прямоугольника.</p>
<pre><code class="lang-csharp" name="events_procedural#NeedForEventsFragment">myStoryboard.Stop(myRectangle);

// This statement might execute
// before the storyboard has stopped.
myRectangle.Fill = Brushes.Blue;
</code></pre><div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>В предыдущем примере вторая строка кода может быть выполнена до того, как раскадровка будет остановлена. Это вызвано тем, что остановка является асинхронной операцией. При отправке команды на остановку временной шкалы или часов создается своего рода &quot;запрос на остановку&quot;. Этот запрос обрабатывается только на следующем такте системы управления временем.</p>
<p>Для выполнения команд после завершения временной шкалы используйте временные события. В следующем примере для изменения цвета прямоугольника после окончания воспроизведения раскадровки используется обработчик событий.</p>
<pre><code class="lang-csharp" name="events_procedural#RegisterForStoryboardCurrentStateInvalidatedEvent">// Register for the CurrentStateInvalidated timing event.
myStoryboard.CurrentStateInvalidated += new EventHandler(myStoryboard_CurrentStateInvalidated);
</code></pre><div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div><pre><code class="lang-csharp" name="events_procedural#StoryboardCurrentStateInvalidatedEvent2">// Change the rectangle's color after the storyboard stops.
void myStoryboard_CurrentStateInvalidated(object sender, EventArgs e)
{
    Clock myStoryboardClock = (Clock)sender;
    if (myStoryboardClock.CurrentState == ClockState.Stopped)
    {
        myRectangle.Fill = Brushes.Blue;
    }
}
</code></pre><div class="WARNING">
<h5>Warning</h5>
<p>It looks like the sample you are looking for does not exist.</p>
</div>
<p>Более полный пример, см. в разделе <a href="how-to-receive-notification-when-clock-state-changes.html">получения уведомлений при изменениях состояния часов</a>.</p>
<h2 id="public-events">Открытые события</h2>
<p><a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline">Timeline</a> И <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> классы предоставляют пять временных событий. В следующей таблице перечислены эти события и условия, которые их вызывают.</p>
<table>
<thead>
<tr>
<th>событие</th>
<th>Интерактивная операция, вызывающая событие</th>
<th>Другие условия</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Завершено</strong></td>
<td>Переход к заполнению</td>
<td>Часы останавливаются.</td>
</tr>
<tr>
<td><strong>CurrentGlobalSpeedInvalidated</strong></td>
<td>Пауза, возобновление, поиск, установка соотношения скорости, переход к заполнению</td>
<td>Часы запускаются в обратном направлении, ускоряются, запускаются в обычном направлении или останавливаются.</td>
</tr>
<tr>
<td><strong>CurrentStateInvalidated</strong></td>
<td>Начало, переход к заполнению, остановка</td>
<td>Часы запускаются, останавливаются, или выполняется заполнение.</td>
</tr>
<tr>
<td><strong>CurrentTimeInvalidated</strong></td>
<td>Начало, поиск, переход к заполнению, остановка</td>
<td>Часы работают.</td>
</tr>
<tr>
<td><strong>RemoveRequested</strong></td>
<td>Удалить</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="ticking-and-event-consolidation">Такты и объединение событий</h2>
<p>При анимации объектов в WPF, обработчик синхронизации управляет анимациями. Система управления временем отслеживает ход времени и вычисляет состояние каждой анимации. Она выполняет эти действия несколько раз в секунду. Такие вычислительные проходы называются &quot;тактами&quot;.</p>
<p>Хотя такты меняются часто, между ними может возникать множество событий. Например, временная шкала может быть остановлена, запущена и снова остановлена, в этом случае ее состояние будет изменено три раза. Теоретически событие может вызываться несколько раз в одном такте. Однако система управления временем объединяет события, чтобы каждое событие могло происходить не более одного раза за такт.</p>
<h2 id="registering-for-events">Регистрация в событиях</h2>
<p>Существует два способа регистрации временных событий: их можно зарегистрировать на временной шкале и на часах, созданных на основе временной шкалы. Регистрация события непосредственно на часах достаточно проста, но ее можно выполнить только в коде. Зарегистрировать события на временной шкале можно как в коде, так и в разметке. В следующем разделе описано, как зарегистрировать события часов на временной шкале.</p>
<p><a name="registeringforclockeventswithatimeline"></a></p>
<h2 id="registering-for-clock-events-with-a-timeline">Регистрация событий часов на временной шкале</h2>
<p>Несмотря на то что временной шкалы <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.completed">Completed</a>, <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.currentglobalspeedinvalidated">CurrentGlobalSpeedInvalidated</a>, <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.currentstateinvalidated">CurrentStateInvalidated</a>, <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.currenttimeinvalidated">CurrentTimeInvalidated</a>, и <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.removerequested">RemoveRequested</a> события могут быть связаны с временной шкалой, регистрация для этих событий фактически связывает обработчик событий с <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> созданным для временной шкалы.</p>
<p>При регистрации для <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.timeline.completed">Completed</a> события на временной шкале, например, фактически дается система для регистрации <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock.completed">Completed</a> событий всех часов, которая создается для временной шкалы. В коде, необходимо зарегистрировать для этого события перед <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> создается для этой шкалы времени; в противном случае вы не получите уведомление. Это происходит автоматически в XAML; средство синтаксического анализа автоматически регистрирует событие до <a class="xref" href="https://docs.microsoft.com/dotnet/api/system.windows.media.animation.clock">Clock</a> создается.</p>
<h2 id="see-also">См. также</h2>
<ul>
<li><a href="animation-and-timing-system-overview.html">Общие сведения об анимации и системе управления временем</a></li>
<li><a href="animation-overview.html">Общие сведения об эффектах анимации</a></li>
<li><a href="timing-behaviors-overview.html">Общие сведения о характере поведения во времени</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span><a href="https://github.com/MSDN-WhiteKnight/dotnet-docs-ru">Неофициальная документация по .NET на русском языке</a>. Лицензия: <a href="https://github.com/MSDN-WhiteKnight/dotnet-docs-ru/blob/main/LICENSE">CC-BY 4.0</a>. Основано на <a href="https://docs.microsoft.com/ru-ru/dotnet/">документации по .NET с Microsoft Docs</a><br>Generated by <strong>DocFX</strong></span><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");ym(65150713, "init", {clickmap:true,trackLinks:true,accurateTrackBounce:true});</script><noscript><div><img src="https://mc.yandex.ru/watch/65150713" style="position:absolute; left:-9999px;" alt=""></div></noscript>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
