---
description: Дополнительные сведения см. в разделе Пошаговое руководство. использование только хранимых процедур (C#)
title: Пошаговое руководство. Применение только хранимых процедур (C#)
ms.date: 03/30/2017
ms.assetid: ecde4bf2-fa4d-4252-b5e4-96a46b9e097d
ms.openlocfilehash: 89cb6da9ec4e8d144726b6e3575a32c04d6aeec0
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99791781"
---
# <a name="walkthrough-using-only-stored-procedures-c"></a>Пошаговое руководство. Применение только хранимых процедур (C#)

В данном пошаговом руководстве представлен основной полный сценарий [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] для получения доступа к данным, выполняя только хранимые процедуры. Этот метод часто используется администраторами баз данных для ограничения способов получения доступа к хранилищам данных.

> [!NOTE]
> Хранимые процедуры можно также использовать в приложениях [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] для переопределения поведения по умолчанию, особенно для процессов `Create`, `Update` и `Delete`. Дополнительные сведения см. в разделе [Настройка операций вставки, обновления и удаления](customizing-insert-update-and-delete-operations.md).

Для целей данного пошагового руководства будут использованы два метода, которые были сопоставлены с хранимыми процедурами в образце базы данных Northwind: CustOrdersDetail и CustOrderHist. Сопоставление осуществляется при запуске программы командной строки SQLMetal для создания файла C#. Дополнительные сведения см. в разделе "Предварительные требования" далее в этом руководстве.

Это пошаговое руководство не полагается на реляционный конструктор объектов. Разработчики, использующие Visual Studio, также могут использовать конструктор O/R для реализации функциональных возможностей хранимых процедур. См. раздел [LINQ to SQL Tools in Visual Studio](/visualstudio/data-tools/linq-to-sql-tools-in-visual-studio2).

[!INCLUDE[note_settings_general](../../../../../../includes/note-settings-general-md.md)]

Это пошаговое руководство было написано с использованием параметров разработки Visual C#.

## <a name="prerequisites"></a>Предварительные требования

Необходимо выполнить следующие требования.

- Для хранения файлов используется выделенная папка ("c:\linqtest7"). Прежде чем приступить к выполнению задач, создайте такую папку.

- Наличие учебной базы данных Northwind.

     Если база данных не установлена на компьютере разработчика, загрузите ее с веб-узла Центра загрузки Майкрософт. Инструкции см. в разделе [Загрузка образцов баз данных](downloading-sample-databases.md). После загрузки базы данных скопируйте файл northwnd.mdf в папку c:\linqtest7.

- Наличие файла кода C#, созданного из базы данных Northwind.

     Данное пошаговое руководство было написано с использованием средства SqlMetal со следующей командной строкой:

     **sqlmetal /code:"c:\linqtest7\northwind.cs" /language:csharp "c:\linqtest7\northwnd.mdf" /sprocs /functions /pluralize**

     Дополнительные сведения см. в разделе [SQLMetal.exe (средство создания кода)](../../../../tools/sqlmetal-exe-code-generation-tool.md).

## <a name="overview"></a>Обзор

Данное пошаговое руководство состоит из шести основных задач.

- Настройка [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] решения в Visual Studio.

- Добавление сборки System.Data.Linq в проект.

- Добавление файла кода базы данных в проект.

- Создание подключения к базе данных.

- Настройка пользовательского интерфейса.

- Запуск и тестирование приложения.

## <a name="creating-a-linq-to-sql-solution"></a>Создание решения LINQ to SQL

В этой первой задаче вы создадите решение Visual Studio, содержащее необходимые ссылки для сборки и запуска [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] проекта.

### <a name="to-create-a-linq-to-sql-solution"></a>Создание решения LINQ to SQL

1. В меню **файл** Visual Studio наведите указатель на пункт **создать** и выберите пункт **проект**.

2. В области **типы проектов** диалогового окна **Новый проект** щелкните **Visual C#**.

3. Выберите **Приложение Windows Forms** в области **Шаблоны**.

4. В поле **имя** введите **спроконляпп**.

5. В поле **Расположение** проверьте, где вы хотите сохранить файлы проекта.

6. Нажмите кнопку **OK**.

     Откроется конструктор Windows Forms.

## <a name="adding-the-linq-to-sql-assembly-reference"></a>Добавление ссылки на сборку LINQ to SQL

Сборка [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] не включается в стандартный шаблон приложения Windows Forms. Сборку необходимо добавить самостоятельно, выполнив приведенные ниже действия.

### <a name="to-add-systemdatalinqdll"></a>Добавление сборки System.Data.Linq.dll

1. В **Обозреватель решений** щелкните правой кнопкой мыши элемент **ссылки** и выберите команду **Добавить ссылку**.

2. В диалоговом окне **Добавление ссылки** щелкните **.NET**, выберите сборку System. Data. LINQ и нажмите кнопку **ОК**.

     Сборка будет добавлена в проект.

## <a name="adding-the-northwind-code-file-to-the-project"></a>Добавление файла кода Northwind в проект

При выполнении действий этого шага предполагается, что для создания файла кода из учебной базы данных Northwind использовалась программа SQLMetal. Дополнительные сведения см. в разделе "Предварительные требования" ранее в этом руководстве.

### <a name="to-add-the-northwind-code-file-to-the-project"></a>Добавление файла кода northwind в проект

1. В меню **Проект** выберите пункт **Добавить существующий элемент**.

2. В диалоговом окне **Добавление существующего элемента** перейдите в c:\linqtest7\northwind.cs и нажмите кнопку **Добавить**.

     Файл northwind.cs будет добавлен в проект.

## <a name="creating-a-database-connection"></a>Создание подключения к базе данных

На этом этапе определяется подключение к учебной базе данных Northwind. В качестве пути используется "c:\linqtest7\northwnd.mdf".

### <a name="to-create-the-database-connection"></a>Создание подключения к базе данных

1. В **Обозреватель решений** щелкните правой кнопкой мыши **Form1.CS** и выберите пункт **Просмотреть код**.

2. Введите следующий код в класс `Form1`:

     [!code-csharp[DLinqWalk4CS#1](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk4CS/cs/Form1.cs#1)]

## <a name="setting-up-the-user-interface"></a>Настройка пользовательского интерфейса

В этой задаче настраивается интерфейс, с помощью которого пользователи могут выполнять хранимые процедуры для получения доступа к данным в базе данных. В приложении, разрабатываемом с помощью настоящего пошагового руководства, пользователи могут получать доступ к данным в базе данных только с помощью хранимых процедур, внедренных в приложение.

### <a name="to-set-up-the-user-interface"></a>Настройка пользовательского интерфейса

1. Вернитесь к конструктор Windows Forms (**Form1. cs [Design]**).

2. В меню **Вид** выберите пункт **Область элементов**.

     Откроется панель элементов.

    > [!NOTE]
    > Щелкните кнопку **Автоскрытие** , чтобы открыть панель элементов во время выполнения оставшихся действий в этом разделе.

3. Перетащите две кнопки, два текстовых поля и две метки с панели элементов на **форму Form1**.

     Расположите элементы управления в соответствии с показанным здесь рисунком. Разверните **форму Form1** , чтобы элементы управления были легко размещены.

4. Щелкните правой кнопкой мыши элемент **Label1** и выберите пункт **свойства**.

5. Измените свойство **Text** с помощью **Label1** , чтобы **ввести OrderID:**.

6. Таким же образом для **ярлык2** измените свойство **Text** с **ярлык2** на **Ввод CustomerID:**.

7. Аналогичным образом измените свойство **Text** для **Button1** на **Order Details**.

8. Измените свойство **Text** для свойства **Button2** на " **журнал заказов**".

     Расширьте элементы управления "Кнопка", чтобы отображался весь текст.

### <a name="to-handle-button-clicks"></a>Обработка нажатий кнопки

1. Дважды щелкните элемент **сведения о заказе** в **Form1** , чтобы открыть обработчик событий button1 в редакторе кода.

2. Введите в обработчик кнопки `button1` следующий код:

     [!code-csharp[DLinqWalk4CS#2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk4CS/cs/Form1.cs#2)]

3. Теперь дважды щелкните элемент " **Button2** " на **Form1** , чтобы открыть `button2` обработчик.

4. Введите в обработчик кнопки `button2` следующий код:

     [!code-csharp[DLinqWalk4CS#3](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqWalk4CS/cs/Form1.cs#3)]

## <a name="testing-the-application"></a>Тестирование приложения

Теперь необходимо протестировать приложение. Обратите внимание, что все обращения к хранилищу данных ограничены теми действиями, которые могут выполняться двумя хранимыми процедурами. Эти действия заключаются в возвращении продуктов, включенных в заказ с введенным кодом, или истории продуктов, заказанных клиентом с введенным кодом.

### <a name="to-test-the-application"></a>Тестирование приложения

1. Нажмите клавишу F5, чтобы начать отладку.

     Откроется форма "Form1".

2. В поле **Enter OrderID (введите** код заказа) введите `10249` , а затем щелкните **Order Details (подробности заказа**).

     В окне сообщения будет отображен список продуктов, включенных в заказ 10249.

     Нажмите кнопку **OК** , чтобы закрыть окно сообщения.

3. В поле **введите CustomerID** введите `ALFKI` , а затем щелкните **Журнал заказа**.

     Откроется окно сообщения, в котором отображается история заказа для клиента ALFKI.

     Нажмите кнопку **OК** , чтобы закрыть окно сообщения.

4. В поле **Enter OrderID (введите** код заказа) введите `123` , а затем щелкните **Order Details (подробности заказа**).

     Откроется окно сообщения, в котором отображается текст "Нет результатов".

     Нажмите кнопку **OК** , чтобы закрыть окно сообщения.

5. В меню **Отладка** выберите команду **прерывать отладку**.

     Сеанс отладки закрывается.

6. Если вы завершили эксперименты, можно нажать кнопку **Закрыть проект** в меню **файл** и сохранить проект при появлении соответствующего запроса.

## <a name="next-steps"></a>Следующие шаги

Этот проект можно улучшить, выполнив некоторые изменения. Например, можно создать поле со списком доступных хранимых процедур и разрешить пользователю выбирать процедуру для выполнения. Можно также записывать выходные данных отчетов в текстовый файл.

## <a name="see-also"></a>См. также

- [Обучение с использованием пошаговых руководств](learning-by-walkthroughs.md)
- [Хранимые процедуры](stored-procedures.md)
