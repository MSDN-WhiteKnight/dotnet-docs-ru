---
description: Подробные сведения о поддержке приложений для Microsoft Store и среды выполнения Windows в .NET Framework
title: Поддержка приложений для Microsoft Store и среды выполнения Windows в .NET Framework
ms.date: 03/30/2017
helpviewer_keywords:
- Windows Store apps, .NET Framework support for
- Windows Runtime, .NET Framework support for
- .NET for Windows Store apps
- .NET Framework, and Windows Store apps
- .NET Framework, and Windows Runtime
ms.assetid: 6fa7d044-ae12-4c54-b8ee-50915607a565
ms.openlocfilehash: 851deb30420eb19c4fe2037bebe2cf8f84743c49
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "102402263"
---
# <a name="net-framework-support-for-microsoft-store-apps-and-windows-runtime"></a>Поддержка приложений для Microsoft Store и среды выполнения Windows в .NET Framework

Платформа .NET Framework версии 4.5 поддерживает несколько сценариев разработки программного обеспечения для среды выполнения Windows. Эти способы можно разделить на три категории.

- Разработка приложений для Магазина Windows 8.x с элементами управления XAML, которая описана в статье [Схема создания приложений для среды выполнения Windows на C# или Visual Basic](/previous-versions/windows/apps/br229583(v=win.10)), в [практических руководствах по XAML](/previous-versions/windows/apps/br229566(v=win.10)) и в [обзоре приложений .NET для Магазина Windows](/previous-versions/windows/apps/br230302(v=vs.140)).

- Разработка библиотек классов для использования в приложениях Магазина Windows 8.x, создаваемых на основе .NET Framework.

- Разработка компонентов среды выполнения Windows, упакованных в файлы .WinMD, которые можно использовать в любом языке программирования с поддержкой среды выполнения Windows. Примеры см. в статье [Создание компонентов среды выполнения Windows на C# и Visual Basic](/windows/uwp/winrt-components/creating-windows-runtime-components-in-csharp-and-visual-basic).

В этой статье кратко описана поддержка, которую предоставляет .NET Framework для всех трех категорий, и описываются сценарии для компонентов среды выполнения Windows. Первый раздел содержит основные сведения о связи между .NET Framework и средой выполнения Windows и рассматривает некоторые странности, с которыми вы можете столкнуться в системе справки и интегрированной среде разработки. Во [втором разделе](#WindowsRuntimeComponents) описываются сценарии разработки компонентов среды выполнения Windows.

## <a name="the-basics"></a>Основы

Платформа .NET Framework поддерживает все три перечисленных выше сценария разработки, предоставляя приложения .NET для Магазина Windows 8.x и поддерживая саму среду выполнения Windows.

- [Пространства имен .NET Framework и среды выполнения Windows](/previous-versions/windows/apps/br230302(v=vs.140)#net-framework-and-windows-runtime-namespaces) предоставляют упрощенный срез библиотек классов .NET Framework, в котором есть только те типы и элементы, которые могут пригодиться для создания приложений Магазина Windows 8.x и компонентов среды выполнения Windows.

  - Если вы используете Visual Studio (Visual Studio 2012 или более поздней версии) для разработки приложения для Магазина Windows 8. x или компонентов среды выполнения Windows, набор базовых сборок позволяет видеть только применимые типы и элементы.

  - Этот оптимизированный набор API дополнительно упрощен за счет удаления функций, у которых есть прямые аналоги в .NET Framework или среди функций среды выполнения Windows. Например, в нем есть только универсальные версии типов коллекций, а объектная модель документов XML исключена в пользу набора API XML среды выполнения Windows.

  - Также удалены функции, которые являются оболочками API операционной системы, так как среда выполнения Windows позволяет легко вызывать их из управляемого кода.

  Дополнительные сведения о приложениях .NET для Магазина Windows 8.x см. в [обзоре приложений .NET для Магазина Windows](/previous-versions/windows/apps/br230302(v=vs.140)). Информацию о процессе выбора API можно изучить в записи [.NET for Metro style apps](https://devblogs.microsoft.com/dotnet/net-for-metro-style-apps/) (Приложения .NET для стиля Metro) в блоге по .NET.

- [Среда выполнения Windows](/uwp/api/) предоставляет элементы пользовательского интерфейса для создания приложений Магазина Windows 8.x и доступ к возможностям операционной системы. Как и .NET Framework, среда выполнения Windows содержит метаданные, которые позволяют компиляторам C# и Visual Basic использовать среду выполнения Windows так же, как и библиотеки классов .NET Framework. Платформа .NET Framework упрощает использование среды выполнения Windows, скрывая некоторые различия:

  - Скрыты некоторые различия в шаблонах программирования между .NET Framework и средой выполнения Windows, таких как шаблон добавления и удаления обработчиков событий. Можно просто использовать шаблон .NET Framework.

  - Некоторые отличия часто используемых типов (например, примитивных типов и коллекций) также скрыты. Можно просто использовать типы .NET Framework, как описано в разделе [Различия, которые видимы в интегрированной среде разработки](#DifferencesVisibleInIDE) далее в этой статье.

В большинстве случаев поддержка среды выполнения Windows в .NET Framework реализуется прозрачно. В следующем разделе описываются некоторые заметные различия между управляемым кодом и средой выполнения Windows.

<a name="AboutReferenceDocumentation"></a>

### <a name="the-net-framework-and-the-windows-runtime-reference-documentation"></a>Справочная документация по .NET Framework и среде выполнения Windows

Для среды выполнения Windows и .NET Framework предоставляются разные наборы документации. При нажатии клавиши F1 для отображения справки для типа или члена отображается справочная документация из соответствующего набора. При просмотре документации по [среде выполнения Windows](/uwp/api/) вы можете встретить странные на первый взгляд примеры:

- Некоторые разделы, например по интерфейсу <xref:Windows.Foundation.Collections.IIterable%601>, не имеют синтаксиса объявления для Visual Basic или C#. Вместо этого над разделом синтаксиса отображается примечание (в данном случае такое: ".NET: этот интерфейс отображается как System.Collections.Generic.IEnumerable\<T>"). Это происходит потому, что .NET Framework и среда выполнения Windows обеспечивают одну и ту же функциональность с помощью разных интерфейсов. Кроме того, существуют отличия в поведении: `IIterable` содержит метод `First` вместо метода <xref:System.Collections.Generic.IEnumerable%601.GetEnumerator%2A> для возврата перечислителя. Чтобы не заставлять вас изучать новый способ выполнения уже привычных задач, .NET Framework поддерживает среду выполнения Windows, то есть ваш управляемый код выглядит так же, как при использовании знакомого типа. Вы не увидите интерфейс `IIterable` в интегрированной среде разработки, поэтому сведения о нем могут вам встретиться только при непосредственном изучении справочной документации по среде выполнения Windows.

- В документации по <xref:Windows.Web.Syndication.SyndicationFeed.%23ctor(System.String,System.String,Windows.Foundation.Uri)> возникает аналогичная проблема: типы параметров в нем различаются для разных языков. Для C# и Visual Basic типами параметров являются <xref:System.String?displayProperty=nameWithType> и <xref:System.Uri?displayProperty=nameWithType>. Это происходит потому, что платформа .NET Framework имеет собственные типы `String` и `Uri`, и для таких часто используемых типов не имеет смысла принуждать пользователей .NET Framework использовать другой способ выполнения действий. В интегрированной среде разработки .NET Framework скрывает соответствующие типы среды выполнения Windows.

- В некоторых случаях, например для структуры <xref:Windows.UI.Xaml.GridLength>, .NET Framework предоставляет тип с таким же именем, но с более широкими возможностями. Например, разделы о конструкторе и свойствах связаны с `GridLength`, но они имеют блоков синтаксиса только для Visual Basic и C#, так как эти члены доступны только в управляемом коде. В среде выполнения Windows структуры имеют только поля. Для обеспечения эквивалентной функциональности в среде выполнения Windows для структуры требуется вспомогательный класс <xref:Windows.UI.Xaml.GridLengthHelper>. Вы не увидите этот вспомогательный класс в интегрированной среде разработки при создании управляемого кода.

- В интегрированной среде разработки для типов среды выполнения Windows создается видимость наследования от <xref:System.Object?displayProperty=nameWithType>. У них могут быть члены, унаследованные от <xref:System.Object>, например <xref:System.Object.ToString%2A?displayProperty=nameWithType>. Эти элементы работают так, как если бы они действительно наследовали от <xref:System.Object>, поэтому типы среды выполнения Windows могут быть приведены к <xref:System.Object>. Эта функциональность является частью поддержки, которую .NET Framework предоставляет для среды выполнения Windows. Но вы не найдете эти элементы в списке типов в справочной документации по среде выполнения Windows. Документация для этих унаследованных членов предоставляется в документации по <xref:System.Object?displayProperty=nameWithType>.

<a name="DifferencesVisibleInIDE"></a>

### <a name="differences-that-are-visible-in-the-ide"></a>Различия, которые видимы в интегрированной среде разработки

В более сложных сценариях программирования, например при использовании компонента среды выполнения Windows на языке C# для реализации логики в приложении Магазина Windows 8.x, созданного для Windows на языке JavaScript, все такие различия четко отражаются и в интегрированной среде разработки, и в документации. Если компонент возвращает `IDictionary<int, string>` в JavaScript, при просмотре этого компонента в отладчике JavaScript вы увидите методы `IMap<int, string>`, так как JavaScript использует тип среды выполнения Windows. Несколько часто используемых типов коллекций, которые по-разному представляются в этих двух языках, показаны в следующей таблице.

|Тип среды выполнения Windows|Соответствующий тип платформы .NET Framework|
|--------------------------------------------------------------|---------------------------------------|
|`IIterable<T>`|`IEnumerable<T>`|
|`IIterator<T>`|`IEnumerator<T>`|
|`IVector<T>`|`IList<T>`|
|`IVectorView<T>`|`IReadOnlyList<T>`|
|`IMap<K, V>`|`IDictionary<TKey, TValue>`|
|`IMapView<K, V>`|`IReadOnlyDictionary<TKey, TValue>`|
|`IBindableIterable`|`IEnumerable`|
|`IBindableVector`|`IList`|
|`Windows.UI.Xaml.Data.INotifyPropertyChanged`|`System.ComponentModel.INotifyPropertyChanged`|
|`Windows.UI.Xaml.Data.PropertyChangedEventHandler`|`System.ComponentModel.PropertyChangedEventHandler`|
|`Windows.UI.Xaml.Data.PropertyChangedEventArgs`|`System.ComponentModel.PropertyChangedEventArgs`|

В среде выполнения Windows перебор `IMap<K, V>` и `IMapView<K, V>` выполняется с использованием `IKeyValuePair`. При передаче этих типов в управляемый код они представляются как `IDictionary<TKey, TValue>` и `IReadOnlyDictionary<TKey, TValue>`, поэтому для их перебора можно обычным образом использовать `System.Collections.Generic.KeyValuePair<TKey, TValue>`.

Представление интерфейсов в управляемом коде влияет на представление типов, реализующих эти интерфейсы. Например, класс `PropertySet` реализует `IMap<K, V>`, который представлен в управляемом коде как `IDictionary<TKey, TValue>`. `PropertySet` представляет себя как реализующего `IDictionary<TKey, TValue>` вместо `IMap<K, V>`, поэтому в управляемом коде у него присутствует метод `Add`, который ведет себя как метод `Add` в словарях .NET Framework. А метода `Insert` у этого типа нет.

Дополнительные сведения об использовании .NET Framework для создания компонента среды выполнения Windows см. в статье [Создание компонентов среды выполнения Windows на C# и Visual Basic](/windows/uwp/winrt-components/creating-windows-runtime-components-in-csharp-and-visual-basic). На этой же странице приведено пошаговое руководство по использованию этого компонента с JavaScript.

### <a name="primitive-types"></a>Примитивные типы

Для удобства работы со средой выполнения Windows в управляемом коде вместо примитивных типов среды выполнения Windows отображаются примитивные типы .NET Framework. В .NET Framework у простых типов, таких как структура `Int32`, имеется множество полезных свойств и методов, например метод `Int32.TryParse`. Напротив, примитивные типы и структуры в среде выполнения Windows имеют только поля. При использовании простых типов в управляемом коде они представляются как типы платформы .NET Framework, и можно как обычно использовать свойства и методы типов платформы .NET Framework. В следующем списке приводятся сводные данные.

- Вместо простых типов среды выполнения Windows `Int32`, `Int64`, `Single`, `Double`, `Boolean`, `String` (неизменяемая коллекция символов Юникода), `Enum`, `UInt32`, `UInt64` и `Guid` используются одноименные типы из пространства имен `System`.

- Для `UInt8` используйте `System.Byte`.

- Для `Char16` используйте `System.Char`.

- вместо интерфейса `IInspectable` используется тип `System.Object`.

- Для `HRESULT` используйте структуру с одним членом `System.Int32`.

Как и с типами интерфейса, признаки этого представления вы можете увидеть только в том случае, если проект для .NET Framework является компонентом среды выполнения Windows, который используется приложением Магазина Windows 8.x на языке JavaScript.

В числе других типов среды выполнения Windows, которые часто появляются в управляемом коде в качестве своих эквивалентов .NET Framework, можно упомянуть структуру `Windows.Foundation.DateTime`, которая отображается в управляемом коде как структура <xref:System.DateTimeOffset?displayProperty=nameWithType>, и структуру `Windows.Foundation.TimeSpan`, которая отображается как структура <xref:System.TimeSpan?displayProperty=nameWithType>.

### <a name="other-differences"></a>Другие различия

В некоторых случаях тот факт, что в коде отображаются типы .NET Framework вместо типов среды выполнения Windows, требует дополнительных действий со стороны пользователя. Например, класс <xref:Windows.Foundation.Uri?displayProperty=nameWithType> отображается в коде для .NET Framework как <xref:System.Uri?displayProperty=nameWithType>. <xref:System.Uri?displayProperty=nameWithType> позволяет использовать относительные URI, но для <xref:Windows.Foundation.Uri?displayProperty=nameWithType> требуется только абсолютный URI. Таким образом при передаче URI в метод среды выполнения Windows необходимо обеспечить, чтобы он был абсолютным. См. раздел [Передача URI в среду выполнения Windows](passing-a-uri-to-the-windows-runtime.md).

<a name="WindowsRuntimeComponents"></a>

## <a name="scenarios-for-developing-windows-runtime-components"></a>Сценарии для разработки компонентов среды выполнения Windows

Сценарии, поддерживаемые для управляемых компонентов среды выполнения Windows, зависят от следующих общих принципов:

- Компоненты среды выполнения Windows, созданные на основе .NET Framework, не имеют явных отличий от других библиотек среды выполнения Windows. Например, если вы продублируете собственный компонент среды выполнения Windows в управляемом коде, эти два компонента будут неразличимы для внешнего кода. Дело в том, что компонент, написанный в управляемом коде, остается незаметным для кода, который его использует, даже если сам код является управляемым. Однако на внутреннем уровне компонент является настоящим управляемым кодом и работает в среде CLR.

- Компоненты могут содержать любое сочетание типов, которые реализуют логику приложения, и элементов управления пользовательского интерфейса Магазина Windows 8.x.

  > [!NOTE]
  > Рекомендуется отделять элементы пользовательского интерфейса от логики приложения. Кроме того, нельзя использовать элементы управления пользовательского интерфейса Магазина Windows 8.x в приложении для Магазина Windows 8.x, созданного для Windows на основе JavaScript и HTML.

- Компонент может быть проектом внутри решения Visual Studio для приложения Магазина Windows 8.x или многоразовым компонентом, который можно добавить к нескольким решениям.

  > [!NOTE]
  > Если компонент будет использоваться только для C# или Visual Basic, нет смысла делать его компонентом среды выполнения Windows. Если его оформить как обычную библиотеку классов .NET Framework, вам не придется ограничивать открытый API только типами среды выполнения Windows.

- Версии повторно используемых компонентов можно выпускать с атрибутом среды выполнения Windows <xref:Windows.Foundation.Metadata.VersionAttribute>, чтобы обозначать новые типы и новые элементы типов, добавленные в очередной версии.

- Типы в таком компоненте могут наследовать от типов среды выполнения Windows. Элементы управления могут быть производными от примитивных типов элементов управления в пространстве имен <xref:Windows.UI.Xaml.Controls.Primitives> или от более специализированных элементов управления, таких как <xref:Windows.UI.Xaml.Controls.Button>.

  > [!IMPORTANT]
  > Начиная с Windows 8 и .NET Framework 4.5 все открытые (public) типы в управляемом компоненте среды выполнения Windows должны иметь атрибут sealed. Вы не можете наследовать от них типы, расположенные в другом компоненте среды выполнения Windows. Если необходимо предоставить полиморфное расширения функциональности в компоненте, можно создать интерфейс и реализовать его в полиморфных типах.

- Все параметры и типы возвращаемых значений для открытых типов в компоненте должны являться типами среды выполнения Windows (включая типы среды выполнения Windows, которые определяет этот компонент).

Следующие разделы содержат примеры распространенных сценариев.

### <a name="application-logic-for-a-windows-8x-store-app-with-javascript"></a>Логика приложения для приложения Магазина Windows 8.x на языке JavaScript

Когда вы создаете приложение Магазина Windows 8.x для Windows на языке JavaScript, некоторые части логики приложения могут оказаться более производительными или более простыми в разработке, если написать их на управляемом коде. Javascript не может использовать библиотеки классов платформы .NET Framework непосредственно, но можно сделать библиотекой классов файл .WinMD. В этом сценарии компонент среды выполнения Windows является неотъемлемой частью приложения, поэтому нет смысла указывать атрибуты версии.

### <a name="reusable-windows-8x-store-ui-controls"></a>Многократное использование элементов управления пользовательского интерфейса Магазина Windows 8.x

Вы можете упаковать набор связанных элементов управления пользовательского интерфейса в многократно используемый компонент среды выполнения Windows. Компонент может распространяться сам по себе или использоваться как элемент в приложениях, которые вы создаете. В этом случае следует использовать атрибут <xref:Windows.Foundation.Metadata.VersionAttribute> среды выполнения Windows, чтобы повысить уровень совместимости.

### <a name="reusable-application-logic-from-existing-net-framework-apps"></a>Логика приложения с возможностью повторного использования существующих приложений платформы .NET Framework

Можно упаковать управляемый код из существующих классических приложений в автономный компонент среды выполнения Windows. Такой компонент вы сможете использовать в приложениях Магазина Windows 8.x, созданных на языках C++ или JavaScript, а также в приложениях Магазина Windows 8.x на языках C# или Visual Basic. Используйте управление версиями, если этот код будет использоваться в нескольких местах.

## <a name="related-topics"></a>См. также

|Заголовок|Описание|
|-----------|-----------------|
|[Общие сведения о платформе .NET для приложений Магазина Windows](/previous-versions/windows/apps/br230302(v=vs.140))|Описывает типы и элементы .NET Framework,которые вы можете использовать для создания приложений Магазина Windows 8.x и компонентов среды выполнения Windows. (В Центре разработки для Windows.)|
|[Схема создания приложений для Магазина Windows на C# или Visual Basic](/previous-versions/windows/apps/br229583(v=win.10))|Предоставляет основные ресурсы, которые помогут начать разработку приложений Магазина Windows 8.x на языках C# или Visual Basic, а также различные разделы краткого руководства, правила и рекомендации. (В Центре разработки для Windows.)|
|[Практические руководства по XAML](/previous-versions/windows/apps/br229566(v=win.10))|Предоставляет основные ресурсы, которые помогут начать разработку приложений Магазина Windows 8.x на языках C# или Visual Basic, а также различные разделы краткого руководства, правила и рекомендации. (В Центре разработки для Windows.)|
|[Создание компонентов среды выполнения Windows в C# и Visual Basic](/windows/uwp/winrt-components/creating-windows-runtime-components-in-csharp-and-visual-basic)|Описывает процесс создания компонента среды выполнения Windows с помощью .NET Framework, использование компонента в составе приложения Магазина Windows 8.x, созданного для Windows на языке JavaScript, а также процесс отладки с помощью Visual Studio. (В Центре разработки для Windows.)|
|[Справочные материалы по среде выполнения Windows](/uwp/api/)|Справочная документация по среде выполнения Windows. (В Центре разработки для Windows.)|
|[Передача URI в среду выполнения Windows](passing-a-uri-to-the-windows-runtime.md)|Описывает проблему, которая может возникнуть при передаче URI из управляемого кода в среду выполнения Windows, и объясняет, как ее избежать.|
