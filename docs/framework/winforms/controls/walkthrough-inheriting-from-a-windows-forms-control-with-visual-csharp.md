---
title: Пошаговое руководство. Наследование элементов управления Windows Forms с помощью Visual C#
ms.date: 03/30/2017
helpviewer_keywords:
- inheritance [Windows Forms], custom controls
- inheritance [Windows Forms], control
- Windows Forms controls, inheritance
- inheritance [Windows Forms], walkthroughs
- custom controls [Windows Forms], inheritance
ms.assetid: 09476da0-8d4c-4a4c-b969-649519dfb438
ms.openlocfilehash: cafd8685f34537f8efb372967dc45682afbe8fa0
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59306382"
---
# <a name="walkthrough-inheriting-from-a-windows-forms-control-with-visual-c"></a>Пошаговое руководство. Наследование элементов управления Windows Forms с помощью Visual C\#
С помощью [!INCLUDE[csprcslong](../../../../includes/csprcslong-md.md)] можно создавать эффективные настраиваемые элементы управления путем *наследования*. Наследование позволяет создавать элементы управления, сохраняющие все унаследованные функциональные возможности элементов управления Windows Forms и в то же время обладающие дополнительными функциями. В этом пошаговом руководстве вы создадите простой производный элемент управления с именем `ValueButton`. Эта кнопка наследует функциональные возможности стандартных форм Windows <xref:System.Windows.Forms.Button> управления и предоставляет настраиваемое свойство `ButtonValue`.  
  
> [!NOTE]
>  Отображаемые диалоговые окна и команды меню могут отличаться от описанных в справке в зависимости от текущих параметров или выпуска. Чтобы изменить параметры, выберите в меню **Сервис** пункт **Импорт и экспорт параметров** . Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](/visualstudio/ide/personalizing-the-visual-studio-ide).  
  
## <a name="creating-the-project"></a>Создание проекта  
 Создавая проект, вы указываете для него имя, чтобы задать корневое пространство имен, имя сборки и имя проекта, и необходимо убедиться в том, что компонент по умолчанию попадет в нужное пространство имен.  
  
#### <a name="to-create-the-valuebuttonlib-control-library-and-the-valuebutton-control"></a>Создание библиотеки элементов управления ValueButtonLib и элемента управления ValueButton  
  
1. В меню **Файл** наведите указатель мыши на пункт **Создать** и выберите **Проект**, чтобы открыть диалоговое окно **Создание проекта**.  
  
2. Выберите **Библиотека элементов управления Windows Forms** шаблон проекта из списка проектов Visual C#, а также тип `ValueButtonLib` в **имя** поле.  
  
     Имя проекта, `ValueButtonLib`, по умолчанию также назначается корневому пространству имен. Корневое пространство имен используется для определения имен компонентов в сборке. Например, если в двух сборках содержатся компоненты с именем `ValueButton`, можно указать компонент `ValueButton`, используя `ValueButtonLib.ValueButton`. Дополнительные сведения см. в разделе [Пространства имен](../../../csharp/programming-guide/namespaces/index.md).  
  
3. В **обозревателе решений** щелкните правой кнопкой мыши **UserControl1.cs** и выберите в контекстном меню команду **Переименовать**. Измените имя файла на `ValueButton.cs`. Чтобы переименовать все ссылки на элемент кода '`UserControl1`', в соответствующем запросе нажмите кнопку **Да**.  
  
4. В **обозревателе решений** щелкните правой кнопкой мыши файл **ValueButton.cs** и выберите команду **Просмотреть код**.  
  
5. Найдите `class` строка инструкции `public partial class ValueButton`и измените тип, из которого наследуется этот элемент управления из <xref:System.Windows.Forms.UserControl> для <xref:System.Windows.Forms.Button>. Это позволяет элементу управления унаследовать все функции из <xref:System.Windows.Forms.Button> элемента управления.  
  
6. В **обозревателе решений** откройте узел **ValueButton.cs**, чтобы отобразить сформированный конструктором файл кода **ValueButton.Designer.cs**. Откройте этот файл в **редакторе кода**.  
  
7. Найдите `InitializeComponent` метод и удалить строку, назначающую <xref:System.Windows.Forms.ContainerControl.AutoScaleMode%2A> свойство. Это свойство не существует в <xref:System.Windows.Forms.Button> элемента управления.  
  
8. Сохраните проект, выбрав в меню **Файл** команду **Сохранить все**.  
  
    > [!NOTE]
    >  Визуальный конструктор больше не доступен. Так как <xref:System.Windows.Forms.Button> элемент управления имеет собственное оформление, вы не сможете изменить его внешний вид в конструкторе. Визуальное представление будет иметь точно так же, как он наследует от класса (то есть <xref:System.Windows.Forms.Button>) Если изменения в код. В область конструктора по-прежнему можно добавлять компоненты, не имеющие элементов пользовательского интерфейса.  
  
## <a name="adding-a-property-to-your-inherited-control"></a>Добавление свойства в наследуемый элемент управления  
 Один из возможных способов использования наследуемых элементов управления форм Windows Forms — это создание элементов управления, имеющих такой же внешний вид и функции, как у стандартных элементов управления Windows Forms, но предоставляющих настраиваемые свойства. В этом разделе вы добавите в элемент управления свойство с именем `ButtonValue`.  
  
#### <a name="to-add-the-value-property"></a>Добавьте значение свойства  
  
1. В **обозревателе решений** щелкните правой кнопкой мыши **ValueButton.cs** и выберите в контекстном меню пункт **Просмотреть код**.  
  
2. Найдите оператор `class`. Сразу после `{` введите следующий код.  
  
    ```csharp  
    // Creates the private variable that will store the value of your   
    // property.  
    private int varValue;  
    // Declares the property.  
    public int ButtonValue  
    {  
       // Sets the method for retrieving the value of your property.  
       get  
       {  
          return varValue;  
       }  
       // Sets the method for setting the value of your property.  
       set  
       {  
          varValue = value;  
       }  
    }  
    ```  
  
     Этот код определяет методы хранения и извлечения свойства `ButtonValue`. Оператор `get` определяет значение, возвращаемое значению, которое хранится в закрытой переменной `varValue`, а оператор `set` задает значение закрытой переменной с помощью ключевого слова `value`.  
  
3. Сохраните проект, выбрав в меню **Файл** команду **Сохранить все**.  
  
## <a name="testing-your-control"></a>Тестирование элемента управления  
 Элементы управления не являются автономными проектами и должны размещаться в контейнере. Чтобы протестировать элемент управления, необходимо предоставить тестовый проект, в котором он будет выполняться. Кроме того, нужно сделать элемент управления доступным для тестового проекта, выполнив сборку (компиляцию). В этом разделе вы выполните сборку элемента управления и протестируете его в Windows Forms.  
  
#### <a name="to-build-your-control"></a>Сборка элемента управления  
  
1. В меню **Сборка** выберите **Собрать решение**.  
  
     Сборка должна быть выполнена без ошибок компилятора и предупреждений.  
  
#### <a name="to-create-a-test-project"></a>Создание тестового проекта  
  
1. В меню **Файл** наведите указатель мыши на пункт **Добавить** и выберите **Проект**, чтобы открыть диалоговое окно **Добавление нового проекта**.  
  
2. Выберите узел **Windows** под узлом **Visual C#** и выберите **приложение Windows Forms**.  
  
3. В поле **Имя** введите `Test`.  
  
4. В **обозревателе решений** щелкните узел **Ссылки** для тестового проекта правой кнопкой мыши и выберите в контекстном меню пункт **Добавить ссылку**, чтобы открыть диалоговое окно **Добавление ссылки**.  
  
5. Выберите вкладку **Проекты**. Проект `ValueButtonLib` будет указан под полем **Имя проекта**. Дважды щелкните проект, чтобы добавить ссылку на тестовый проект.  
  
6. В **обозревателе решений** щелкните **Тест** правой кнопкой мыши и выберите пункт **Построить**.  
  
#### <a name="to-add-your-control-to-the-form"></a>Добавление элемента управления в форму  
  
1. В **обозревателе решений** щелкните правой кнопкой мыши файл **Form1.cs** и выберите в контекстном меню пункт **Конструктор представлений**.  
  
2. На **панели элементов** выберите **Компоненты ValueButtonLib**. Дважды щелкните **ValueButton**.  
  
     Объект **ValueButton** появится в форме.  
  
3. Щелкните **ValueButton** правой кнопкой мыши и выберите в контекстном меню пункт **Свойства**.  
  
4. В окне **Свойства** проверьте свойства этого элемента управления. Обратите внимание, что они идентичны свойствам стандартной кнопки, кроме дополнительного свойства `ButtonValue`.  
  
5. Задайте для свойства `ButtonValue` значение `5`.  
  
6. В **все формы Windows Forms** вкладке **элементов**, дважды щелкните **метка** добавление <xref:System.Windows.Forms.Label> форму элемента управления.  
  
7. Переместите метку в центр формы.  
  
8. Дважды щелкните файл `valueButton1`.  
  
     В **редакторе кода** откроется событие `valueButton1_Click`.  
  
9. Вставьте следующую строку кода.  
  
    ```csharp  
    label1.Text = valueButton1.ButtonValue.ToString();  
    ```  
  
10. В **обозревателе решений** щелкните **Тест** правой кнопкой мыши и выберите в контекстном меню команду **Назначить автозагружаемым проектом**.  
  
11. В меню **Отладка** выберите пункт **Начать отладку**.  
  
     `Form1` отображается.  
  
12. Нажмите кнопку `valueButton1`.  
  
     В `label1` появится цифра 5, показывающая, что свойство `ButtonValue` унаследованного элемента управления передано `label1` с помощью метода `valueButton1_Click`. Таким образом, ваш элемент управления `ValueButton` наследует функциональные возможности стандартной кнопки Windows Forms и при этом предоставляет дополнительное настраиваемое свойство.  
  
## <a name="see-also"></a>См. также

- [Практическое руководство. Отображение элемента управления в диалоговом окне выбора элементов панели элементов](how-to-display-a-control-in-the-choose-toolbox-items-dialog-box.md)
- [Пошаговое руководство. Создание составного элемента управления с помощью C#](walkthrough-authoring-a-composite-control-with-visual-csharp.md)
