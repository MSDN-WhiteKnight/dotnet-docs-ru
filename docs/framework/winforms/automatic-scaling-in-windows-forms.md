---
title: Автоматическое масштабирование в Windows Forms
ms.date: 06/15/2017
helpviewer_keywords:
- scalability [Windows Forms], automatic in Windows Forms
- Windows Forms, automatic scaling
ms.assetid: 68fad25b-afbc-44bd-8e1b-966fc43507a4
ms.openlocfilehash: d3981be7977b56af0b60f9796519b78dc9ac5db3
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/04/2018
ms.locfileid: "43505770"
---
# <a name="automatic-scaling-in-windows-forms"></a>Автоматическое масштабирование в Windows Forms

Автоматическое масштабирование позволяет форме и ее элементам управления, разработанным на одном компьютере с использованием определенного разрешения или системных шрифтов, правильно отображаться на другом компьютере с другим разрешением или системным шрифтом. Оно гарантирует, что размеры формы и ее элементов управления будут изменяться автоматически в соответствии с приложениями Windows и другими приложениями на компьютерах пользователя и разработчика. Поддержка автоматического масштабирования и стилей оформления в [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] позволяет приложениям [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] сохранять согласованный внешний вид и поведение на различных компьютерах пользователей, так же как в случае с обычными приложениями Windows.

В большинстве случаев автоматическое масштабирование работает должным образом в [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 2.0 и более поздних версий. Однако внесение изменений в схему шрифтов может быть проблематичным. Пример того, как устранить эту проблему, см. в разделе [как: реагирование на изменения схемы шрифтов в приложении Windows Forms](how-to-respond-to-font-scheme-changes-in-a-windows-forms-application.md).

## <a name="need-for-automatic-scaling"></a>Необходимость автоматического масштабирования

Без автоматического масштабирования приложения, разработанные для определенного разрешения экрана или шрифта, будут выглядеть либо слишком маленькими, либо слишком большими при изменении разрешения или шрифта. Например, если приложение разработано с использованием базового шрифта Tahoma размером 9 пунктов, то без коррекции оно будет выглядеть слишком маленьким при запуске на компьютере, на котором в качестве системного шрифта используется Tahoma размером 12 пунктов. Текстовые элементы, такие как заголовки, меню, содержимое текстовых полей и т. д., будут меньше, чем в других приложениях. Более того, размер содержащих текст элементов пользовательского интерфейса, таких как строки заголовков, меню и т. д., зависит от используемого шрифта. В рассматриваемом примере эти элементы также будут выглядеть относительно меньше.

Аналогичная ситуация возникает, когда приложение разработано для определенного разрешения экрана. Наиболее частое разрешение экрана — 96 точек на дюйм (DPI), который равен 100% масштаб отображения, но выше отображает разрешение поддержкой 125%, 150%, 200% (какие соответственно равен 120, 144 и 192 DPI) и более поздних версий более распространенными становятся. Без коррекции приложение, особенно графическое, разработанное для одного разрешения, будет отображаться либо слишком большим, либо слишком маленьким при запуске с другим разрешением.

Автоматическое масштабирование предназначено для решения таких проблем путем автоматического изменения размеров формы и ее дочерних элементов управления согласно относительному размеру шрифтов и разрешению экрана. Операционная система Windows поддерживает автоматическое масштабирование диалоговых окон с помощью относительной единицы измерения, называемой единицей размера диалогового окна. Единица размера диалогового окна основана на системном шрифте, а ее связь с пикселями можно определить с помощью функции `GetDialogBaseUnits` пакета Win32 SDK. При изменении темы, используемой Windows, все диалоговые окна автоматически настраиваются соответствующим образом. Кроме того [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] поддерживает автоматическое масштабирование в соответствии со стандартным системным шрифтом или разрешением экрана. При необходимости автоматическое масштабирование можно отключить в приложении.

## <a name="original-support-for-automatic-scaling"></a>Исходная поддержка автоматического масштабирования

в [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] 1.0 и 1.1 автоматическое масштабирование поддерживалось простым способом и зависело от шрифта Windows, используемого по умолчанию для пользовательского интерфейса. Этот шрифт представлен в пакете Win32 SDK значением **DEFAULT_GUI_FONT**. Обычно этот шрифт изменяется только при изменении разрешения экрана. Для реализации автоматического масштабирования применялся описанный ниже механизм.

1. Во время разработки свойству <xref:System.Windows.Forms.Form.AutoScaleBaseSize%2A> (которое теперь устарело) присваивалась высота и ширина системного шрифта по умолчанию на компьютере разработчика.

2. Во время выполнения для инициализации свойства <xref:System.Windows.Forms.Control.Font%2A> класса <xref:System.Windows.Forms.Form> использовался стандартный системный шрифт компьютера пользователя.

3. Перед отображением формы вызывался метод <xref:System.Windows.Forms.Form.ApplyAutoScaling%2A> для ее масштабирования. Этот метод вычислял относительный масштаб с помощью свойств <xref:System.Windows.Forms.Form.AutoScaleBaseSize%2A> и <xref:System.Windows.Forms.Control.Font%2A>, а затем вызывал метод <xref:System.Windows.Forms.Control.Scale%2A> для масштабирования формы и ее дочерних элементов.

4. Значение свойства <xref:System.Windows.Forms.Form.AutoScaleBaseSize%2A> обновлялось таким образом, чтобы последующие вызовы <xref:System.Windows.Forms.Form.ApplyAutoScaling%2A> не продолжали изменять размер формы.

Этого механизма было достаточно для большинства целей, но он имел ряд ограничений.

- Так как <xref:System.Windows.Forms.Form.AutoScaleBaseSize%2A> свойство представляет базовый размер шрифта в виде целочисленные значения, погрешности округления становились заметны, когда форма проходила через ряд разрешений.

- Автоматическое масштабирование было реализовано только в классе <xref:System.Windows.Forms.Form>, но не в классе <xref:System.Windows.Forms.ContainerControl>. В результате пользовательский элемент управления масштабировался корректно, только если он был разработан с тем же разрешением, что и форма, и был помещен в форму во время разработки.

- Несколько разработчиков могли параллельно разрабатывать формы и их дочерние элементы управления, только если разрешение экрана на их компьютерах совпадало. Аналогичным образом наследование форм зависело от разрешения родительской формы.

- Механизм несовместим с новыми диспетчерами макетов, добавленными в [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] версии 2.0, такими как <xref:System.Windows.Forms.FlowLayoutPanel> и <xref:System.Windows.Forms.TableLayoutPanel>.

- Механизм не поддерживает масштабирование непосредственно на основе разрешения экрана, необходимое для совместимости с [!INCLUDE[compact](../../../includes/compact-md.md)].

Хотя этот механизм сохранился в [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] версии 2.0 для обеспечения обратной совместимости, на смену ему пришел более надежный механизм масштабирования, описанный ниже. Как следствие, методы <xref:System.Windows.Forms.Form.AutoScale%2A>, <xref:System.Windows.Forms.Form.ApplyAutoScaling%2A>, <xref:System.Windows.Forms.Form.AutoScaleBaseSize%2A> и некоторые перегрузки <xref:System.Windows.Forms.Control.Scale%2A> помечены как устаревшие.

> [!NOTE]
> Вы можете спокойно удалить ссылки на эти члены при обновлении старого кода до [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] версии 2.0.

## <a name="current-support-for-automatic-scaling"></a>Текущая поддержка автоматического масштабирования

В [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] версии 2.0 ограничения предыдущих версий снимаются благодаря описанным ниже изменениям, внесенным в механизм автоматического масштабирования форм Windows Forms.

- Базовая поддержка масштабирования была перемещена в класс <xref:System.Windows.Forms.ContainerControl>, чтобы формы, собственные составные элементы управления и пользовательские элементы управления получали единообразную поддержку масштабирования. Были добавлены новые члены <xref:System.Windows.Forms.ContainerControl.AutoScaleFactor%2A>, <xref:System.Windows.Forms.ContainerControl.AutoScaleDimensions%2A>, <xref:System.Windows.Forms.ContainerControl.AutoScaleMode%2A> и <xref:System.Windows.Forms.ContainerControl.PerformAutoScale%2A>.

- Класс <xref:System.Windows.Forms.Control> также имеет несколько новых членов, которые позволяют ему участвовать в масштабировании и поддерживать смешанное масштабирование в одной и той же форме. В частности, члены <xref:System.Windows.Forms.Control.Scale%2A>, <xref:System.Windows.Forms.Control.ScaleChildren%2A> и <xref:System.Windows.Forms.Control.GetScaledBounds%2A> поддерживают масштабирование.

- В дополнение к поддержке системного шрифта была добавлена поддержка масштабирования на основе разрешения экрана в соответствии со значениями перечисления <xref:System.Windows.Forms.AutoScaleMode>. Этот режим обеспечивает совместимость с автоматическим масштабированием, поддерживаемым [!INCLUDE[compact](../../../includes/compact-md.md)], что упрощает миграцию приложений.

- В реализацию автоматического масштабирования была добавлена совместимость с диспетчерами макетов, такими как <xref:System.Windows.Forms.FlowLayoutPanel> и <xref:System.Windows.Forms.TableLayoutPanel>.

- Коэффициенты масштабирования теперь представляются в виде чисел с плавающей запятой, обычно с помощью структуры <xref:System.Drawing.SizeF>, что позволило практически устранить ошибки округления.

> [!CAUTION]
> Произвольные сочетания режимов масштабирования на основе разрешения экрана и размера шрифта не поддерживаются. Вы без всяких проблем можете масштабировать пользовательский элемент управления в одном режиме (например, на основе разрешения экрана) и поместить его в форму с помощью другого режима (на основе размера шрифта), но использование базовой формы в одном режиме и производной формы в другом может привести к непредвиденным результатам.

### <a name="automatic-scaling-in-action"></a>Автоматическое масштабирование в действии

В Windows Forms для автоматического масштабирования формы и ее содержимого теперь используется описанная ниже логика.

1. Во время разработки каждый объект <xref:System.Windows.Forms.ContainerControl> регистрирует режим масштабирования и его текущее разрешение в свойствах <xref:System.Windows.Forms.ContainerControl.AutoScaleMode%2A> и <xref:System.Windows.Forms.ContainerControl.AutoScaleDimensions%2A> соответственно.

2. Во время выполнения фактическое разрешение хранится в свойстве <xref:System.Windows.Forms.ContainerControl.CurrentAutoScaleDimensions%2A>. Свойство <xref:System.Windows.Forms.ContainerControl.AutoScaleFactor%2A> динамически вычисляет отношение между разрешением во время выполнения и разрешением во время разработки.

3. Если при загрузке формы значения <xref:System.Windows.Forms.ContainerControl.CurrentAutoScaleDimensions%2A> и <xref:System.Windows.Forms.ContainerControl.AutoScaleDimensions%2A> различны, то для масштабирования элемента управления и его дочерних элементов вызывается метод <xref:System.Windows.Forms.ContainerControl.PerformAutoScale%2A>. Этот метод приостанавливает размещение и вызывает метод <xref:System.Windows.Forms.Control.Scale%2A> для выполнения фактического масштабирования. Впоследствии значение <xref:System.Windows.Forms.ContainerControl.AutoScaleDimensions%2A> обновляется во избежание прогрессивного масштабирования.

4. Метод <xref:System.Windows.Forms.ContainerControl.PerformAutoScale%2A> также вызывается автоматически в перечисленных ниже ситуациях.

    - В ответ на событие <xref:System.Windows.Forms.Control.OnFontChanged%2A>, если используется режим масштабирования <xref:System.Windows.Forms.AutoScaleMode.Font>.

    - Если при возобновлении размещения элементов управления внутри контейнера обнаруживается изменение свойства <xref:System.Windows.Forms.ContainerControl.AutoScaleDimensions%2A> или <xref:System.Windows.Forms.ContainerControl.AutoScaleMode%2A>.

    - При масштабировании родительского объекта <xref:System.Windows.Forms.ContainerControl>, как указанно выше. Каждый контейнерный элемент управления отвечает за масштабирование своих дочерних элементов с помощью своих собственных коэффициентов масштабирования, а не коэффициентов его родительского контейнера.

5. Поведение дочерних элементов управления при масштабировании может изменяться несколькими способами.

    - Можно переопределить свойство <xref:System.Windows.Forms.Control.ScaleChildren%2A>, чтобы указать, следует ли масштабировать дочерние элементы управления.

    - Можно переопределить метод <xref:System.Windows.Forms.Control.GetScaledBounds%2A> для корректировки границ, до которых масштабируется элемент управления, но не логики масштабирования.

    - Можно переопределить метод <xref:System.Windows.Forms.Control.ScaleControl%2A> для изменения логики масштабирования текущего элемента управления.

## <a name="see-also"></a>См. также

- <xref:System.Windows.Forms.ContainerControl.AutoScaleMode%2A>
- <xref:System.Windows.Forms.Control.Scale%2A>
- <xref:System.Windows.Forms.ContainerControl.PerformAutoScale%2A>
- <xref:System.Windows.Forms.ContainerControl.AutoScaleDimensions%2A>
- [Отрисовка элементов управления с применением визуальных стилей](./controls/rendering-controls-with-visual-styles.md)
- [Практическое руководство. Повышение производительности за счет отключения автоматического масштабирования](./advanced/how-to-improve-performance-by-avoiding-automatic-scaling.md)