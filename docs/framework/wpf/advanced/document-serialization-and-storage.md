---
title: Сериализация и хранение документов
ms.date: 03/30/2017
helpviewer_keywords:
- 'serialization of documents [WPF], , '
- documents [WPF], storage
- documents [WPF], serialization
ms.assetid: 4839cd87-e206-4571-803f-0200098ad37b
ms.openlocfilehash: dbc78db0a3b6763af5270840fc56af648c7c6efc
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59295904"
---
# <a name="document-serialization-and-storage"></a>Сериализация и хранение документов
Microsoft .NET Framework предоставляет мощную среду для создания и отображения документов высокого качества.  Улучшенные возможности, поддерживающие фиксированные и потоковые документы, улучшенные элементы управления просмотром в сочетании с мощными возможностями двумерной и трехмерной графики позволяют вывести приложения .NET Framework на новый уровень качества и взаимодействия с пользователем.  Возможность гибко управлять представлением документа в памяти является ключевой функцией программы .NET Framework, а также возможность эффективно сохранять и загружать документы из хранилища данных необходима практически во всех приложениях.  Процесс преобразования документа из внутреннего представления в памяти во внешнее хранилище данных называется сериализацией.  Обратный процесс чтения хранилища данных и воссоздания исходного экземпляра в памяти называется десериализацией.  

<a name="AboutSerialization"></a>   
## <a name="about-document-serialization"></a>О сериализации документов  
 В идеальном случае процесс сериализации и десериализации документа из памяти и в память прозрачен для приложения.  Приложение вызывает метод write сериализатора для сохранения документа, в то время как метод read десериализатора осуществляет доступ к хранилищу данных и воссоздает исходный экземпляр в памяти.  Как правило, формат хранения данных не имеет значения для приложения при условии, что в процессе сериализации и десериализации воссоздается документ в исходной форме.  
  
 Приложения часто предоставляют несколько параметров сериализации, которые позволяют пользователям сохранять документы на другом носителе или в другом формате.  Например, приложение может предложить варианты "Сохранить как" для сохранения документа в файл на диске, базу данных или веб-службу.  Аналогичным образом разные сериализаторы могут сохранять документ в различных форматах, например в HTML, RTF, XML, XPS или в ином стороннем формате.  Для приложения сериализация определяет интерфейс, который изолирует сведения о носителе в реализации каждого определенного сериализатора.  Помимо преимуществ инкапсуляции сведений о хранении, .NET Framework <xref:System.Windows.Documents.Serialization> [!INCLUDE[TLA2#tla_api#plural](../../../../includes/tla2sharptla-apisharpplural-md.md)] предоставляют несколько других важных возможностей.  
  
### <a name="features-of-net-framework-30-document-serializers"></a>Компоненты сериализаторов документов .NET Framework 3.0  
  
-   Прямой доступ к высокоуровневым объектам документа (логическое дерево и визуальные элементы) позволяет эффективно хранить разделенное на страницы содержимое, двухмерные и трехмерные элементы, изображения, мультимедиа, гиперссылки, аннотации и другое содержимое поддержки.  
  
-   Синхронные и асинхронные операции.  
  
-   Поддержка сериализаторов подключаемых модулей с расширенными возможностями:  
  
    -   Доступ на уровне системы для использования всеми приложениями .NET Framework.  
  
    -   Удобное обнаружение подключаемых модулей приложения.  
  
    -   Простое развертывание, установка и обновление пользовательских подключаемых модулей сторонних производителей.  
  
    -   Поддержка интерфейса пользователя для пользовательских параметров и настроек среды выполнения.  
  
### <a name="xps-print-path"></a>Способ печати XPS  
 Microsoft .NET Framework [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] способ печати также предоставляет расширяемый механизм записи документов посредством вывода на печать.  [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] служит как формат файла документа и имеет собственный формат очереди печати для [!INCLUDE[TLA#tla_winvista](../../../../includes/tlasharptla-winvista-md.md)].  [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] документы можно отправлять непосредственно на [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)]-совместимым принтерам без необходимости для преобразования в промежуточный формат.  См. дополнительные сведения о параметрах и возможностях вывода пути печати в разделе [Общие сведения о печати](printing-overview.md).  
  
<a name="PluginSerializers"></a>   
## <a name="plug-in-serializers"></a>Подключаемые сериализаторы  
 <xref:System.Windows.Documents.Serialization> API-интерфейсы обеспечивают поддержку для подключаемых и связанных сериализаторов, которые устанавливаются отдельно от приложения, привязка во время выполнения и осуществляется с помощью <xref:System.Windows.Documents.Serialization.SerializerProvider> механизм обнаружения.  Подключаемые сериализаторы обеспечивают расширенные преимущества для простоты развертывания и использования в масштабах системы.  Связанные сериализаторы также можно реализовать для сред с частичным доверием, таких как [!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)], где подключаемые сериализаторы недоступны.  Связанные сериализаторы, основанные на производной реализации <xref:System.Windows.Documents.Serialization.SerializerWriter> класса, компилируются и связываются непосредственно в приложение.  Подключаемые и связанные сериализаторы функционируют через идентичные открытые методы и события, упрощающие использование любого из этих типов сериализаторов (или обоих типов) в приложении.  
  
 Подключаемые сериализаторы помогают разработчикам приложений, обеспечивая расширяемость новых проектируемых систем хранения и файловых форматов и избавляя от необходимости создавать код напрямую для каждого потенциального формата во время создания.  Подключаемые сериализаторы помогают и сторонним разработчикам, предоставляя стандартизированные средства развертывания, установки и обновления доступных системе подключаемых модулей для пользовательских или собственных форматов файлов.  
  
### <a name="using-a-plug-in-serializer"></a>Использование подключаемого сериализатора  
 Использовать подключаемые сериализаторы достаточно просто.  <xref:System.Windows.Documents.Serialization.SerializerProvider> Перечисляет класс <xref:System.Windows.Documents.Serialization.SerializerDescriptor> объекта для каждого подключаемого модуля установлена в системе.  <xref:System.Windows.Documents.Serialization.SerializerDescriptor.IsLoadable%2A> Свойство фильтрует установленные подключаемые модули, на основе текущей конфигурации и проверяет, что сериализатор можно загружать и используемые приложением.  <xref:System.Windows.Documents.Serialization.SerializerDescriptor> Также предоставляет другие свойства, такие как <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DisplayName%2A> и <xref:System.Windows.Documents.Serialization.SerializerDescriptor.DefaultFileExtension%2A>, который приложение может использовать, чтобы предложить пользователю выбрать сериализатор для доступного формата вывода.  Подключаемый модуль сериализатора по умолчанию для [!INCLUDE[TLA2#tla_xps](../../../../includes/tla2sharptla-xps-md.md)] входит в состав .NET Framework и всегда перечисляется.  После выбора пользователем формата для вывода, <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> метод используется для создания <xref:System.Windows.Documents.Serialization.SerializerWriter> для заданного формата.  <xref:System.Windows.Documents.Serialization.SerializerWriter>.<xref:System.Windows.Documents.Serialization.SerializerWriter.Write%2A> Затем, метод может вызываться для вывода потока документов в хранилище данных.  
  
 В следующем примере показано приложение, использующее <xref:System.Windows.Documents.Serialization.SerializerProvider> метод в свойстве «Свойство PlugInFileFilter».  Свойство PlugInFileFilter перечисляет установленные подключаемые модули и создает строку фильтра с доступными файловыми параметрами для <xref:Microsoft.Win32.SaveFileDialog>.  
  
 [!code-csharp[DocumentSerialize#DocSerializeFileFilter](~/samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializefilefilter)]  
  
 После выбора пользователем имя выходного файла, в следующем примере показано использование <xref:System.Windows.Documents.Serialization.SerializerProvider.CreateSerializerWriter%2A> для сохранения заданного документа в указанном формате.  
  
 [!code-csharp[DocumentSerialize#DocSerializePlugIn](~/samples/snippets/csharp/VS_Snippets_Wpf/DocumentSerialize/CSharp/ThumbViewer.cs#docserializeplugin)]  
  
<a name="InstallingPluginSerializers"></a>   
### <a name="installing-plug-in-serializers"></a>Установка подключаемых сериализаторов  
 <xref:System.Windows.Documents.Serialization.SerializerProvider> Класс предоставляет интерфейс приложений верхнего уровня для обнаружения подключаемых сериализаторов и доступа.  <xref:System.Windows.Documents.Serialization.SerializerProvider> Находит и предоставляет приложению список сериализаторов, которые установлены и доступны в системе.  Особенности установленных сериализаторов определяются через параметры реестра.  Подключаемые сериализаторы можно добавить в реестр с помощью <xref:System.Windows.Documents.Serialization.SerializerProvider.RegisterSerializer%2A> метода; или если .NET Framework еще не установлена, сценарий установки подключаемого модуля может непосредственно задать реестра значения.  <xref:System.Windows.Documents.Serialization.SerializerProvider.UnregisterSerializer%2A> Метод может использоваться для удаления ранее установленного подключаемого модуля или параметры реестра можно сбросить аналогично удалению скрипта.  
  
### <a name="creating-a-plug-in-serializer"></a>Создание подключаемого сериализатора  
 Подключаемые и связанные сериализаторы используют одинаковые предоставленные открытые методы и события, и их также можно настроить для синхронной и асинхронной работы.  Для создания подключаемого сериализатора, как правило, требуется выполнить три шага.  
  
1. Реализация и отладка сериализатора сначала в виде связанного сериализатора.  Изначально создание сериализатора, скомпилированного и связанного непосредственно в тестовом приложении, предоставляет полный доступ к точкам останова и другим полезным для тестирования отладочным службам.  
  
2. После полного тестирования сериализатора <xref:System.Windows.Documents.Serialization.ISerializerFactory> интерфейс будет добавлен для создания подключаемого модуля.  <xref:System.Windows.Documents.Serialization.ISerializerFactory> Интерфейс обеспечивает полный доступ ко всем объектам .NET Framework, включая логическое дерево, <xref:System.Windows.UIElement> объектов, <xref:System.Windows.Documents.IDocumentPaginatorSource>, и <xref:System.Windows.Media.Visual> элементов.  Кроме того <xref:System.Windows.Documents.Serialization.ISerializerFactory> предоставляет те же синхронные и асинхронные методы и события, которые используются связанными сериализаторами.  Поскольку на вывод крупных документов может потребоваться время, рекомендуется использовать асинхронные операции, чтобы сохранить возможность взаимодействия с пользователем и предоставить возможность отмены, если с источником данных произойдет проблема.  
  
3. После создания подключаемого сериализатора сценарий установки реализуется для распространения и установки (и удаления) подключаемого модуля (см. [Установка подключаемых сериализаторов](#InstallingPluginSerializers) выше).  
  
## <a name="see-also"></a>См. также

- <xref:System.Windows.Documents.Serialization>
- <xref:System.Windows.Xps.XpsDocumentWriter>
- <xref:System.Windows.Xps.Packaging.XpsDocument>
- [Документы в WPF](documents-in-wpf.md)
- [Общие сведения о печати](printing-overview.md)
- [XML Paper Specification: Обзор](https://go.microsoft.com/fwlink?LinkID=106246)
