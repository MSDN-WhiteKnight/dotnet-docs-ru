---
title: Достижение максимальной производительности WPF 3D
ms.date: 03/30/2017
helpviewer_keywords:
- 3-D graphics [WPF]
ms.assetid: 4bcf949d-d92f-4d8d-8a9b-1e4c61b25bf6
ms.openlocfilehash: 8629748c37aae8e35bb928c5a8d5a9caa7046942
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2019
ms.locfileid: "59147528"
---
# <a name="maximize-wpf-3d-performance"></a>Достижение максимальной производительности WPF 3D
При использовании [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] для создания трехмерных элементов управления и включения трехмерных сцен в приложениях, важно рассмотреть вопрос оптимизации производительности. Здесь представлен список 3D классов и свойств, которые влияют на производительность приложения, а также рекомендации по оптимизации производительности при их использовании.  
  
 В этом разделе предполагается, что хорошо знакомы с [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] трехмерные функции. В этом документе приводятся советы для «уровень отрисовки 2» — примерно определяется как оборудование, поддерживающее версия построителя текстуры 2.0 и вершинный построитель текстуры версии 2.0. Дополнительные сведения см. в разделе [уровни отрисовки графики](../advanced/graphics-rendering-tiers.md).  
  
## <a name="performance-impact-high"></a>Влияние на производительность: High  
  
|Свойство|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Brush>|Скорость кисти (от самой быстрой к самой медленной):<br /><br /> <xref:System.Windows.Media.SolidColorBrush><br /><br /> <xref:System.Windows.Media.LinearGradientBrush><br /><br /> <xref:System.Windows.Media.ImageBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush> (с кэшированием)<br /><br /> <xref:System.Windows.Media.VisualBrush> (с кэшированием)<br /><br /> <xref:System.Windows.Media.RadialGradientBrush><br /><br /> <xref:System.Windows.Media.DrawingBrush> (без кэширования).<br /><br /> <xref:System.Windows.Media.VisualBrush> (без кэширования).|  
|<xref:System.Windows.UIElement.ClipToBoundsProperty>|Задайте `Viewport3D.ClipToBounds` значение false, если вы не обязательно должны иметь [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] явно усечение содержимого <xref:System.Windows.Controls.Viewport3D> прямоугольник Viewport3D. [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] Сглаженный обрезки может выполняться очень медленно, и `ClipToBounds` (медленно) включен по умолчанию на <xref:System.Windows.Controls.Viewport3D>.|  
|<xref:System.Windows.UIElement.IsHitTestVisible%2A>|Задайте `Viewport3D.IsHitTestVisible` значение false, если нет необходимости [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] рассмотреть содержимое <xref:System.Windows.Controls.Viewport3D> при выполнении проверки нажатия мыши.  Проверка нажатия трехмерного содержимого выполняется программным образом и может быть достаточно больших сеточных. <xref:System.Windows.UIElement.IsHitTestVisible%2A> (медленно) включен по умолчанию на <xref:System.Windows.Controls.Viewport3D>.|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D>|Создавайте различные модели только в том случае, когда им нужен различные материалы или преобразования.  В противном случае попробуйте объединить несколько <xref:System.Windows.Media.Media3D.GeometryModel3D> экземпляры с одним и тем же материалы и преобразования в несколько больших <xref:System.Windows.Media.Media3D.GeometryModel3D> и <xref:System.Windows.Media.Media3D.MeshGeometry3D> экземпляров.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Сетка анимации — Изменение отдельных вершин сетки на основе покадрового — не всегда эффективно в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)].  Чтобы свести к минимуму влияние на производительность уведомления об изменениях, при изменении каждой вершины, отсоедините сетку из визуального дерева до выполнения каждой вершины.  После сетки был изменен, снова присоедините ее к визуальному дереву.  Кроме того попробуйте минимизировать размер сетки, таким образом, будет анимирован.|  
|3D сглаживание|Чтобы увеличить скорость отрисовки, отключите мультисэмплинга на <xref:System.Windows.Controls.Viewport3D> , установив присоединенное свойство <xref:System.Windows.Media.RenderOptions.EdgeMode%2A> для `Aliased`.  По умолчанию, 3D сглаживание отключено на [!INCLUDE[TLA#tla_winxp](../../../../includes/tlasharptla-winxp-md.md)] и включены на [!INCLUDE[TLA#tla_longhorn](../../../../includes/tlasharptla-longhorn-md.md)] с 4 образцами на пиксель.|  
|Текста|Live текст в трехмерной сцене (live, так как он <xref:System.Windows.Media.DrawingBrush> или <xref:System.Windows.Media.VisualBrush>) может выполняться медленно. Попробуйте вместо этого использовать изображения текста (с помощью <xref:System.Windows.Media.Imaging.RenderTargetBitmap>) Если не приведет к изменению текста.|  
|<xref:System.Windows.Media.TileBrush>|Если необходимо использовать <xref:System.Windows.Media.VisualBrush> или <xref:System.Windows.Media.DrawingBrush> в трехмерной сцене, так как содержимое кисти не является статическим, попробуйте, кэшировать кисть (установив это присоединенное свойство <xref:System.Windows.Media.RenderOptions.CachingHint%2A> для `Cache`).  Пороги недействительности минимальный и максимальный масштаб (с помощью вложенных свойств <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMinimum%2A> и <xref:System.Windows.Media.RenderOptions.CacheInvalidationThresholdMaximum%2A>), чтобы кэшируемых кистей не будет повторно создать слишком часто, сохраняя при этом нужный уровень качества.  По умолчанию <xref:System.Windows.Media.DrawingBrush> и <xref:System.Windows.Media.VisualBrush> не кэшируются, это означает, что каждый раз, когда что-то закрашивается с кисть, которая должна быть повторно подготовленных к просмотру, все содержимое кисти сначала должен быть заново отрисовать промежуточных область.|  
|<xref:System.Windows.Media.Effects.BitmapEffect>|<xref:System.Windows.Media.Effects.BitmapEffect> заставляет все измененное содержимое будет отображаться без аппаратного ускорения.  Для наилучшей производительности, не используйте <xref:System.Windows.Media.Effects.BitmapEffect>.|  
  
## <a name="performance-impact-medium"></a>Влияние на производительность: Средняя  
  
|Свойство|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Когда сетки определяется как соседними треугольники с общими вершинами, и эти вершины имеют те же позиции, обычный и координаты текстуры, определите каждую общую вершину только один раз, а затем определите треугольники по индексу с <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>.|  
|<xref:System.Windows.Media.ImageBrush>|Попробуйте уменьшить размеры текстуры при наличии явного управления размер (при использовании <xref:System.Windows.Media.Imaging.RenderTargetBitmap> и/или <xref:System.Windows.Media.ImageBrush>).  Обратите внимание, что текстуры более низкого разрешения могут снизить качество изображения, поэтому следует найти правильный баланс между качеством и производительностью.|  
|Непрозрачность|При отрисовке прозрачные трехмерного содержимого (например отражений), используйте свойства непрозрачности кисти или материалов (с помощью <xref:System.Windows.Media.Brush.Opacity%2A> или <xref:System.Windows.Media.Media3D.DiffuseMaterial.Color%2A>) вместо создания отдельного прозрачные <xref:System.Windows.Controls.Viewport3D> , задав `Viewport3D.Opacity` значение меньше 1.|  
|<xref:System.Windows.Controls.Viewport3D>|Свести к минимуму количество <xref:System.Windows.Controls.Viewport3D> объектов, вы используете в сцене.  Поместите несколько 3D моделей в тот же Viewport3D, а не создавать отдельные экземпляры Viewport3D для каждой модели.|  
|<xref:System.Windows.Freezable>|Обычно это полезно для повторного использования <xref:System.Windows.Media.Media3D.MeshGeometry3D>, <xref:System.Windows.Media.Media3D.GeometryModel3D>, кистей и материалов.  Все являются multiparentable, так как они являются производными от `Freezable`.|  
|<xref:System.Windows.Freezable>|Вызовите <xref:System.Windows.Freezable.Freeze%2A> метод на объектах Freezable, если их свойства останется без изменений в приложении.  Замораживание можно уменьшить рабочего набора, а также повысить скорость.|  
|<xref:System.Windows.Media.Brush>|Используйте <xref:System.Windows.Media.ImageBrush> вместо <xref:System.Windows.Media.VisualBrush> или <xref:System.Windows.Media.DrawingBrush> при содержимое кисти не изменится.  2D-содержимого могут преобразовываться в <xref:System.Windows.Controls.Image> через <xref:System.Windows.Media.Imaging.RenderTargetBitmap> , а затем использовать в <xref:System.Windows.Media.ImageBrush>.|  
|<xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A>|Не используйте <xref:System.Windows.Media.Media3D.GeometryModel3D.BackMaterial%2A> бесполезно, если фактически см. в разделе с обратной стороны вашей <xref:System.Windows.Media.Media3D.GeometryModel3D>.|  
|<xref:System.Windows.Media.Media3D.Light>|Скорость света (самая быстрая к самой медленной):<br /><br /> <xref:System.Windows.Media.Media3D.AmbientLight><br /><br /> <xref:System.Windows.Media.Media3D.DirectionalLight><br /><br /> <xref:System.Windows.Media.Media3D.PointLight><br /><br /> <xref:System.Windows.Media.Media3D.SpotLight>|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Попробуйте сохранять размер сетки в эти ограничения:<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>: 20 001 <xref:System.Windows.Media.Media3D.Point3D> экземпляров<br /><br /> <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>: 60,003 <xref:System.Int32> экземпляров|  
|<xref:System.Windows.Media.Media3D.Material>|Скорость материала (самая быстрая к самой медленной):<br /><br /> <xref:System.Windows.Media.Media3D.EmissiveMaterial><br /><br /> <xref:System.Windows.Media.Media3D.DiffuseMaterial><br /><br /> <xref:System.Windows.Media.Media3D.SpecularMaterial>|  
|<xref:System.Windows.Media.Brush>|[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] Объемные эффекты не отказывается от невидимых кистей (черных кистей окружения, кистей очистки и т.д.) согласованным образом.  Рассмотрите возможность отказаться от сцены этих средств.|  
|<xref:System.Windows.Media.Media3D.MaterialGroup>|Каждый <xref:System.Windows.Media.Media3D.Material> в <xref:System.Windows.Media.Media3D.MaterialGroup> вызывает передачу другого отрисовки, таким образом, включая множество материалов, даже простое материалам, может существенно увеличить нагрузку заливки на установленный GPU.  Свести к минимуму количество материалов в вашей <xref:System.Windows.Media.Media3D.MaterialGroup>.|  
  
## <a name="performance-impact-low"></a>Влияние на производительность: Low  
  
|Свойство|Рекомендация|  
|-|-|  
|<xref:System.Windows.Media.Media3D.Transform3DGroup>|При анимации не требуется или привязки данных, вместо использования преобразования группы, содержащей несколько преобразований, использовать единую <xref:System.Windows.Media.Media3D.MatrixTransform3D>, настроив на будет произведением всех преобразований, которые в противном случае будет существовать независимо друг от друга в группе преобразования.|  
|<xref:System.Windows.Media.Media3D.Light>|Свести к минимуму количество освещения в сцене. Слишком большое количество источников света в сцене заставит [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] на переключение на программную отрисовку.  Эти ограничения действуют примерно 110 <xref:System.Windows.Media.Media3D.DirectionalLight> объектов, 70 <xref:System.Windows.Media.Media3D.PointLight> объектов или 40 <xref:System.Windows.Media.Media3D.SpotLight> объектов.|  
|<xref:System.Windows.Media.Media3D.ModelVisual3D>|Разделите перемещения объектов из статических объектов, помещая их в отдельных <xref:System.Windows.Media.Media3D.ModelVisual3D> экземпляров.  ModelVisual3D «тяжелее» <xref:System.Windows.Media.Media3D.GeometryModel3D> так, как он кэширует преобразованные границы.  GeometryModel3D оптимизирован для модели. ModelVisual3D оптимизирован для узел сцены.  Используйте ModelVisual3D для размещения общих экземпляров объекта GeometryModel3D в сцене.|  
|<xref:System.Windows.Media.Media3D.Light>|Свести к минимуму количество раз, изменять число источников света на сцене.  Каждое изменение числа источников света заставляет повторного создания шейдера и повторной компиляции, если ранее существовал конфигурации (и тем самым ее построитель уже кэширован).|  
|Светлый|Черные источники света не будут отображаться, но будут увеличивать время построения. Рассмотрите возможность отказаться от них.|  
|<xref:System.Windows.Media.Media3D.MeshGeometry3D>|Чтобы свести к минимуму время создания больших коллекций в [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)], например MeshGeometry3D <xref:System.Windows.Media.Media3D.MeshGeometry3D.Positions%2A>, <xref:System.Windows.Media.Media3D.MeshGeometry3D.Normals%2A>, <xref:System.Windows.Media.Media3D.MeshGeometry3D.TextureCoordinates%2A>, и <xref:System.Windows.Media.Media3D.MeshGeometry3D.TriangleIndices%2A>, предварительно размер коллекции, перед заполнением значение. Если это возможно передайте коллекции конструкторов предварительно заполненных такие структуры данных, массивов или списков.|  
  
## <a name="see-also"></a>См. также

- [Обзор трехмерной графики](3-d-graphics-overview.md)
