---
title: Общие сведения о приложениях браузера WPF XAML
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- XBAP [WPF], XAML browser application
- WPF XAML browser applications (XBAP)
- XAML browser applications (XBAP)
- browser-hosted applications [WPF]
ms.assetid: 3a7a86a8-75d5-4898-96b9-73da151e5e16
ms.openlocfilehash: 81ae93871fa5e3fc46382ee9a1810808574fb043
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/09/2019
ms.locfileid: "59320136"
---
# <a name="wpf-xaml-browser-applications-overview"></a>Общие сведения о приложениях браузера WPF XAML
<a name="introduction"></a>
[!INCLUDE[TLA#tla_xbap#plural](../../../../includes/tlasharptla-xbapsharpplural-md.md)] объединяет возможности веб-приложений и многофункциональных клиентских приложений. Как веб-приложения, XBAP можно развертывать на веб-сервере и запускать из Internet Explorer или Firefox. Как многофункциональные клиентские приложения XBAP могут воспользоваться преимуществами возможностей WPF. Кроме того, XBAP разрабатываются аналогично многофункциональным клиентским приложениям. Этот раздел содержит простое, общее введение в разработку XBAP и показывает, чем она отличается от разработки стандартных многофункциональных клиентов.  
  
 В этом разделе содержатся следующие подразделы.  
  
-   [Создание приложения обозревателя XAML (XBAP)](#creating_a_new_xaml_browser_application_xbap)  
  
-   [Развертывание XBAP](#deploying_a_xbap)  
  
-   [Связь с веб-страницей размещения](#communicating_with_the_host_web_page)  
  
-   [Вопросы безопасности XBAP](#xbap_security_considerations)  
  
-   [Влияние времени запуска XBAP на производительность](#xbap_start_time_performance_considerations)  
  
<a name="creating_a_new_xaml_browser_application_xbap"></a>   
## <a name="creating-a-new-xaml-browser-application-xbap"></a>Создание приложения обозревателя XAML (XBAP)  
 Самый простой способ создать проект XBAP — с помощью Microsoft Visual Studio. При создании нового проекта выберите из списка шаблонов **приложение браузера WPF**. Дополнительные сведения см. в разделе [Как Создание нового проекта приложения браузера WPF](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/bb628663(v=vs.100)).  
  
 При запуске проект XBAP откроется в окне браузера, а не в отдельном окне. При отладке XBAP в Visual Studio, приложение запускается с разрешениями зоны Интернета и, следовательно, если эти разрешения будут превышены исключения безопасности. Дополнительные сведения см. в разделах [Безопасность](../security-wpf.md) и [Безопасность частичного доверия в WPF](../wpf-partial-trust-security.md).  
  
> [!NOTE]
>  Если вы не разрабатываете с помощью Visual Studio или желаете узнать больше о файлы проекта, см. в разделе [построение приложения WPF](building-a-wpf-application-wpf.md).  
  
<a name="deploying_a_xbap"></a>   
## <a name="deploying-an-xbap"></a>Развертывание XBAP  
 При построении XBAP создаются следующие три файла:  
  
|Файл|Описание|  
|----------|-----------------|  
|Исполняемый файл (.EXE)|Содержит скомпилированный код и имеет расширение EXE.|  
|Манифест приложения (.MANIFEST)|Содержит метаданные, связанные с приложением, и имеет расширение MANIFEST.|  
|Манифест развертывания (.XBAP)|Этот файл содержит сведения, что ClickOnce использует для развертывания приложения и имеет расширение XBAP.|  
  
 XBAP развертывается на веб-сервере, например [!INCLUDE[TLA#tla_iis50](../../../../includes/tlasharptla-iis50-md.md)] или более поздней версии. Необходимо установить .NET Framework на веб-сервере, но вам необходимо зарегистрировать [!INCLUDE[TLA2#tla_wpf](../../../../includes/tla2sharptla-wpf-md.md)] [!INCLUDE[TLA#tla_mime](../../../../includes/tlasharptla-mime-md.md)] типы и расширения имен файлов. Дополнительные сведения см. в разделе [Практическое руководство. Настройка служб IIS 5.0 и IIS 6.0 для развертывания приложений WPF](how-to-configure-iis-5-0-and-iis-6-0-to-deploy-wpf-applications.md).  
  
 Чтобы подготовить XBAP для развертывания, скопируйте файл EXE и связанные с ним манифесты на веб-сервер. Создайте HTML-страницу, содержащую гиперссылку, чтобы открыть манифест развертывания, который является файлом с расширением XBAP. Когда пользователь щелкает ссылку на файл XBAP, ClickOnce автоматически обрабатывает механизм загрузки и запуска приложения. В следующем примере кода показана HTML-страница, которая содержит гиперссылку, указывающую на XBAP.  
  
```html
<html>   
    <head></head>  
    <body>   
        <a href="XbapEx.xbap">Click this link to launch the application</a>  
    </body>   
</html>  
```  
  
 Кроме того, XBAP можно разместить во фрейме веб-страницы. Создайте веб-страницу с одним или несколькими фреймами. Назначьте исходное свойство фрейма файлу манифеста развертывания. Чтобы использовать встроенный механизм взаимодействия между веб-страницей размещения и XBAP, необходимо разместить приложение во фрейме. В следующем примере кода показана HTML-страница с двумя фреймами; в качестве источника для второго фрейма выбран XBAP.  
  
```html
<html>   
    <head>
        <title>A page with frames</title>
    </head>  
    <frameset cols="50%,50%">   
        <frame src="introduction.htm">   
        <frame src="XbapEx.xbap">   
    </frameset>   
</html>  
```  
  
### <a name="clearing-cached-xbaps"></a>Очистка кэшированных XBAP  
 В некоторых случаях после повторной сборки и запуска XBAP может оказаться, что открывается более ранняя версия XBAP. Это может произойти, например, если номер версии сборки XBAP статичен и XBAP запускается из командной строки. В этом случае в связи с тем, что номер кэшированной версии (версии, запущенной ранее) и новой версии остаются прежними, новая версия XBAP не загружается. Вместе нее загружается кэшированная версия.  
  
 В таких ситуациях можно удалить кэшированную версию с помощью **Mage** команды (устанавливается с Visual Studio или пакет SDK для Windows) в командной строке. Следующая команда очищает кэш приложения.  
  
 ```console
 Mage.exe -cc
 ```
  
 Она обеспечивает запуск последней версии XBAP. При отладке приложения в Visual Studio, должен запускаться последняя версия XBAP. Как правило, номер версии развертывания необходимо обновлять при каждой сборке. Дополнительные сведения о команде Mage см. в разделе [Mage.exe (средство создания и редактирования манифеста)](../../tools/mage-exe-manifest-generation-and-editing-tool.md).  
  
<a name="communicating_with_the_host_web_page"></a>   
## <a name="communicating-with-the-host-web-page"></a>Связь с веб-страницей размещения  
 Если приложение находится во фрейме HTML, вы можете взаимодействовать с веб-страницей, которая содержит XBAP. Это делается путем извлечения <xref:System.Windows.Interop.BrowserInteropHelper.HostScript%2A> свойство <xref:System.Windows.Interop.BrowserInteropHelper>. Оно возвращает объект скрипта, представляющий окно HTML. Доступ к свойствам, методам и событиям можно получить в [объекте окна](https://go.microsoft.com/fwlink/?LinkId=160274), используя обычный синтаксис с точками. Также можно получить доступ к методам скрипта и глобальным переменным. В следующем примере показано, как извлечь объект скрипта и закрыть браузер.  
  
 [!code-csharp[XbapBrowserInterop#10](~/samples/snippets/csharp/VS_Snippets_Wpf/xbapbrowserinterop/cs/page1.xaml.cs#10)]
 [!code-vb[XbapBrowserInterop#10](~/samples/snippets/visualbasic/VS_Snippets_Wpf/xbapbrowserinterop/vb/page1.xaml.vb#10)]  
  
### <a name="debugging-xbaps-that-use-hostscript"></a>Отладка XBAP, в котором используется HostScript  
 Если XBAP использует <xref:System.Windows.Interop.BrowserInteropHelper.HostScript%2A> объект для связи с окном HTML, существует два параметра, которые необходимо задать для запуска и отладки приложения в Visual Studio. Приложение должно иметь доступ к своему исходному сайту, а запустить его необходимо с HTML-страницы, которая содержит XBAP. Ниже описаны процедуры проверки двух этих параметров:  
  
1. В Visual Studio откройте свойства проекта.  
  
2. На вкладке **Безопасность** нажмите кнопку **Дополнительно**.  
  
     Откроется диалоговое окно "Дополнительные параметры безопасности".  
  
3. Убедитесь, что флажок **Предоставить приложению доступ к своему исходному сайту** установлен, и нажмите кнопку **ОК**.  
  
4. На вкладке **Отладка** выберите параметр **Запустить браузер, используя URL-адрес** и укажите URL-адрес HTML-страницы, содержащей XBAP.  
  
5. В Internet Explorer нажмите кнопку **Сервис** и выберите **Свойства обозревателя**.  
  
     Откроется диалоговое окно «Свойства веб-обозревателя».  
  
6. Откройте вкладку **Дополнительно** .  
  
7. В списке **Параметры** в разделе **Безопасность** установите флажок **Разрешать запуск активного содержимого файлов на моем компьютере**.  
  
8. Нажмите кнопку **ОК**.  
  
     Чтобы изменения вступили в силу, Internet Explorer необходимо перезапустить.  
  
> [!CAUTION]
>  Включение активного содержимого в Internet Explorer может подвергнуть компьютер риску. Если вы не хотите изменить параметры безопасности Internet Explorer, можно запустить HTML-страницу с сервера и присоединение к процессу отладчик Visual Studio.  
  
<a name="xbap_security_considerations"></a>   
## <a name="xbap-security-considerations"></a>Вопросы безопасности XBAP  
 Обычно XBAP выполняются в изолированной среде безопасности частичного доверия, ограниченной набором разрешений зоны Интернета. Следовательно ваша реализация должна поддерживать подмножество элементов WPF, которые поддерживаются в зоне Интернета, или необходимо повысить уровень разрешений приложения. Дополнительные сведения см. в разделе [Безопасность](../security-wpf.md).  
  
 При использовании <xref:System.Windows.Controls.WebBrowser> элемента управления в приложении WPF внутренним образом устанавливает собственный элемент управления WebBrowser ActiveX. Если ваше приложение — это XBAP частичного доверия, запущенный в браузере Internet Explorer, элемент управления ActiveX выполняется в выделенном потоке процесса Internet Explorer. В связи с этим применяются указанные ниже ограничения.  
  
-   <xref:System.Windows.Controls.WebBrowser> Элемент управления должен обеспечивать поведение, аналогичное браузеру узла, включая ограничения безопасности. Некоторыми из этих ограничений безопасности можно управлять с помощью параметров безопасности Internet Explorer. Дополнительные сведения см. в разделе [Безопасность](../security-wpf.md).  
  
-   Если XBAP загружается на HTML-странице в междоменном режиме, возникнет исключение.  
  
-   Входные данные поступают как отдельный поток из WPF <xref:System.Windows.Controls.WebBrowser>, поэтому ввод с клавиатуры перехватить нельзя, а состояние IME не является общим.  
  
-   Время или порядок навигации могут отличаться, если элемент управления ActiveX выполняется в другом потоке. Например, переход на какую-либо страницу не всегда отменяется при запуске другого запроса навигации.  
  
-   Настраиваемый элемент управления ActiveX может испытывать проблемы со связью, поскольку приложение WPF выполняется в отдельном потоке.  
  
-   <xref:System.Windows.Interop.HwndHost.MessageHook> вызывается, поскольку <xref:System.Windows.Interop.HwndHost> нельзя подкласс окно, выполняемое в другом потоке или процессе.  
  
### <a name="creating-a-full-trust-xbap"></a>Создание XBAP с полным доверием  
 Если XBAP требует полного доверия, проект можно изменить, предоставив ему соответствующее разрешение. Чтобы предоставить полное доверие, необходимо выполнить указанные ниже действия.  
  
1. В Visual Studio откройте свойства проекта.  
  
2. На вкладке **Безопасность** выберите параметр **Это приложение с полным доверием**.  
  
 При этом происходят следующие изменения:  
  
-   В файле проекта значение элемента `<TargetZone>` изменяется на `Custom`.  
  
-   В манифесте приложения (app.manifest) `Unrestricted="true"` добавляется атрибут "<xref:System.Security.PermissionSet> элемент.  
  
    ```xml
    <PermissionSet class="System.Security.PermissionSet"   
                   version="1"   
                   ID="Custom"   
                   SameSite="site"   
                   Unrestricted="true" />  
    ```  
  
### <a name="deploying-a-full-trust-xbap"></a>Развертывание XBAP с полным доверием  
 При развертывании XBAP с полным доверием, не основанного на модели доверенного развертывания ClickOnce, действия, выполняемые после того, как пользователь запустит приложение, зависят от зоны безопасности. В некоторых случаях пользователь получит предупреждение при попытке установить приложение. Пользователь может выбрать продолжение или отмену установки. В следующей таблице описаны поведение приложения для каждой зоны безопасности и действия, необходимые для получения приложением полного доверия.  
  
|Зона безопасности|Поведение|Получение полного доверия|  
|-------------------|--------------|------------------------|  
|Локальный компьютер|Автоматическое получение полного доверия|Никаких действий не требуется.|  
|Интрасеть и надежные веб-сайты|Запрос полного доверия|Подпишите приложение XBAP с помощью сертификата, чтобы пользователь видел источник в запросе.|  
|Интернет|Сбой с сообщением "Доверие не оказано"|Подпишите приложение XBAP с помощью сертификата.|  
  
> [!NOTE]
>  Поведение, описанное в предыдущей таблице, относится к приложениям XBAP с полным доверием, не следующим модели доверенного развертывания ClickOnce.  
  
 Для развертывания XBAP с полным доверием рекомендуется использовать модель доверенного развертывания ClickOnce. Она позволяет XBAP получать полное доверие автоматически, независимо от зоны безопасности и не запрашивая подтверждение пользователя. При использовании этой модели приложение должно быть подписано сертификатом надежного издателя. Дополнительные сведения см. в разделах [Общие сведения о развертывании доверенных приложений](/visualstudio/deployment/trusted-application-deployment-overview) и [Знакомство с подписыванием кода](https://go.microsoft.com/fwlink/?LinkId=166327).  
  
<a name="xbap_start_time_performance_considerations"></a>   
## <a name="xbap-start-time-performance-considerations"></a>Влияние времени запуска XBAP на производительность  
 Важную роль в производительности XBAP играет время его запуска. Если XBAP является первым загружаемым приложением WPF, время *холодного запуска* может составить от десяти секунд. Это связано с тем, что страницу хода выполнения обрабатывает WPF, а для того, чтобы отображать приложение, требуется холодный запуск CLR и WPF.  
  
 Начиная с версии [!INCLUDE[net_v35SP1_short](../../../../includes/net-v35sp1-short-md.md)], время холодного запуска XBAP уменьшается за счет того, что неуправляемая страница хода выполнения отображается на более раннем этапе цикла развертывания. Она открывается практически сразу после того, как приложение будет запущено, поскольку отображается машинным кодом размещения и выводится на экран в формате HTML.  
  
 Кроме того улучшенный параллелизм последовательности загрузки ClickOnce сокращает время запуска почти на десять процентов. После ClickOnce загрузит и проверит манифесты, запускается загрузка приложения и индикатор выполнения начинает обновляться.  
  
## <a name="see-also"></a>См. также

- [Настройка Visual Studio для отладки приложений браузера XAML для вызова веб-службы](configure-vs-to-debug-a-xaml-browser-to-call-a-web-service.md)
- [Развертывание приложения WPF](deploying-a-wpf-application-wpf.md)
