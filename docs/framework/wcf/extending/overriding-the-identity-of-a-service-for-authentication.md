---
description: Дополнительные сведения см. в статье переопределение удостоверения службы для проверки подлинности.
title: Переопределение идентификатора службы для проверки подлинности
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: f83c10d75c4ea71170a76a7fd10efb33958f5b52
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99644168"
---
# <a name="override-the-identity-of-a-service-for-authentication"></a>Переопределение удостоверения службы для проверки подлинности

Как правило, нет необходимости задавать удостоверение в службе, поскольку выбор типа учетных данных клиента определяет тип удостоверения, предоставляемого в метаданных службы. Например, следующий код конфигурации использует [\<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) элемент и задает `clientCredentialType` для атрибута значение Windows.  

 В следующем фрагменте WSDL (Web Services Description Language) показано удостоверение для ранее определенной конечной точки. В этом примере служба выполняется как самостоятельная служба с определенной учетной записью пользователя ( username@contoso.com ), поэтому удостоверение имени участника-пользователя (UPN) содержит имя учетной записи. UPN также называется именем входа пользователя в домене Windows.  

 Пример приложения, демонстрирующий настройку удостоверения, см. в разделе [Пример удостоверения службы](../samples/service-identity-sample.md). Дополнительные сведения об удостоверении службы см. в статье [удостоверение службы и проверка подлинности](../feature-details/service-identity-and-authentication.md).  
  
## <a name="kerberos-authentication-and-identity"></a>Проверка подлинности Kerberos и удостоверение  

 По умолчанию, если служба настроена для использования учетных данных Windows, [\<identity>](../../configure-apps/file-schema/wcf/identity.md) [\<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) [\<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) в WSDL-файле создается элемент, содержащий элемент или. Если служба выполняется под `LocalSystem` `LocalService` `NetworkService` учетной записью, или, то имя субъекта-службы (SPN) создается по умолчанию в форме, `host/` \<*hostname*> так как эти учетные записи имеют доступ к данным имени SPN компьютера. Если служба выполняется под другой учетной записью, Windows Communication Foundation (WCF) создает имя участника-пользователя в виде \<*username*> @< *имя_домена* `>` . Это происходит потому, что проверка подлинности Kerberos требует предоставления клиенту имени участника-пользователя или имени участника-службы для проверки подлинности службы.  
  
 Можно также использовать средство [setspn](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731241(v=ws.10)) для регистрации дополнительного имени субъекта-службы с учетной записью службы в домене. В этом случае имя участника-службы можно использовать в качестве удостоверения службы. Дополнительные сведения об этом средстве см. в разделе [Обзор SetSPN](/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).  
  
> [!NOTE]
> Чтобы использовать тип учетных данных Windows без согласования, учетная запись пользователя службы должна иметь доступ к имени участника службы (SPN), зарегистрированному с доменом Active Directory. Это можно сделать следующими способами:  
  
- Используйте учетную запись NetworkService или LocalSystem для запуска службы. Поскольку эти учетные записи имеют доступ к имени участника-службы (SPN), установленному при присоединении компьютера к домену Active Directory, WCF автоматически создает соответствующий элемент SPN в конечной точке службы в метаданных службы (WSDL).  
  
- Запустите службу из любой учетной записи домена Active Directory. В данном случае с помощью служебного средства Setspn.exe необходимо установить имя участника-службы для этой учетной записи домена. После создания имени субъекта-службы для учетной записи службы настройте WCF, чтобы опубликовать это SPN для клиентов службы с помощью метаданных (WSDL). Для этого нужно настроить удостоверение конечной точки для предоставляемой конечной точки в файле конфигурации приложения или в коде.  
  
 Дополнительные сведения об именах участников-служб, протоколе Kerberos и Active Directory см. в статье [Техническая поддержка Kerberos для Windows](/previous-versions/msp-n-p/ff649429(v=pandp.10)).  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a>Если имя участника-службы или имя участника-пользователя равно пустой строке  

 Если задать имя участника-службы или имя участника-пользователя равным пустой строке, возможны разные варианты развития событий в зависимости от используемых уровня безопасности и режима проверки подлинности.  
  
- Если используется безопасность на уровне транспорта, выбирается проверка подлинности по протоколу NT LanMan (NTLM).  
  
- Если используется безопасность на уровне сообщения, при проверке подлинности в зависимости от используемого режима проверки подлинности может произойти сбой.  
  
- Если используется `spnego` режим и `AllowNtlm` для атрибута задано значение `false` , проверка подлинности завершается неудачно.  
  
- Если используется `spnego` режим и `AllowNtlm` для атрибута задано значение `true` , проверка подлинности завершается неудачей, если имя участника-пользователя пустое, но если имя субъекта-службы пусто.  
  
- При использовании протокола Kerberos напрямую (этот процесс также известен как "одноступенчатая" проверка) происходит сбой проверки подлинности.  
  
### <a name="use-the-identity-element-in-configuration"></a>Использование \<identity> элемента в конфигурации  

 При изменении типа учетных данных клиента в привязке, ранее показанной в `Certificate` , созданный WSDL-документ содержит сериализованный сертификат X. 509 Base64 для значения Identity, как показано в следующем коде. Используется по умолчанию для всех типов учетных данных клиентов, за исключением Windows.  

 Можно изменить значение удостоверения службы по умолчанию или изменить тип удостоверения, используя `identity` элемент <> в конфигурации или указав удостоверение в коде. В следующем коде конфигурации задается идентификатор DNS со значением `contoso.com`.  

### <a name="set-identity-programmatically"></a>Программное задание удостоверения  

 Службе не нужно явно указывать удостоверение, так как WCF автоматически определяет ее. Однако при необходимости WCF позволяет указать удостоверение в конечной точке. В приведенном ниже примере кода добавляется новая конечная точка службы с определенным идентификатором DNS.  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a>См. также

- [Практическое руководство. Создание пользовательского средства проверки идентификации клиентов](how-to-create-a-custom-client-identity-verifier.md)
- [Идентификация и проверка подлинности службы](../feature-details/service-identity-and-authentication.md)
