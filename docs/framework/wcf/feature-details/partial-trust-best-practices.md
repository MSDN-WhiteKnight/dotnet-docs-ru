---
description: 'Дополнительные сведения: рекомендации по частичному доверию'
title: Рекомендации по частичному доверию
ms.date: 03/30/2017
ms.assetid: 0d052bc0-5b98-4c50-8bb5-270cc8a8b145
ms.openlocfilehash: abdc0fbbb84581b302bca8d514a5f8f5cc2703e6
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99733558"
---
# <a name="partial-trust-best-practices"></a>Рекомендации по частичному доверию

В этом разделе описываются рекомендации при работе Windows Communication Foundation (WCF) в среде с частичным доверием.

## <a name="serialization"></a>Сериализация

При использовании <xref:System.Runtime.Serialization.DataContractSerializer> в частично доверенном приложении следуйте указанным ниже рекомендациям.

- Все сериализуемые типы должны быть явно отмечены атрибутом `[DataContract]`. В среде с частичным доверием следующие методы не поддерживаются:

- маркирование сериализуемых классов атрибутом <xref:System.SerializableAttribute>;

- реализация интерфейса <xref:System.Runtime.Serialization.ISerializable>, чтобы класс мог управлять своим процессом сериализации.

### <a name="using-datacontractserializer"></a>Использование DataContractSerializer

- Все типы, отмеченные атрибутом `[DataContract]`, должны быть открытыми. Сериализация неоткрытых типов в среде с частичным доверием невозможна.

- Все члены `[DataContract]` в сериализуемом типе `[DataContract]` должны быть открытыми. Сериализация типа с неоткрытым членом `[DataMember]` в среде с частичным доверием невозможна.

- Методы, обрабатывающие события сериализации (например, `OnSerializing`, `OnSerialized`, `OnDeserializing` и `OnDeserialized`) должны быть объявлены как открытые. Однако поддерживаются явные и неявные реализации <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29>.

- Типы `[DataContract]`, реализованные в сборках, отмеченных атрибутом <xref:System.Security.AllowPartiallyTrustedCallersAttribute>, не должны выполнять в конструкторе типа действия, связанные с безопасностью, так как <xref:System.Runtime.Serialization.DataContractSerializer> не вызывает конструктор вновь созданного объекта во время десериализации. В частности, для типов `[DataContract]` следует избегать использования указанных ниже общих методов обеспечения безопасности:

- попытка ограничить доступ с частичным доверием, делая конструктор типа внутренним или закрытым;

- ограничение доступа к типу путем добавления `[LinkDemand]` в конструктор типа;

- предположение об успешном прохождении любых принудительно выполняемых конструктором проверок правильности в случае успешного создания объекта.

### <a name="using-ixmlserializable"></a>Использование IXmlSerializable

Ниже приведены рекомендации для типов, которые реализуют интерфейс <xref:System.Xml.Serialization.IXmlSerializable> и сериализуются с помощью <xref:System.Runtime.Serialization.DataContractSerializer>.

- Реализации статического метода <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> должны быть `public`.

- Методы экземпляров, которые реализуют интерфейс <xref:System.Xml.Serialization.IXmlSerializable>, должны быть `public`.

## <a name="using-wcf-from-fully-trusted-platform-code-that-allows-calls-from-partially-trusted-callers"></a>Использование WCF из кода полностью доверенной платформы, который разрешает вызовы от частично доверенных вызывающих

Модель безопасности с частичным доверием WCF предполагает, что любой вызывающий объект общедоступного метода или свойства WCF выполняется в контексте разграничения доступа кода (CAS) размещающего приложения. WCF также предполагает, что для каждого существует только один контекст безопасности приложения <xref:System.AppDomain> , и что этот контекст устанавливается во <xref:System.AppDomain> время создания доверенным узлом (например, путем вызова <xref:System.AppDomain.CreateDomain%2A> или диспетчером приложений ASP.NET).

Эта модель безопасности применяется для написанных пользователем приложений, которые не могут утвердить дополнительные разрешения на управление доступом для кода. Примером такого приложения является пользовательский код, выполняющийся в приложении ASP.NET со средним уровнем доверия. Однако код полностью доверенной платформы (например, сборка стороннего разработчика, установленная в глобальном кэше сборок и принимающая вызовы из частично доверенного кода) должен соблюдать явную осторожность при вызове WCF от имени частично доверенного приложения, чтобы избежать возникновения уязвимостей безопасности на уровне приложения.

Код с полным доверием не должен изменять набор разрешений CAS текущего потока (путем вызова <xref:System.Security.PermissionSet.Assert%2A> , <xref:System.Security.PermissionSet.PermitOnly%2A> или <xref:System.Security.PermissionSet.Deny%2A> ) до вызова API WCF от имени частично доверенного кода. Утверждение, отклонение или создание контекста разрешений потока, который не зависит от контекста безопасности уровня приложения, может привести к непредвиденному поведению. В зависимости от приложения такое поведение может стать причиной появления уязвимых с точки зрения безопасности мест на уровне приложения.

Код, который вызывает WCF с помощью контекста разрешений для конкретного потока, должен быть готов к обработке следующих ситуаций, которые могут возникнуть:

- Контекст безопасности потока может не поддерживаться в ходе выполнения операции, что приводит к потенциальным исключениям, связанным с безопасностью.

- Внутренний код WCF, а также любые предоставляемые пользователем обратные вызовы могут выполняться в контексте безопасности, отличном от контекста, в котором был изначально инициирован вызов. К таким контекстам относятся следующие.

  - Контекст разрешений приложения.

  - Любой контекст разрешений для конкретного потока, ранее созданный другими пользовательскими потоками, которые использовались для вызова WCF в течение времени существования выполняющегося <xref:System.AppDomain> .

WCF гарантирует, что частично доверенный код не сможет получить разрешения полного доверия, если только эти разрешения не будут утверждены полностью доверенным компонентом до вызова общедоступных API-интерфейсов WCF. Однако она не гарантирует, что результаты утверждения полного доверия изолируются для конкретного потока, операции или действия пользователя.

Рекомендуется избегать создания контекста разрешений потока посредством вызова <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A> или <xref:System.Security.PermissionSet.Deny%2A>. Вместо этого предоставьте привилегию самому приложению или отклоните ее, чтобы вызывать <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.Deny%2A> или <xref:System.Security.PermissionSet.PermitOnly%2A> не требовалось.

## <a name="see-also"></a>См. также

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Xml.Serialization.IXmlSerializable>
