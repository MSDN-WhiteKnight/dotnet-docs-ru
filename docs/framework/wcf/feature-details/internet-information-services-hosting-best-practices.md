---
description: 'Дополнительные сведения: рекомендации по размещению службы IIS'
title: Рекомендации по размещению в службах IIS
ms.date: 03/30/2017
ms.assetid: 0834768e-9665-46bf-86eb-d4b09ab91af5
ms.openlocfilehash: 6a17d28977fba83d50e54672fa8e79979f130c4d
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99802753"
---
# <a name="internet-information-services-hosting-best-practices"></a>Рекомендации по размещению в службах IIS

В этом разделе описаны некоторые рекомендации по размещению служб Windows Communication Foundation (WCF).  
  
## <a name="implementing-wcf-services-as-dlls"></a>Реализация служб WCF в виде библиотек DLL  

 Реализация службы WCF в виде библиотеки DLL, развернутой в каталоге \Bin веб-приложения, позволяет повторно использовать службу вне модели веб-приложения, например в тестовой среде, которая может не иметь развернутых службы IIS (IIS).  
  
## <a name="service-hosts-in-iis-hosted-applications"></a>Ведущие приложения служб в приложениях, размещенных в IIS  

 Не используйте принудительные API-интерфейсы самообслуживания для создания новых узлов служб, которые прослушивают транспорты сети, не поддерживаемые средой размещения IIS (например, IIS 6,0 для размещения служб TCP, так как в IIS 6,0 изначально не поддерживается связь по протоколу TCP). Этот подход не рекомендуется. Ведущие приложения служб, созданные принудительно, в среде размещения IIS неизвестны. Ключевым пунктом является то, что обработка, выполненная принудительно созданными службами, не принимается во внимание системой IIS, когда она определяет, простаивает ли пул ведущих приложений. В результате приложения, где есть такие принудительно созданные ведущие приложения служб, имеют среду размещения IIS, которая агрессивно удаляет ведущие процессы IIS.  
  
## <a name="uris-and-iis-hosted-endpoints"></a>Универсальные коды ресурсов (URI) и размещенные в IIS конечные точки  

 Конечные точки для службы, размещенной в IIS, должны быть настроены с использованием относительных универсальных кодов ресурсов (URI), а не абсолютных адресов. При этом гарантируется попадание адреса конечной точки в ряд адресов URI, принадлежащих ведущему приложению, и обеспечивается надлежащая активация на основе сообщений.  
  
## <a name="state-management-and-process-recycling"></a>Управление состоянием и перезапуск процессов  

 Среда размещения IIS оптимизирована для служб, не поддерживающих локальное состояние в памяти. При появлении множества внешних и внутренних событий система IIS перезапускает ведущий процесс, в результате чего любое непостоянное состояние, сохраненное только в памяти, теряется. Службы, размещенные в IIS, должны сохранять свое состояние во внешней по отношению к процессу среде (например, в базе данных) или в расположенном в памяти кэше, который в случае перезапуска приложения может быть легко восстановлен.  
  
> [!NOTE]
> Протоколы, используемые WCF для обеспечения надежности и безопасности уровня сообщений, используют переменное состояние в памяти. Надежные сеансы и сеансы безопасности WCF могут неожиданно завершить работу из-за перезапуска приложения. Приложения, размещаемые в IIS, которые используют эти протоколы, должны зависеть от ключа сеанса, предоставленного WCF, для корреляции состояния уровня приложения (например, конструкции уровня приложения или настраиваемого заголовка корреляции) или отключения перезапуска процессов IIS для размещенного приложения.  
  
## <a name="optimizing-performance-in-middle-tier-scenarios"></a>Оптимизация производительности в сценариях среднего уровня  

 Для оптимальной производительности в *сценарии среднего уровня*— служба, которая обращается к другим службам в ответ на входящие сообщения — создает экземпляр клиента службы WCF для удаленной службы и повторно использует его для нескольких входящих запросов. Создание экземпляров клиентов службы WCF является дорогостоящей операцией, выполняемой при вызове службы на уже существующем экземпляре клиента, а сценарии среднего уровня создают отдельный выигрыш в производительности за счет кэширования удаленных клиентов по запросам. Клиенты службы WCF являются потокобезопасными, поэтому нет необходимости синхронизировать доступ к клиенту в нескольких потоках.  
  
 Увеличение производительности в сценариях среднего уровня обеспечивается также благодаря использованию асинхронных интерфейсов API, создаваемых параметром `svcutil /a`. `/a`Параметр приводит к тому, что [средство служебной программы метаданных ServiceModel (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) создает `BeginXXX/EndXXX` методы для каждой операции службы, что позволяет выполнять длительные вызовы удаленных служб в фоновых потоках.  
  
## <a name="wcf-in-multi-homed-or-multi-named-scenarios"></a>WCF в многосетевых сценариях и сценариях со многими именами  

 Службы WCF можно развернуть внутри веб-фермы IIS, где набор компьютеров совместно используют общее внешнее имя (например `http://www.contoso.com` ,), но по отдельности обрабатываются разными именами узлов (например, `http://www.contoso.com` может направить трафик на два разных компьютера с именем `http://machine1.internal.contoso.com` и `http://machine2.internal.contoso.com` ). Этот сценарий развертывания полностью поддерживается в WCF, но требует специальной настройки веб-сайта IIS, на котором размещены службы WCF, для вывода правильного (внешнего) имени узла в метаданных службы (язык описания веб-служб).  
  
 Чтобы обеспечить отображение правильного имени узла в метаданных службы, создаваемых WCF, настройте удостоверение по умолчанию для веб-сайта IIS, на котором размещены службы WCF, для использования явного имени узла. Например, компьютеры, расположенные внутри фермы, `www.contoso.com` должны использовать привязку сайта IIS *: 80: www. contoso. com для HTTP и \* : 443: www. contoso. com для HTTPS.  
  
 Привязки веб-узла IIS можно настроить с помощью оснастки консоли управления (MMC) IIS.  
  
## <a name="application-pools-running-in-different-user-contexts-overwrite-assemblies-from-other-accounts-in-the-temporary-folder"></a>Пулы приложений, работающие в разных контекстах пользователей, которые перезаписывают сборки из других учетных записей во временной папке  

 Чтобы пулы приложений, работающие в разных контекстах пользователя, не переписывали сборки из других учетных записей в папке Temporary ASP.NET Files, используйте для разных приложений разные удостоверения и временные папки. Например, если имеется два виртуальных приложения /Application1 и / Application2, можно создать два пула приложений (A и B) с двумя разными идентификаторами. Пул приложений A может работать под одним идентификатором пользователя (user1), а пул приложений B - под другим идентификатором пользователя (user2). Настройте приложение /Application1 на использование пула A, а приложение /Application2 - на использование пула B.  
  
 В Web.config можно настроить временную папку с помощью \<system.web/compilation/@tempFolder> . Для/Application1 может быть "c:\tempForUser1", а для классического — "c:\tempForUser2". Предоставьте соответствующее разрешение на запись в эти папки для двух идентификаторов.  
  
 В этом случае пользователь user2 не может изменить папку создания кода для приложения /application2 (в папке c:\tempForUser1).  
  
## <a name="enabling-asynchronous-processing"></a>Включение асинхронной обработки  

 По умолчанию сообщения, отправляемые в службу WCF, размещенную в IIS 6,0 и более ранних версиях, обрабатываются синхронно. ASP.NET вызывает WCF в собственном потоке (рабочий поток ASP.NET), а WCF использует другой поток для обработки запроса. WCF удерживает рабочий поток ASP.NET до завершения обработки. В результате обработка запросов выполняется синхронно. Асинхронная обработка запросов обеспечивает более высокую масштабируемость, поскольку уменьшает количество потоков, необходимых для обработки запроса — WCF не удерживает поток ASP.NET во время обработки запроса. Использовать асинхронное поведение не рекомендуется для компьютеров с IIS 6,0, так как нет способа регулирования входящих запросов, которые открывают сервер для атак *типа "отказ в обслуживании"* (DOS). Начиная с версии IIS 7.0, реализовано регулирование параллельных запросов: `[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0]"MaxConcurrentRequestsPerCpu`. Новая система регулирования гарантирует безопасность использования асинхронной обработки.  По умолчанию в IIS 7.0 регистрируются асинхронные обработчик и модуль. Если эта функция выключена, то можно вручную включить асинхронную обработку запросов в файле Web.config приложения. Используемые параметры зависят от параметра `aspNetCompatibilityEnabled`. Если параметр `aspNetCompatibilityEnabled` установлен в значение `false`, настройте модуль `System.ServiceModel.Activation.ServiceHttpModule`, как показано в следующем фрагменте конфигурации.  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="false" />
  </system.serviceModel>  
  <system.webServer>  
    <modules>  
      <remove name="ServiceModel"/>  
      <add name="ServiceModel"
           preCondition="integratedMode,runtimeVersionv2.0"
           type="System.ServiceModel.Activation.ServiceHttpModule, System.ServiceModel,Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>  
    </modules>  
    </system.webServer>  
```  
  
 Если параметр `aspNetCompatibilityEnabled` установлен в значение `true`, настройте модуль `System.ServiceModel.Activation.ServiceHttpHandlerFactory`, как показано в следующем фрагменте конфигурации.  
  
```xml  
<system.serviceModel>  
    <serviceHostingEnvironment aspNetCompatibilityEnabled="true" />
  </system.serviceModel>  
  <system.webServer>  
    <handlers>  
          <clear/>  
          <add name="TestAsyncHttpHandler"
               path="*.svc"
               verb="*"
               type="System.ServiceModel.Activation.ServiceHttpHandlerFactory, System.ServiceModel, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
               />  
    </handlers>
  </system.webServer>  
```  
  
## <a name="see-also"></a>См. также

- [Примеры размещения служб](../samples/hosting.md)
- [Функции размещения Windows Server App Fabric](/previous-versions/appfabric/ee677189(v=azure.10))
