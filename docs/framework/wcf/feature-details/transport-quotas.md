---
description: Дополнительные сведения о квотах транспорта
title: Квоты транспорта
ms.date: 03/30/2017
helpviewer_keywords:
- transport quotas [WCF]
ms.assetid: 3e71dd3d-f981-4d9c-9c06-ff8abb61b717
ms.openlocfilehash: 0359d088402235a34b8cf1d13820c0a7c920b023
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99752630"
---
# <a name="transport-quotas"></a>Квоты транспорта

Квоты транспорта - это механизм политики, позволяющий принимать решения о чрезмерном потреблении ресурсов подключением. Квота - это строгое ограничение, предотвращающее использование дополнительных ресурсов после превышения значения квоты. Квоты транспорта препятствуют злонамеренным или неумышленным атакам типа "отказ в обслуживании".  
  
 Для транспортов Windows Communication Foundation (WCF) значения квот по умолчанию основаны на консервативном выделении ресурсов. Эти значения по умолчанию подходят для сред разработки и небольших сценариев установки. Администраторы служб должны проверять квоты транспорта и настраивать отдельные значения квоты, если данной установке начинает не хватать ресурсов или если подключения ограничиваются, несмотря на доступность дополнительных ресурсов.  
  
## <a name="types-of-transport-quotas"></a>Типы квот транспорта  

 Для транспорта WCF предусмотрены три типа квот:  
  
- Время ожидания устраняет атаки типа "отказ в обслуживании", которые основываются на *раздельном* подключении ресурсов в течение продолжительного периода времени.  
  
- *Ограничения на выделение памяти* предотвращают нехватку системной памяти и отказ службы на другие соединения.  
  
- *Размер коллекции ограничивает* потребление ресурсов, которые косвенно распределяют память или находятся в ограниченном пределах.  
  
## <a name="transport-quota-descriptions"></a>Описания квоты транспорта  

 В этом разделе описаны квоты транспорта, доступные для стандартных транспортов WCF: HTTP (S), TCP/IP и именованные каналы. Для пользовательских транспортов могут существовать собственные настраиваемые квоты, не включенные в этот список. Информация о квотах пользовательского транспорта содержится в документации по транспорту.  
  
 Каждый параметр квоты имеет тип, минимальное значение и значение по умолчанию. Максимальное значение квоты ограничивается ее типом. Аппаратные ограничения не всегда позволяют задать максимальное значение квоты.  
  
|Имя|Тип|Мин.<br /><br /> значение|Значение по умолчанию<br /><br /> значение|Описание|  
|----------|----------|--------------------|-----------------------|-----------------|  
|`ChannelInitializationTimeout`|TimeSpan|1 такт|5 секунд|Максимальное время ожидания подключения для отправки преамбулы во время начального считывания. Проверка подлинности происходит после получения этих данных. Как правило, этот параметр гораздо меньше значения квоты `ReceiveTimeout`.|  
|`CloseTimeout`|TimeSpan|0|1 мин|Максимальное время ожидания закрытия соединения до того, как транспорт создаст исключение.|  
|`ConnectionBufferSize`|Целое число|1|8 КБ|Размер (в байтах) буфера передачи и приемного буфера используемого транспорта. Увеличение размера буфера может улучшить пропускную способность при отправке крупных сообщений.|  
|`IdleTimeout`|TimeSpan|0|2 мин|Максимальное время бездействия соединения в пуле до закрытия.<br /><br /> Этот параметр применим только к подключениям в пуле.|  
|`LeaseTimeout`|TimeSpan|0|5 мин|Максимальное время существования активного соединения в пуле. По истечении указанного времени соединения закрывается после обработки текущего запроса.<br /><br /> Этот параметр применим только к подключениям в пуле.|  
|`ListenBacklog`|Целое число|1|10|Максимальное число не обслуживаемых прослушивателем подключений (по достижении которого дополнительные подключения к этой конечной точке запрещаются).|  
|`MaxBufferPoolSize`|Long|0|512 КБ|Максимальный объем памяти (в байтах), которую транспорт использует для помещения в пул буферов сообщений многократного использования. Если пул не может предоставить буфер сообщений, выделяется новый буфер для временного использования.<br /><br /> Установки, создающие множество фабрик каналов или прослушивателей, могут выделять буферным пулам большие объемы памяти. Уменьшение размера буфера может способствовать значительному снижению расхода памяти в этом сценарии.|  
|`MaxBufferSize`|Целое число|1|64 КБ|Максимальный размер (в байтах) буфера, который используется для потоковой передачи данных. Если эта квота транспорта не установлена или транспорт не использует потоковую передачу, значение квоты совпадает с меньшим из двух: значением квоты `MaxReceivedMessageSize` и значением <xref:System.Int32.MaxValue>.|  
|`MaxOutboundConnectionsPerEndpoint`|Целое число|1|10|Максимальное число исходящих подключений, которые могут быть связаны с конкретной конечной точкой.<br /><br /> Этот параметр применим только к подключениям в пуле.|  
|`MaxOutputDelay`|TimeSpan|0|200 мс|Максимальное время ожидания после операции отправки для группирования дополнительных сообщений в одну операцию. Сообщения отправляются раньше, если буфер используемого транспорта переполнен. Отправка дополнительных сообщений не сбрасывает период задержки.|  
|`MaxPendingAccepts`|Целое число|1|1|Максимальное число каналов, ожидающих принятия прослушивателем.<br /><br /> Между завершением одной операции приема и началом другой операции приема проходит определенный промежуток времени. Увеличение размера этой коллекции предотвращает сброс клиентов, подключающихся в этот промежуток времени.|  
|`MaxPendingConnections`|Целое число|1|10|Максимальное число подключений, принятия которых приложением может ожидать прослушиватель. После превышения значения этой квоты новые входящие подключения сбрасываются, а не ожидают принятия.<br /><br /> Возможности подключения (такие как безопасность сообщения) могут вынудить клиента открыть несколько подключений. При установке значения квоты администраторы службы должны учитывать возможность установления дополнительных подключений.|  
|`MaxReceivedMessageSize`|Long|1|64 КБ|Максимальный размер (в байтах) сообщения, включая заголовки, при получении которого транспорт не создает исключение.|  
|`OpenTimeout`|TimeSpan|0|1 мин|Максимальное время ожидания установления соединения до того, как транспорт создаст исключение.|  
|`ReceiveTimeout`|TimeSpan|0|10 мин|Максимальное время ожидания завершения операции считывания до того, как транспорт создаст исключение.|  
|`SendTimeout`|Временной диапазон|0|1 мин|Максимальное время ожидания завершения операции записи до того, как транспорт создаст исключение.|  
  
 При задании через привязку или конфигурацию квоты транспорта `MaxPendingConnections` и `MaxOutboundConnectionsPerEndpoint` объединяются в одну квоту транспорта, называемую `MaxConnections`. Только элемент привязки позволяет настроить значения этих квот отдельно. Минимальное значение квоты транспорта `MaxConnections` совпадает с ее значением по умолчанию.  
  
## <a name="setting-transport-quotas"></a>Задание квот транспорта  

 Квоты транспорта задаются через элемент привязки транспорта, привязку транспорта, конфигурацию приложения или политику ведущего приложения. В этом документе не описывается установка транспортов через политику ведущего приложения. Для получения информации о настройках квот через политику ведущего приложения обратитесь к документации по используемому транспорту. В разделе [Настройка HTTP и HTTPS](configuring-http-and-https.md) описаны параметры квот для драйвера Http.sys. Дополнительную информацию о настройке ограничений Windows для протоколов HTTP, TCP/IP и подключений по именованному каналу можно найти в базе знаний Майкрософт.  
  
 Другие виды квот применяются к транспортам косвенно. Кодировщик сообщений, используемый транспортом для преобразования сообщения в байты, может иметь собственные настройки квот. Однако эти квоты не зависят от типа используемого транспорта.  
  
### <a name="controlling-transport-quotas-from-the-binding-element"></a>Управление квотами транспорта из элемента привязки  

 Задание квот транспорта через элемент привязки обеспечивает наибольшую гибкость в управлении поведением транспорта. Время ожидания по умолчанию для операций закрытия, открытия, получения и отправки берется из привязки при создании канала.  
  
|Имя|HTTP|TCP/IP|Именованный канал|  
|----------|----------|-------------|----------------|  
|`ChannelInitializationTimeout`||X|X|  
|`CloseTimeout`||||  
|`ConnectionBufferSize`||X|X|  
|`IdleTimeout`||X|X|  
|`LeaseTimeout`||X||  
|`ListenBacklog`||X||  
|`MaxBufferPoolSize`|X|X|X|  
|`MaxBufferSize`|X|X|X|  
|`MaxOutboundConnectionsPerEndpoint`||X|X|  
|`MaxOutputDelay`||X|X|  
|`MaxPendingAccepts`||X|X|  
|`MaxPendingConnections`||X|X|  
|`MaxReceivedMessageSize`|X|X|X|  
|`OpenTimeout`||||  
|`ReceiveTimeout`||||  
|`SendTimeout`||||  
  
### <a name="controlling-transport-quotas-from-the-binding"></a>Управление квотами транспорта из привязки  

 Задание квот транспорта через привязку предоставляет упрощенный набор доступных квот и при этом позволяет получать доступ к наиболее распространенным значениям квот.  
  
|Имя|HTTP|TCP/IP|Именованный канал|  
|----------|----------|-------------|----------------|  
|`ChannelInitializationTimeout`||||  
|`CloseTimeout`|X|X|X|  
|`ConnectionBufferSize`||||  
|`IdleTimeout`||||  
|`LeaseTimeout`||||  
|`ListenBacklog`||X||  
|`MaxBufferPoolSize`|X|X|X|  
|`MaxBufferSize`|1|X|X|  
|`MaxOutboundConnectionsPerEndpoint`||2|2|  
|`MaxOutputDelay`||||  
|`MaxPendingAccepts`||||  
|`MaxPendingConnections`||2|2|  
|`MaxReceivedMessageSize`|X|X|X|  
|`OpenTimeout`|X|X|X|  
|`ReceiveTimeout`|X|X|X|  
|`SendTimeout`|X|X|X|  
  
1. Квота транспорта `MaxBufferSize` доступна только в привязке `BasicHttp`. Привязки `WSHttp` предназначены для сценариев, которые не поддерживают режимы потоковых транспортов.  
  
2. Квоты транспорта `MaxPendingConnections` и `MaxOutboundConnectionsPerEndpoint` объединяются в одну квоту транспорта, называемую `MaxConnections`.  
  
### <a name="controlling-transport-quotas-from-configuration"></a>Управление квотами транспорта из конфигурации  

 С помощью конфигурации приложения можно задавать те же квоты транспорта, что и посредством прямого доступа к свойствам в привязке. В файлах конфигурации имя квоты транспорта всегда начинается со строчной буквы. Например, свойство `CloseTimeout` в привязке соответствует параметру `closeTimeout` в конфигурации, а свойство `MaxConnections` в привязке - параметру `maxConnections` в конфигурации.  
  
## <a name="see-also"></a>См. также

- <xref:System.ServiceModel.Channels.HttpsTransportBindingElement>
- <xref:System.ServiceModel.Channels.HttpTransportBindingElement>
- <xref:System.ServiceModel.Channels.TcpTransportBindingElement>
- <xref:System.ServiceModel.Channels.NamedPipeTransportBindingElement>
- <xref:System.ServiceModel.Channels.ConnectionOrientedTransportBindingElement>
- <xref:System.ServiceModel.Channels.TransportBindingElement>
