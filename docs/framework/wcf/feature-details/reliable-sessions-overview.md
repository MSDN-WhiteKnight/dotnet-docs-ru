---
description: 'Подробнее: Общие сведения о надежных сеансах'
title: Общие сведения о надежных сеансах
ms.date: 03/30/2017
ms.assetid: a7fc4146-ee2c-444c-82d4-ef6faffccc2d
ms.openlocfilehash: 51de6012245b4fc0a367069d02fe69ee031f2b30
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99632897"
---
# <a name="reliable-sessions-overview"></a>Общие сведения о надежных сеансах

Windows Communication Foundation (WCF) надежный обмен сообщениями SOAP обеспечивает надежность передачи сквозных сообщений между конечными точками SOAP. Такой обмен реализуется в сетях, которые ненадежны из-за исправления ошибок транспорта и ошибок на уровне сообщений SOAP. В частности, эта технология обеспечивает основанную на сеансах, одиночную, упорядоченную (необязательно) доставку сообщений, отправленных по протоколу SOAP или через транспортных посредников. Доставка на основе сеанса обеспечивает группирование сообщений в сеансе с необязательным упорядочением сообщений.

В этом разделе описаны надежные сеансы, способы их использования и способы их защиты.

## <a name="wcf-reliable-sessions"></a>Надежные сеансы WCF

Надежные сеансы WCF — это реализация надежного обмена сообщениями SOAP, определяемая протоколом WS-ReliableMessaging.

Надежный обмен сообщениями WCF SOAP обеспечивает сквозной надежный сеанс между двумя конечными точками независимо от числа или типа посредников, разделяющих конечные точки обмена сообщениями. Сюда входят все промежуточные посредники, которые не используют протокол SOAP (например, прокси-серверы HTTP) или посредники, использующие SOAP (например, маршрутизаторы на основе SOAP или мосты), необходимые для передачи сообщений между конечными точками. Надежный канал сеанса поддерживает *интерактивное* взаимодействие, так что службы, подключенные таким каналом, работают параллельно, а обмен и обработка сообщений выполняются в условиях низкой задержки, то есть в течение относительно коротких интервалов времени. Такая связь означает, что эти компоненты выполняются вместе или завершаются сбоем, поэтому между ними нет изоляции.

Надежный сеанс скрывает два вида сбоев.

- Сбои на уровне сообщений SOAP, которые включают в себя потерянные или дублированные сообщения и сообщения, приходящие в порядке, отличном от порядка, в котором они были отправлены.

- Сбои транспорта.

Надежный сеанс реализует протокол WS-ReliableMessaging и окно передачи в памяти, чтобы маскировать сбои на уровне сообщений SOAP, и восстанавливает подключения в случае сбоев транспорта.

Надежный сеанс обеспечивает для сообщений SOAP то, что обеспечивает TCP для IP-пакетов. Подключение через сокет TCP - это единая, упорядоченная передача IP-пакетов между узлами. Надежный канал обеспечивает тот же тип надежной передачи, но отличается от надежности сокета TCP в следующем.

- Надежность поддерживается на уровне сообщений SOAP, она не связана с пакетом байтов произвольного размера.

- Надежность является независимым от транспорта, а не только для передачи по протоколу TCP.

- Надежность не привязана к определенному транспортному сеансу (например, к сеансу, предоставляемому TCP-соединению) и может одновременно использовать несколько многопортовых сеансов или последовательное подключение к времени существования надежного сеанса.

- Надежный сеанс осуществляется между конечными точками отправителя и получателя SOAP независимо от числа транспортных подключений, необходимых для их соединения. Коротко говоря, надежность протокола TCP заканчивается, где заканчивается транспортное соединение, в то время как надежный сеанс обеспечивает сквозную надежность.

## <a name="reliable-sessions-and-bindings"></a>Надежные сеансы и привязки

Как упоминалось ранее, надежный сеанс является независимым от транспорта. Кроме того, можно создать надежный сеанс для многих шаблонов обмена сообщениями, таких как запрос-ответ или дуплекс. Надежный сеанс WCF предоставляется как свойство набора привязок.

Используйте надежный сеанс на конечных точках, использующих:

- стандартные привязки транспорта на основе HTTP

  - `WsHttpBinding` и предоставление контрактов типа запрос-ответ или односторонних контрактов.

  - При использовании надежного сеанса по контракту "запрос-ответ" или "простой односторонний".

  - `WsDualHttpBinding` и предоставление дуплексных, односторонних контрактов или контрактов типа запрос-ответ.

  - `WsFederationHttpBinding` и предоставление контрактов типа запрос-ответ или односторонних контрактов.

- стандартные привязки транспорта на основе TCP

  - `NetTcpBinding` и предоставление дуплексных, односторонних контрактов или контрактов типа запрос-ответ.

Используйте надежный сеанс на всех других привязках, создав пользовательскую привязку, например HTTPS (Дополнительные сведения о проблемах см. в разделе <a href="#reliable-sessions-and-security">Надежные сеансы и безопасность</a>) или привязке именованного канала.

Можно включить в стек надежный сеанс на разных типах базовых каналов, и полученная форма канала надежного сеанса может различаться. Как на клиенте, так и на сервере тип поддерживаемого канала надежного сеанса зависит от типа используемого базового канала. В следующей таблице представлен список типов каналов сеансов, поддерживаемых клиентом, в качестве функции типа базового канала.

| Поддерживаемые типы каналов надежных сеансов&#8224; | `IRequestChannel` | `IRequestSessionChannel` | `IDuplexChannel` | `IDuplexSessionChannel` |
| ----------------------------------------------- | :---------------: | :----------------------: | :--------------: | :---------------------: |
| `IOutputSessionChannel`                         | Да               | Да                      | Да              | Да                     |
| `IRequestSessionChannel`                        | Да               | Да                      | Нет               | Нет                      |
| `IDuplexSessionChannel`                         | Нет                | Нет                       | Да              | Да                     |

&#8224;Поддерживаемые типы каналов — это значения, доступные для значения универсального `TChannel` параметра, передаваемого в <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.BuildChannelFactory%60%601%28System.ServiceModel.Channels.BindingContext%29> метод.

В следующей таблице представлен список типов каналов сеансов, поддерживаемых сервером, в качестве функции типа базового канала.

| Поддерживаемые типы каналов надежных сеансов&#8225; | `IReplyChannel` | `IReplySessionChannel` | `IDuplexChannel` | `IDuplexSessionChannel` |
| ----------------------------------------------- | :-------------: | :--------------------: | :--------------: | :---------------------: |
| `IInputSessionChannel`                          | Да             | Да                    | Да              | Да                     |
| `IReplySessionChannel`                          | Да             | Да                    | Нет               | Нет                      |
| `IDuplexSessionChannel`                         | Нет              | Нет                     | Да              | Да                     |

&#8225;Поддерживаемые типы каналов — это значения, доступные для значения универсального `TChannel` параметра, передаваемого в <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.BuildChannelListener%60%601%28System.ServiceModel.Channels.BindingContext%29> метод.

## <a name="reliable-sessions-and-security"></a>Надежные сеансы и безопасность

Обеспечение безопасности надежного сеанса важно для обеспечения проверки подлинности взаимодействующих сторон (службы и клиента) и того, что сообщения, которыми обмениваются сеанс, не были изменены. Более того, важно обеспечить целостность каждого отдельного надежного сеанса. Надежный сеанс защищен путем его привязки к контексту безопасности, который представлен и управляется каналом сеанса безопасности. Канал безопасности обеспечивает сеанс безопасности. Маркеры безопасности, обмен которыми осуществляется во время установления сеанса, затем используются для защиты сообщений в надежном сеансе.

Когда надежный сеанс работает через TCP-S, сеанс TCP привязывается к надежному сеансу. Поэтому безопасность транспорта гарантирует, что безопасность также будет привязана к надежному сеансу. В этом случае восстановление подключения выключено.

Единственное исключение относится к использованию HTTPS. Сеанс SSL (SSL) не привязан к надежному сеансу. Это накладывает угрозу, поскольку сеансы, которые совместно используют контекст безопасности (сеанс SSL), не защищаются друг от друга. Это может быть и не быть реальной угрозой в зависимости от приложения.

## <a name="using-reliable-sessions"></a>Использование надежных сеансов

Чтобы использовать надежные сеансы WCF, создайте конечную точку с привязкой, которая поддерживает надежный сеанс. Используйте одну из предоставляемых системой привязок, предоставляемых WCF с включенным надежным сеансом, или создайте собственную настраиваемую привязку.

Определенные системой привязки, которые поддерживают и разрешают надежный сеанс, включают в себя:

- <xref:System.ServiceModel.WSDualHttpBinding>

Предоставляемые системой привязки, которые поддерживают надежный сеанс как вариант, но не включают по умолчанию:

- <xref:System.ServiceModel.WSHttpBinding>

- <xref:System.ServiceModel.WSFederationHttpBinding>

- <xref:System.ServiceModel.NetTcpBinding>

Пример создания пользовательской привязки см. [в разделе как создать настраиваемую привязку надежного сеанса с помощью протокола HTTPS](how-to-create-a-custom-reliable-session-binding-with-https.md).

Описание привязок WCF, которые поддерживают надежные сеансы, см. в разделе [привязки, предоставляемые системой](../system-provided-bindings.md).

## <a name="when-to-use-reliable-sessions"></a>Когда следует использовать надежные сеансы

Важно понимать, когда следует использовать надежные сеансы в приложении. WCF поддерживает надежные сеансы между конечными точками, которые активны и активно в то же время. Если приложению требуется, чтобы одна из конечных точек была недоступна в течение определенного времени, используйте очереди для достижения надежности.

Если для сценария требуется две конечные точки, подключенные по протоколу TCP, то для обеспечения надежности обмена сообщениями может быть достаточно протокола TCP. Хотя нет необходимости использовать надежный сеанс, так как TCP гарантирует, что пакеты поступают в порядке и только один раз.

Если ваш сценарий имеет одну из следующих характеристик, следует серьезно рассмотреть возможность использования надежного сеанса.

- Посредники SOAP, такие как маршрутизаторы SOAP

- Промежуточные посредники или транспортные мосты

- Периодическое подключение

- Сеансы по протоколу HTTP

## <a name="see-also"></a>См. также

- [Использование привязок для настройки служб и клиентов](../using-bindings-to-configure-services-and-clients.md)
- [Надежный сеанс WS](../samples/ws-reliable-session.md)
