---
description: 'Дополнительные сведения: рекомендации по работе с надежными сеансами'
title: Рекомендации по работе с надежными сеансами
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 4b05dd914d2c5b8ec7941417b727bec1e5b43ba4
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99643674"
---
# <a name="best-practices-for-reliable-sessions"></a>Рекомендации по работе с надежными сеансами

В этом разделе обсуждаются рекомендации для надежных сеансов.

## <a name="setting-maxtransferwindowsize"></a>Установка MaxTransferWindowSize

Надежные сеансы в Windows Communication Foundation (WCF) используют окно перемещения для хранения сообщений на клиенте и в службе. Настраиваемое свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в окне передачи.

На отправителю указывает, сколько сообщений может храниться в окне пересылки при ожидании подтверждения. на получателе указывает, сколько сообщений в буфер для службы.

Выбор правильного размера влияет на эффективность сети и оптимальную емкость службы. В следующих разделах приводятся подробные сведения о том, что следует учитывать при выборе значения для этого свойства и влиянии значения.

Размер окна перемещения по умолчанию — восемь сообщений.

### <a name="efficient-use-of-the-network"></a>Эффективное использование сети

В этом контексте термин *сеть* соответствует всем, что используется в качестве основания для обмена данными между клиентом (отправителем) и службой (получателем). Сюда входят транспортные подключения и любые промежуточные или мосты между, включая маршрутизаторы SOAP или прокси-серверы или брандмауэры HTTP.

Эффективное использование сети обеспечивает максимальные возможности сети. Объем данных, которые могут передаваться в секунду по сети (скорость передачи *данных*), и время, затрачиваемое на передачу данных от отправителя к получателю (*Задержка*), влияют на эффективность работы сети.

На стороне отправителя свойство <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> указывает количество сообщений, которое может храниться в его окне передачи во время ожидания подтверждения. Если задержка в сети высока и для обеспечения реагирования отправителя и эффективного использования сети необходимо увеличить размер окна передачи.

Например, даже если отправитель не поддерживает скорость передачи данных, задержка может быть высока, если между отправителем и получателем существует несколько посредников или если данные должны пройти через промежуточную посредник или сеть с потерей данных. Таким же отправителю необходимо подождать подтверждения сообщений в своем окне передачи, прежде чем принимать новые сообщения для отправки по сети. Чем меньше буфер с высокой задержкой, тем менее эффективно использование сети. С другой стороны, слишком большой размер окна передачи может повлиять на службу, так как службе может потребоваться перехватить большую скорость передачи данных, отправляемых клиентом.

### <a name="running-the-service-to-capacity"></a>Запуск службы для использования емкости

Так как сеть используется эффективно, в идеале необходимо также, чтобы служба выполнялась в оптимальной емкости. Свойство размера окна передачи на стороне получателя указывает количество сообщений, которое получатель может поместить в буфер. Такая буферизация сообщений помогает не только управлять потоком в сети, но и обеспечивает выполнение службы с максимальной производительностью. Например, если буфер является одним сообщением, а сообщения поступают быстрее, чем служба может обработать их, то сеть может быть недостаточной или чрезмерно загруженной.

Использование буфера увеличивает доступность службы при одновременном получении и буферизации сообщения при обработке ранее полученных сообщений.

Мы рекомендуем использовать то же самое `MaxTransferWindowSize` для отправителя и получателя.

### <a name="enabling-flow-control"></a>Включение управления потоком

*Управление потоком* — это механизм, который гарантирует, что отправитель и получатель сохраняют скорость друг с другом, то есть сообщения потребляются и обрабатываются так же быстро, как они создаются. Размер окна передачи со стороны клиента и службы гарантирует, что отправитель и получатель находятся в разумном окне синхронизации.

Мы настоятельно рекомендуем задать для свойства значение, <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> `true` Если вы используете надежный сеанс между клиентом WCF и службой WCF.

## <a name="setting-maxpendingchannels"></a>Установка MaxPendingChannels

При написании службы, которая обеспечивает надежный сеансовый обмен данными от разных клиентов, возможно, много клиентов одновременно устанавливают надежный сеанс для службы. Ответ службы в таких ситуациях зависит от свойства `MaxPendingChannels`.

Когда отправитель создает канал надежного сеанса для связи с получателем, после подтверждения между ними устанавливается надежный сеанс. После установки надежного сеанса канал помещается в очередь ожидающих каналов для принятия службой. Свойство `MaxPendingChannels` указывает количество каналов, которые могут находиться в этом состоянии.

Служба может находиться в состоянии, где невозможно принимать больше каналов. Если очередь заполнена, попытка установить надежный сеанс отклоняется, и клиент должен повторить попытку.

Также возможно, что ожидающие каналы в очереди остаются в очереди в течение более длительного времени. Тем временем время ожидания простоя в надежном сеансе может быть вызвано переходом канала в состояние сбоя.

При написании службы, которая работает с несколькими клиентами одновременно, следует задать значение, которое подходит для ваших нужд. Слишком большое значение параметра для `MaxPendingChannels` свойства влияет на рабочий набор.

Значение по умолчанию для <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> — четыре канала.

## <a name="reliable-sessions-and-hosting"></a>Надежные сеансы и размещение

При размещении в Интернете службы, использующей надежные сеансы, следует помнить о следующих важных вопросах.

- В надежных сеансах можно отследить состояние, которое поддерживается в домене приложения. Это значит, что все сообщения, являющиеся частью надежного сеанса, необходимо обрабатывать в том же домене приложения. Веб-фермы и веб-сады, в которых размер фермы или сада больше одного узла, не могут гарантировать это ограничение.

- Надежные сеансы, использующие два канала HTTP (например, с помощью `WsDualHttpBinding` ), могут требовать больше, чем по умолчанию для двух HTTP-соединений на каждого клиента. Это означает, что дуплексный надежный сеанс может потребовать до двух подключений, так как сообщения одновременного приложения и протокола могут передаваться в любой момент времени. При определенных условиях в зависимости от шаблона обмена сообщениями службы это означает, что можно взаимоблокировка веб-службы с помощью двух HTTP-и надежных сеансов. Чтобы увеличить число допустимых HTTP-соединений на клиент, добавьте следующий код в соответствующий файл конфигурации (например, *web.config* нужной службы):

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  Значением `maxconnection` атрибута является количество необходимых соединений. Минимальное значение в этом случае должно составлять четыре соединения.
