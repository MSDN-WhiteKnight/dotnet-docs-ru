---
description: 'Дополнительные сведения о: FindPrivateKey Sample'
title: Пример FindPrivateKey
ms.date: 12/04/2017
helpviewer_keywords:
- FindPrivateKey
ms.assetid: 16b54116-0ceb-4413-af0c-753bb2a785a6
ms.openlocfilehash: 0e876aa3e1f6dde16acbb3ddd2a130ad49d369fc
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99732427"
---
# <a name="findprivatekey-sample"></a>Пример FindPrivateKey

Определение расположения и имени файла закрытого ключа, связанного с заданным сертификатом X.509, в хранилище сертификатов может представлять собой достаточно сложную задачу. Средство FindPrivateKey.exe упрощает этот процесс.

> [!IMPORTANT]
> FindPrivateKey - это образец, который необходимо скомпилировать перед началом использования. Инструкции по созданию средства FindPrivateKey см. в разделе [To Build The FindPrivateKey Project](#to-build-the-findprivatekey-project) .

Сертификаты X.509 устанавливаются администратором или любым пользователем компьютера. Тем не менее, доступ к сертификату может осуществляться службой, работающей под другой учетной записью. Например, учетная запись сетевой службы.

У такой учетной записи может не быть доступа к файлу закрытого ключа, поскольку изначально сертификат был установлен другой учетной записью. Средство FindPrivateKey позволяет определить расположение файла закрытого ключа заданного сертификата X.509. Если расположение файла закрытого ключа заданного сертификата X.509 известно, можно добавлять или удалять разрешения на доступ к этому файлу.

Примеры, использующие сертификаты для обеспечения безопасности, используют средство FindPrivateKey в файле *Setup.bat* . После того как файл закрытого ключа будет найден, можно использовать другие средства, такие как *Cacls.exe* , чтобы задать соответствующие права доступа к файлу.

При запуске службы Windows Communication Foundation (WCF) под учетной записью пользователя, такой как исполняемый файл с автономным размещением, убедитесь, что учетная запись пользователя имеет доступ только для чтения к файлу. При запуске службы WCF в службы IIS (IIS) учетные записи по умолчанию, под которыми работает служба, — это СЕТЕВая служба в IIS 7 и более ранних версиях или удостоверение пула приложений в IIS 7,5 и более поздних версиях. Дополнительные сведения см. в разделе [удостоверения пула приложений](/iis/manage/configuring-security/application-pool-identities).

## <a name="examples"></a>Примеры

При доступе к сертификату, для которого у процесса нет прав на чтение, отображается сообщение об исключении, как в следующем примере:

```output
System.ArgumentException was unhandled
Message="The certificate 'CN=localhost' must have a private key that is capable of key exchange.  The process must have access rights for the private key."
Source="System.ServiceModel"
```

В этом случае используйте средство FindPrivateKey, чтобы найти файл закрытого ключа, а затем установите право доступа для процесса, от имени которого запущена служба. Например, это можно сделать с помощью средства Cacls.exe, как показано в следующем примере:

```console
cacls.exe "C:\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys\8aeda5eb81555f14f8f9960745b5a40d_38f7de48-5ee9-452d-8a5a-92789d7110b1" /E /G "NETWORK SERVICE":R
```

#### <a name="to-build-the-findprivatekey-project"></a>Построение проекта FindPrivateKey

Чтобы скачать проект, перейдите на страницу [примеры Windows Communication Foundation (WCF) и Windows Workflow Foundation (WF) для платформа .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459).

1. Откройте проводник и перейдите в папку *WF_WCF_Samples \вкф\сетуп\финдприватекэй\кс* в каталоге, где был установлен пример.

2. Дважды щелкните значок файла с расширением SLN, чтобы открыть файл в Visual Studio.

3. В меню **Сборка** выберите **Перестроить решение**.

4. В результате построения решения будет создан файл FindPrivateKey.exe.

## <a name="conventionscommand-line-entries"></a>Соглашения — записи командной строки

 "[*параметр*]" представляет необязательный набор параметров.

 "{*Option*}" представляет обязательный набор параметров.

 "*параметр1* &#124; *параметр2*" представляет выбор между наборами параметров.

 " \<*value*> " представляет значение параметра, которое необходимо указать.

## <a name="usage"></a>Использование

```console
FindPrivateKey <storeName> <storeLocation> [{ {-n <subjectName>} | {-t <thumbprint>} } [-f | -d | -a]]
```

Где:

| Параметр         | Описание                                                                       |
|-----------------|-----------------------------------------------------------------------------------|
| `<subjectName>` | Имя субъекта сертификата                                               |
| `<thumbprint>`  | Отпечаток сертификата (для поиска можно использовать средство Certmgr.exe) |
| `-f`            | только имя выходного файла                                                             |
| `-d`            | только выходной каталог                                                             |
| `-a`            | абсолютное имя выходного файла                                                         |

Если в командной строке не указаны параметры, отображается текст справки с этими сведениями.

## <a name="examples"></a>Примеры

В этом примере выполняется поиск имени файла сертификата с именем субъекта "CN = localhost" в личном хранилище текущего пользователя.

```console
FindPrivateKey My CurrentUser -n "CN=localhost"
```

В этом примере выполняется поиск имени файла сертификата с именем субъекта "CN = localhost" в личном хранилище текущего пользователя и вывод полного пути к каталогу.

```console
FindPrivateKey My CurrentUser -n "CN=localhost" -a
```

Этот пример находит имя файла сертификата с отпечатком "03 33 98 63 d0 47 e7 48 71 33 62 64 76 5c 4c 9d 42 1d 6b 52" в хранилище "Личное" на локальном компьютере.

```console
FindPrivateKey My LocalMachine -t "03 33 98 63 d0 47 e7 48 71 33 62 64 76 5c 4c 9d 42 1d 6b 52"
```
