---
description: 'Дополнительные сведения: распространение ИД действия'
title: Распространение ИД действия
ms.date: 03/30/2017
ms.assetid: cd1c1ae5-cc8a-4f51-90c9-f7b476bcfe70
ms.openlocfilehash: d407af04304298bcc04a7aa4264eb6fc46563d3a
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99770902"
---
# <a name="activity-id-propagation"></a>Распространение ИД действия

Распространение происходит при включении трассировки действий ServiceModel (распространение ServiceModel) или ее выключении (распространение действий от пользователя к пользователю).  
  
## <a name="servicemodel-activity-tracing-is-enabled"></a>Трассировка действий ServiceModel включена  

 Если трассировка действий ServiceModel включена, между действиями ProcessAction осуществляется распространение.  
  
### <a name="server"></a>Сервер  

 Если `propagateActivity` атрибут имеет значение `true` как на клиенте, так и на сервере, идентификатор `ProcessAction` действия на сервере идентичен идентификатору в `ActivityId` заголовке распространенного сообщения.  
  
 Если `ActivityId` в сообщении отсутствует заголовок (то есть `propagateActivity` = `false` на клиенте) или когда `propagateActivity` = `false` на сервере, сервер создает новый идентификатор действия.  
  
### <a name="client"></a>Клиент  

 Если клиент синхронно однопоточный, он игнорирует любые параметры `propagateActivity` на уровне клиента или сервера. Вместо этого ответ обрабатывается действием запроса. Если клиент является асинхронным или синхронным многопоточным, `propagateActivity` = `true` в клиенте, а в сообщении, отправленном сервером, есть заголовок идентификатора действия, клиент получает идентификатор действия из сообщения и передает его действию действия обработки, которое содержит распространенный идентификатор действия. Иначе клиент передает его из действия Process Action в новое действие Process Action. Такая дополнительная передача в новое действие Process Action осуществляется для обеспечения согласованности. В этом действии клиент извлекает идентификатор действия BeginCall из контекста локального потока, когда выделяется поток для обработки ответного сообщения. После этого осуществляется передача в первоначальное действие Process Action.  
  
 Если клиент дуплексный, он действует в качестве сервера для получения сообщения.  
  
### <a name="propagation-in-fault-messages"></a>Распространение в сообщениях об ошибках  

 Разницы в обработке допустимых сообщений и сообщений об ошибках нет. Если `propagateActivity` = `true` значение равно, идентификатор действия, добавленный в заголовки сообщения об ошибке SOAP, идентичен внешнему действию.  
  
## <a name="servicemodel-activity-tracing-is-disabled"></a>Трассировка действий ServiceModel отключена  

 Если трассировка действий ServiceModel отключена, распространение осуществляется непосредственно между действиями пользовательского кода, минуя действия ServiceModel. Идентификатор пользовательского действия также распространяется через заголовок идентификатора действия сообщения.  
  
 Если `propagateActivity` = `true` и `ActivityTracing` = `off` для прослушивателя трассировки ServiceModel (независимо от того, включена ли трассировка в ServiceModel), происходит следующее на клиенте или на сервере:  
  
- При запросе операции или отправке ответа идентификатор действия в TLS распространяется из пользовательского кода, пока не будет сформировано сообщение. Заголовок идентификатора действия также вставляется в сообщение перед отправкой.  
  
- При получении запроса или ответа идентификатор действия извлекается из заголовка сообщения сразу после создания объекта полученного сообщения. Идентификатор действия в TLS распространяется сразу после исчезновения сообщения из области, пока не будет достигнут пользовательский код.  
  
 Такие действия гарантируют, что при включенном распространении пользовательские трассировки появятся в том же действии. Однако гарантии в отношении трассировок ServiceModel отсутствуют. Трассировки ServiceModel возникают в действии пользовательского кода, только если обработка таких трассировок выполняется в том же потоке, в котором было задано действие пользовательского кода.  
  
 Как правило, трассировки ServiceModel находятся в следующих местах.  
  
- Если трассировка ServiceModel отключена, все выданные трассировки находятся в действиях пользователя. Если включено распространение на сервере и клиенте, эти трассировки будут находиться в том же действии.  
  
- Если включена трассировка ServiceModel, но ActivityTracing отключена, пользовательские трассировки находятся в том же действии, если для обеих сторон включено распространение. Трассировки ServiceModel появляются в действии по умолчанию 0000, пока они не возникнут в том же потоке, где выполняется обработка пользовательского кода с первоначально заданным действием.  
  
- Если включены трассировка ServiceModel и ActivityTracing, пользовательские трассировки находятся в пользовательских действиях, а трассировка ServiceModel - в действиях, определенных ServiceModel. Распространение осуществляется на уровне ServiceModel.
