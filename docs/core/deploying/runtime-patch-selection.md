---
title: Накат среды выполнения для развертывания автономных приложений .NET Core
description: Дополнительные сведения об изменениях команды dotnet publish для автономных развертываний.
author: KathleenDollard
ms.date: 05/31/2018
ms.openlocfilehash: 6bc578c63b28f51f1dd98e3e7e56fbe2c7a3e7cf
ms.sourcegitcommit: f2ab02d9a780819ca2e5310bbcf5cfe5b7993041
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99505912"
---
# <a name="self-contained-deployment-runtime-roll-forward"></a>Обновление версии среды выполнения автономного развертывания

[Автономные развертывания приложений](index.md) в .NET Core включают библиотеки .NET Core и среду выполнения .NET Core. Начиная с пакета SDK для .NET Core 2.1 (версии 2.1.300), при автономном развертывании приложений [публикуются последние исправления среды выполнения на компьютере](https://github.com/dotnet/designs/blob/main/accepted/2018/self-contained-roll-forward.md). По умолчанию [`dotnet publish`](../tools/dotnet-publish.md) для автономного развертывания выбирает последнюю версию, установленную как часть пакета SDK на компьютере для публикации. Благодаря этому развернутое приложение запускается с исправлениями для системы безопасности (и другими исправлениями), доступными во время публикации `publish`. Приложение нужно опубликовать повторно для получения нового исправления. Чтобы создать автономное приложение, укажите параметр `-r <RID>` в команде `dotnet publish` или укажите [идентификатор среды выполнения (RID)](../rid-catalog.md) в файле проекта (CSPROJ или VBPROJ) или в командной строке.

## <a name="patch-version-roll-forward-overview"></a>Общие сведения об обновлении версии исправления

[`restore`](../tools/dotnet-restore.md), [`build`](../tools/dotnet-build.md) и [`publish`](../tools/dotnet-publish.md) — это команды `dotnet`, которые выполняются отдельно. Выбор среды выполнения является частью операции `restore`, а не `publish` или `build`. При вызове команды `publish` выбирается последняя версия исправлений. Команда `publish` с аргументом `--no-restore` может не дать нужную версию исправлений, если предварительно не выполнена команда `restore` с новой политикой публикации автономных приложений. В этом случае возникает ошибка сборки со следующим или подобным текстом:

  "Проект был восстановлен с использованием Microsoft.NETCore.App версии 2.0.0, но с текущими параметрами будет использоваться версия 2.0.6. Чтобы устранить эту проблему, убедитесь, что для операции восстановления и для последующих операций, например сборки или публикации, используются одинаковые параметры. Обычно эта проблема возникает, если свойство RuntimeIdentifier задается во время сборки или публикации, а не во время восстановления".

> [!NOTE]
> `restore` и `build` могут выполняться неявно как часть другой команды, например `publish`. При неявном выполнении в рамках другой команды им предоставляется дополнительный контекст для создания подходящих артефактов. Когда вы выполняете операцию `publish` в среде выполнения (например, `dotnet publish -r linux-x64`), неявная команда `restore` восстанавливает пакеты для среды выполнения linux x64. Если вы явно вызываете метод`restore`, он не восстанавливает пакеты среды выполнения по умолчанию, поскольку у него нет этого контекста.

## <a name="how-to-avoid-restore-during-publish"></a>Как избежать восстановления во время публикации

Выполнение операции `restore` в рамках операции `publish` может привести к нежелательным результатам. Чтобы избежать операции `restore` во время операции `publish` при создании автономных приложений, выполните следующие действия:

- Установите для свойства `RuntimeIdentifiers` разделенный точкой с запятой список идентификаторов [RID](../rid-catalog.md) для публикации.
- Задайте для свойства `TargetLatestRuntimePatch` значение `true`.

## <a name="no-restore-argument-with-dotnet-publish-options"></a>Аргумент no-restore в параметрах dotnet publish

Если вы хотите создать автономные приложения и [приложения, зависящие от платформы,](index.md) в одном файле проекта и использовать аргумент `--no-restore` с `dotnet publish`, выберите один из следующих вариантов:

1. Выберите поведение зависимости от платформы. Если приложение зависит от платформы, это поведение по умолчанию. Если приложение является автономным и может использовать локальную среду выполнения 2.1.0 без исправлений, установите для параметра `TargetLatestRuntimePatch` значение `false` в файле проекта.

2. Выберите автономное поведение. Если приложение автономное, это поведение по умолчанию. Если приложение зависит от платформы и требует установки последнего исправления, установите для параметра `TargetLatestRuntimePatch` значение `true` в файле проекта.

3. Вы можете явным образом контролировать версию среды выполнения платформы, установив для параметра `RuntimeFrameworkVersion` конкретную версию исправления в файле проекта.
