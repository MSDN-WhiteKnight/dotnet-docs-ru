---
title: Интерполяция строк. Руководство по C#
description: В этом руководстве показано, как использовать функцию интерполяции строк в C# для включения форматированных результатов выражений в строку.
ms.date: 10/23/2018
ms.openlocfilehash: a80f6d6b118a9dfc4e9ada2122dfc374a137fb4e
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102103209"
---
# <a name="use-string-interpolation-to-construct-formatted-strings"></a>Создание форматированных строк с помощью интерполяции

В этом руководстве объясняется, как с помощью [интерполяции строк](../../language-reference/tokens/interpolated.md) в C# вставить значения в одну результирующую строку. Вы напишете код C# и сможете просмотреть результаты его компиляции и выполнения. Это руководство содержит ряд уроков по вставке значений в строки и форматированию этих значений различными способами.

Для работы с этим руководством вам потребуется компьютер, который можно использовать для разработки. В руководстве .NET по созданию программы [Hello World за 10 минут](https://dotnet.microsoft.com/learn/dotnet/hello-world-tutorial/intro) содержатся инструкции по настройке локальной среды разработки в macOS, Windows или Linux. Вы можете также воспользоваться [интерактивной версией](interpolated-strings.yml) этого руководства в браузере.

## <a name="create-an-interpolated-string"></a>Создание интерполированной строки

Создайте каталог с именем *interpolated*. Сделайте его текущим, выполнив следующую команду в окне консоли:

```dotnetcli
dotnet new console
```

Эта команда создает консольное приложение .NET Core в текущем каталоге.

Откройте файл *Program.cs* в любом редакторе и замените строку `Console.WriteLine("Hello World!");` следующим кодом, указав вместо `<name>` свое имя:

```csharp
var name = "<name>";
Console.WriteLine($"Hello, {name}. It's a pleasure to meet you!");
```

Чтобы выполнить этот код, введите `dotnet run` в окне консоли. При запуске программы отображается одна строка, которая содержит ваше имя в приветствии. Строка, включенная в вызов метода <xref:System.Console.WriteLine%2A>, является *выражением интерполированной строки*. Это похоже на шаблон, позволяющий создать одну строку (называемую *результирующей строкой*) из строки, содержащей внедренный код. Интерполированные строки особенно удобны при вставке значений в строку или сцеплении (объединении) строк.

Этот простой пример содержит два элемента, обязательные для каждой интерполированной строки:

- Строковый литерал, который начинается с символа `$`, стоящего до открывающей кавычки. Между символом `$` и знаком кавычки не должно быть пробелов. (Если вы хотите узнать, что при этом случится, вставьте пробел после символа `$`, сохраните файл и снова запустите программу, введя `dotnet run` в окне консоли. Компилятор C# выводит сообщение об ошибке "Ошибка CS1056: Недопустимый символ '$'".)

- Одно или несколько *интерполированных выражений*. Интерполированное выражение обозначено открывающей и закрывающей фигурной скобкой (`{` и `}`). Вы можете указать внутри фигурных скобок любое выражение C#, возвращающее значение (включая `null`).

Давайте рассмотрим еще несколько примеров интерполяции строк с другими типами данных.

## <a name="include-different-data-types"></a>Включение разных типов данных

В предыдущем разделе вы использовали интерполяцию строк для вставки одной строки внутрь другой. При этом интерполированное выражение может относиться к любому типу данных. Давайте включим в интерполированную строку значения разных типов данных.

В приведенном ниже примере сначала мы определим тип данных для [класса](../../programming-guide/classes-and-structs/classes.md)`Vegetable`, обладающего [свойством](../../properties.md) `Name` и [методом](../../methods.md) `ToString`. Этот метод [переопределяет](../../language-reference/keywords/override.md) поведение метода <xref:System.Object.ToString?displayProperty=nameWithType>. [Модификатор доступа ](../../language-reference/keywords/public.md)`public` делает этот метод доступным любому клиентскому коду и позволяет получить строковое представление экземпляра `Vegetable`. В примере метод `Vegetable.ToString` возвращает значение свойства `Name`, которое инициализируется в [конструкторе](../../programming-guide/classes-and-structs/constructors.md) `Vegetable`.

```csharp
public Vegetable(string name) => Name = name;
```

Затем создайте экземпляр класса `Vegetable` с именем `item`. Для этого воспользуйтесь [оператором `new`](../../language-reference/operators/new-operator.md) и укажите имя для конструктора `Vegetable`.

```csharp
var item = new Vegetable("eggplant");
```

Наконец, переменная `item` включается в интерполированную строку, которая также содержит значение <xref:System.DateTime>, значение <xref:System.Decimal> и значение [перечисления](../../language-reference/builtin-types/enum.md) `Unit`. Замените весь код C# в редакторе следующим кодом, а затем используйте команду `dotnet run`, чтобы запустить его:

```csharp
using System;

public class Vegetable
{
   public Vegetable(string name) => Name = name;

   public string Name { get; }

   public override string ToString() => Name;
}

public class Program
{
   public enum Unit { item, kilogram, gram, dozen };

   public static void Main()
   {
      var item = new Vegetable("eggplant");
      var date = DateTime.Now;
      var price = 1.99m;
      var unit = Unit.item;
      Console.WriteLine($"On {date}, the price of {item} was {price} per {unit}.");
   }
}
```

Обратите внимание на то, что интерполированное выражение `item` в интерполированной строке разрешается в текст eggplant в результирующей строке. Связано это с тем, что если результат выражения не имеет строковый тип, он разрешается в строку описанным ниже образом.

- Если результатом вычисления интерполированного выражения является `null`, используется пустая строка ("" или <xref:System.String.Empty?displayProperty=nameWithType>).

- Если результатом вычисления интерполированного выражения не является `null`, обычно вызывается метод `ToString` результирующего типа. Чтобы проверить это, можно изменить реализацию метода `Vegetable.ToString`. Возможно, вам вообще не потребуется реализовывать метод `ToString`, так как его реализация в той или иной форме присутствует в каждом типе. Это можно проверить, закомментировав определение метода `Vegetable.ToString` в примере, для чего перед ним нужно поставить символ комментария (`//`). В выходных данных строка "eggplant" заменяется полным именем типа ("Vegetable" в этом примере), что является стандартным поведением метода <xref:System.Object.ToString?displayProperty=nameWithType>. По умолчанию метод `ToString` возвращает для значения перечисления строковое представление значения.

В выходных данных этого примера дата является слишком точной (цена на баклажаны не меняется каждую секунду), а в значении цены не указана единица валюты. В следующем разделе вы узнаете, как устранить эти проблемы, управляя форматом строковых представлений результатов выражений.

## <a name="control-the-formatting-of-interpolation-expressions"></a>Управление форматированием интерполированных выражений

В предыдущем разделе мы вставили две неправильно отформатированные строки в результирующую строку. Первая была значением даты и времени, при этом допустимой была только дата. Вторая была ценой, в которой отсутствовала единица валюты. Обе эти проблемы легко решить. Интерполяция строк позволяет указывать *строки формата*, управляющие форматированием определенных типов. Измените вызов `Console.WriteLine` из предыдущего примера, включив в него строки формата для выражений даты и цены, как показано в следующей строке:

```csharp
Console.WriteLine($"On {date:d}, the price of {item} was {price:C2} per {unit}.");
```

Задайте строку формата, указав ее после интерполированного выражения через двоеточие. "d" — это [стандартная строка формата для даты и времени](../../../standard/base-types/standard-date-and-time-format-strings.md#the-short-date-d-format-specifier), представляющая краткий формат. "C2" — это [стандартная строка числового формата](../../../standard/base-types/standard-numeric-format-strings.md#currency-format-specifier-c), представляющая число в виде денежной единицы с точностью два знака после запятой.

Некоторые типы в библиотеках .NET поддерживают предопределенный набор строк формата. К ним относятся все числовые типы, а также типы даты и времени. Полный список типов, поддерживающих строки формата, см. в разделе [Строки формата и типы библиотек классов .NET](../../../standard/base-types/formatting-types.md#format-strings-and-net-types) статьи [Типы форматирования в .NET](../../../standard/base-types/formatting-types.md).

Попробуйте изменить строки формата в текстовом редакторе, возвращаясь в программу после каждого изменения, чтобы узнать, как они влияют на форматирование даты и времени, а также числового значения. Измените "d" в `{date:d}` на "t" (чтобы отобразить краткий формат времени), "y" (чтобы отобразить год и месяц) и "yyyy" (чтобы отобразить год в виде четырехзначного числа). Измените "C2" в `{price:C2}` на "e" (для экспоненциального представления) и "F3" (чтобы получить числовое значение с тремя знаками после запятой).

Кроме форматирования, вы можете управлять шириной поля и выравниванием для форматированных строк, включаемых в результирующую строку. В следующем разделе вы научитесь это делать.

## <a name="control-the-field-width-and-alignment-of-interpolation-expressions"></a>Управление шириной поля и выравниванием для интерполированных выражений

Как правило, когда результат интерполированного выражения форматируется как строка, она включается в результирующую строку без начальных или конечных пробелов. Особенно когда вы работаете с набором данных, возможность управления шириной поля и выравниванием помогает получить более понятные выходные данные. Чтобы увидеть это, замените весь код в текстовом редакторе следующим кодом, а затем введите `dotnet run` для выполнения программы:

```csharp
using System;
using System.Collections.Generic;

public class Example
{
   public static void Main()
   {
      var titles = new Dictionary<string, string>()
      {
          ["Doyle, Arthur Conan"] = "Hound of the Baskervilles, The",
          ["London, Jack"] = "Call of the Wild, The",
          ["Shakespeare, William"] = "Tempest, The"
      };

      Console.WriteLine("Author and Title List");
      Console.WriteLine();
      Console.WriteLine($"|{"Author",-25}|{"Title",30}|");
      foreach (var title in titles)
         Console.WriteLine($"|{title.Key,-25}|{title.Value,30}|");
   }
}
```

Имена авторов выровнены по левому краю, а названия их произведений — по правому. Вы можете указать выравнивание, добавив запятую (,) после интерполированного выражения и назначив *минимальную* ширину поля. Если указанное значение является положительным числом, то поле выравнивается по правому краю. Если оно является отрицательным числом, то поле выравнивается по левому краю.

Попробуйте удалить знаки "минус" из кода `{"Author",-25}` и `{title.Key,-25}`, а затем снова выполните пример, как показано в следующем коде:

```csharp
Console.WriteLine($"|{"Author",25}|{"Title",30}|");
foreach (var title in titles)
   Console.WriteLine($"|{title.Key,25}|{title.Value,30}|");
```

На этот раз сведения об авторе выровнены по правому краю.

Вы можете совмещать описатель выравнивания и строку формата в одном интерполированном выражении. Для этого сначала укажите выравнивание, а затем через двоеточие строку формата. Замените весь код внутри метода `Main` приведенным ниже кодом, который отображает три отформатированные строки с заданной шириной поля. Запустите программу, введя команду `dotnet run`.

```csharp
Console.WriteLine($"[{DateTime.Now,-20:d}] Hour [{DateTime.Now,-10:HH}] [{1063.342,15:N2}] feet");
```

Выходные данные выглядят следующим образом:

```console
[04/14/2018          ] Hour [16        ] [       1,063.34] feet
```

Вы завершили работу с руководством по интерполяции строк.

Дополнительные сведения об интерполяции строк см. в разделе [Интерполяция строк](../../language-reference/tokens/interpolated.md) и в руководстве [Интерполяция строк в C#](../string-interpolation.md).
