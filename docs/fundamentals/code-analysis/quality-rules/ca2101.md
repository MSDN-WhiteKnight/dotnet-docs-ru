---
title: 'CA2101: указание маршалирования для строковых аргументов P-Invoke (анализ кода)'
description: 'Дополнительные сведения о правиле анализа кода CA2101: указание маршалирования для строковых аргументов P-Invoke'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- SpecifyMarshalingForPInvokeStringArguments
- CA2101
helpviewer_keywords:
- CA2101
- SpecifyMarshalingForPInvokeStringArguments
author: gewarren
ms.author: gewarren
ms.openlocfilehash: bfd28fef3fabfde9cf81b3dab06a5438409f300d
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99630752"
---
# <a name="ca2101-specify-marshaling-for-pinvoke-string-arguments"></a>CA2101: укажите тип маршалинга для строковых аргументов P/Invoke

| | Значение |
|-|-|
| **Идентификатор правила** |CA2101|
| **Категория** |[Глобализация](globalization-warnings.md)|
| **Исправление не критическое или не критическое** |Не критическое|

## <a name="cause"></a>Причина

Член неуправляемого кода допускает частично доверенные вызывающие объекты, имеет строковый параметр и не маршалирует строку явным образом.

## <a name="rule-description"></a>Описание правила

При преобразовании из Юникода в ANSI возможно, что не все символы Юникода могут быть представлены в определенной кодовой странице ANSI. *Наилучшее сопоставление* пытается решить эту проблему, подставив символ для символа, который не может быть представлен. Использование этой функции может вызвать потенциальную уязвимость системы безопасности, поскольку нельзя управлять выбранным символом. Например, вредоносный код может намеренно создать строку в Юникоде, содержащую символы, не найденные в определенной кодовой странице, которые преобразуются в специальные символы файловой системы, такие как ".." или '/'. Обратите внимание, что проверки безопасности для специальных символов часто возникают перед преобразованием строки в ANSI.

Для неуправляемого преобразования по умолчанию используется наилучшее соответствие, WChar — МБ. Если явно не отключить сопоставление наилучшего соответствия, код может содержать уязвимость системы безопасности, которую можно использовать злоумышленником.

> [!CAUTION]
> Разграничение [доступа кода](../../../framework/misc/code-access-security.md) (CAS) не следует рассматривать как границу безопасности.

## <a name="how-to-fix-violations"></a>Устранение нарушений

Чтобы устранить нарушение этого правила, явно маршалировать строковые типы данных.

## <a name="when-to-suppress-warnings"></a>Когда следует подавлять предупреждения

Для этого правила отключать вывод предупреждений не следует.

## <a name="example"></a>Пример

В следующем примере показан метод, нарушающий это правило, а затем показано, как устранить нарушение.

:::code language="csharp" source="snippets/csharp/all-rules/ca2101.cs" id="snippet1":::
