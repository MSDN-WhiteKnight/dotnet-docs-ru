---
description: Дополнительные сведения см. в статье поддержка возвращаемых ссылочных значений (Visual Basic).
title: Возвращаемые ссылочные значения
ms.date: 04/28/2017
helpviewer_keywords:
- variables [Visual Basic]
- ref return values [Visual Basic]
- ref returns [Visual Basic]
ms.assetid: 5ef0cc69-eb3a-4a67-92a2-78585f223cb5
ms.openlocfilehash: 215a647c68eb7eadd394a1a7842ceb98c46e04a5
ms.sourcegitcommit: 10e719780594efc781b15295e499c66f316068b8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100466553"
---
# <a name="support-for-reference-return-values-visual-basic"></a>Поддержка возвращаемых ссылочных значений (Visual Basic)

Начиная с C# 7,0, язык C# поддерживает *возвращаемые ссылочные значения*. Один из способов понять возвращаемые ссылочные значения заключается в том, что они являются противоположными аргументами, передаваемыми по ссылке к методу. При изменении аргумента, передаваемого по ссылке, изменения отражаются в значении переменной в вызывающем объекте. Если метод предоставляет вызывающему значению ссылочное значение, изменения, внесенные в возвращаемое значение ссылочного объекта, отражаются в данных вызываемого метода.

Visual Basic не позволяет создавать методы со возвращаемыми ссылочными значениями, но это позволяет использовать возвращаемые ссылочные значения. Иными словами, можно вызвать метод с возвращаемым ссылочным значением и изменить это возвращаемое значение, а изменения ссылочного возвращаемого значения отражаются в данных вызываемого метода.

## <a name="modifying-the-ref-return-value-directly"></a>Изменение возвращаемого значения ref напрямую

Для методов, которые всегда завершаются успешно и не имеют `ByRef` параметров, можно изменить возвращаемое ссылочное значение напрямую. Это делается путем присвоения нового значения выражениям, возвращающим возвращаемое ссылочное значение.

В следующем примере C# определяется `NumericValue.IncrementValue` метод, который увеличивает внутреннее значение и возвращает его в качестве возвращаемого ссылочного значения.

[!code-csharp[Ref-Return](../../../../../samples/snippets/visualbasic/programming-guide/language-features/procedures/ref-returns1.cs)]

Возвращаемое ссылочное значение затем изменяется вызывающим объектом в следующем Visual Basic примере. Обратите внимание, что строка с `NumericValue.IncrementValue` вызовом метода не присваивает методу значение. Вместо этого он присваивает значение ссылочному возвращаемому значению, возвращаемому методом.

[!code-vb[Ref-Return](../../../../../samples/snippets/visualbasic/programming-guide/language-features/procedures/use-ref-returns1.vb)]

## <a name="using-a-helper-method"></a>Использование вспомогательного метода

В других случаях изменение возвращаемого ссылочного значения для вызова метода напрямую может быть не всегда желательным. Например, метод поиска, возвращающий строку, не всегда может найти совпадение. В этом случае необходимо изменить возвращаемое ссылочное значение только в том случае, если поиск прошел успешно.

Этот сценарий показан в следующем примере C#. Он определяет `Sentence` , что класс, написанный на языке C#, включает `FindNext` метод, который находит следующее слово в предложении, которое начинается с указанной подстроки. Строка возвращается как значение, возвращаемое по ссылке, а переменная `Boolean`, переданная в метод по ссылке, показывает, дал ли поиск какие-то результаты. Возвращаемое ссылочное значение указывает, что в дополнение к чтению возвращаемого значения вызывающий объект также может изменить его, и это изменение будет отражено в данных, содержащихся внутри `Sentence` класса.

[!code-csharp[Ref-Return](../../../../../samples/snippets/visualbasic/getting-started/ref-returns.cs)]

Непосредственное изменение возвращаемого ссылочного значения в этом случае не является надежным, так как вызов метода может не найти совпадения и вернуть первое слово в предложении. В этом случае вызывающий объект случайно изменит первое слово предложения. Это может быть предотвращено вызывающим объектом, возвращающим `null` (или `Nothing` в Visual Basic). Но в этом случае попытка изменить строку, значение которой вызывает `Nothing` исключение <xref:System.NullReferenceException> . Значение, если можно также предотвратить возврат вызывающей стороны <xref:System.String.Empty?displayProperty=nameWithType> , но для этого требуется, чтобы вызывающий объект определял строковую переменную со значением <xref:System.String.Empty?displayProperty=nameWithType> . Хотя вызывающий объект может изменить эту строку, само изменение не будет работать, так как измененная строка не имеет отношения к словам в предложении, которое хранится в `Sentence` классе.

Лучший способ решить эту проблему — передать возвращаемое ссылочное значение по ссылке на вспомогательный метод. Затем вспомогательный метод содержит логику для определения успешности вызова метода и изменения возвращаемого ссылочного значения. В следующем примере показана возможная реализация.

[!code-vb[Ref-Return](../../../../../samples/snippets/visualbasic/getting-started/ref-return-helper.vb#1)]

## <a name="see-also"></a>См. также раздел

- [Передача аргументов по значению и по ссылке](passing-arguments-by-value-and-by-reference.md)
- [Процедуры в Visual Basic](index.md)
