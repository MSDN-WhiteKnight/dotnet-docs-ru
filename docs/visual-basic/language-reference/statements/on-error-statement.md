---
description: 'Дополнительные сведения о: On Error Statement (Visual Basic)'
title: Оператор On Error
ms.date: 07/20/2015
f1_keywords:
- vb.OnError
helpviewer_keywords:
- Visual Basic code, control flow
- Resume Next statement [Visual Basic]
- errors [Visual Basic], trapping
- error handling, On Error statement
- Next statement [Visual Basic], On Error
- control flow [Visual Basic], branching
- Error keyword [Visual Basic]
- execution [Visual Basic], conditional
- Resume statement [Visual Basic], and On Error statement
- Error statement [Visual Basic], and On Error statement
- GoTo statement [Visual Basic], and On Error statement
- branching [Visual Basic], on error
- conditional statements [Visual Basic], On Error
- On Error statement [Visual Basic], syntax
- On keyword [Visual Basic]
- run-time errors [Visual Basic], handling
- On Error statement [Visual Basic]
ms.assetid: ff947930-fb84-40cf-bd66-1ea219561d5c
ms.openlocfilehash: 593e90b07101d08d18a0db127bcb74cf6509f317
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99768835"
---
# <a name="on-error-statement-visual-basic"></a>Оператор On Error (Visual Basic)

Включает подпрограммы обработки ошибок и задает расположение процедуры в процедуре. также может использоваться для отключения подпрограммы обработки ошибок. `On Error`Оператор используется в неструктурированной обработке ошибок и может использоваться вместо структурной обработки исключений. [Структурированная обработка исключений](../../../standard/exceptions/index.md) встроена в .NET, как правило, более эффективна и поэтому рекомендуется при обработке ошибок во время выполнения в приложении.

 Без обработки ошибок или обработки исключений любая возникающая ошибка времени выполнения является неустранимой: отображается сообщение об ошибке, и выполнение останавливается.

> [!NOTE]
> `Error`Ключевое слово также используется в [инструкции Error](error-statement.md), которая поддерживается для обеспечения обратной совместимости.

## <a name="syntax"></a>Синтаксис

```vb
On Error { GoTo [ line | 0 | -1 ] | Resume Next }
```

## <a name="parts"></a>Компоненты

|Термин|Определение|
|---|---|
|`GoTo`*строка*|Включает подпрограммы обработки ошибок, которая начинается в строке, указанной в аргументе обязательной *строки* . Аргумент *line* имеет любую метку или номер строки. Если возникает ошибка времени выполнения, Управление подразделениями выполняется до указанной строки, делая активным обработчик ошибок. Указанная строка должна находиться в той же процедуре, что `On Error` и инструкция, либо возникнет ошибка времени компиляции.|
|`GoTo 0`|Отключает включенный обработчик ошибок в текущей процедуре и сбрасывает его в `Nothing` .|
|`GoTo -1`|Отключает включенное исключение в текущей процедуре и сбрасывает его в `Nothing` .|
|`Resume Next`|Указывает, что при возникновении ошибки во время выполнения управление переходит к оператору, непосредственно следующему за оператором, где произошла ошибка, и выполнение продолжается с этой точки. Используйте эту форму вместо `On Error GoTo` доступа к объектам.|

## <a name="remarks"></a>Remarks

> [!NOTE]
> Рекомендуется использовать структурированную обработку исключений в коде, когда это возможно, а не использовать неструктурированную обработку исключений и `On Error` инструкцию. Дополнительные сведения см. в разделе [Оператор Try...Catch...Finally](try-catch-finally-statement.md).

 Обработчик ошибок с включенным параметром — это тот, который включен `On Error` оператором. "Активный" обработчик ошибок — это включенный обработчик, который находится в процессе обработки ошибки.

 Если ошибка возникает при активном обработчике ошибок (между возникновением ошибки и `Resume` `Exit Sub` `Exit Function` оператором,, или `Exit Property` ), обработчик ошибок текущей процедуры не может справиться с ошибкой. Управление возвращается вызывающей процедуре.
  
 Если вызывающая процедура имеет включенный обработчик ошибок, он активируется для обработки ошибки. Если обработчик ошибок вызывающей процедуры также активен, управление передается назад через предыдущие вызывающие процедуры до тех пор, пока не будет найден включенный, но неактивный обработчик ошибок. Если такой обработчик ошибок не найден, ошибка является неустранимой в той точке, где она фактически произошла.
  
 Каждый раз, когда обработчик ошибок передает управление в вызывающую процедуру, эта процедура преобразуется в текущую процедуру. После обработки ошибки обработчиком ошибок в любой процедуре выполнение возобновляется в текущей процедуре в точке, указанной в `Resume` инструкции.
  
> [!NOTE]
> Подпрограммы обработки ошибок не являются `Sub` процедурой или `Function` процедурой. Это раздел кода, помеченный меткой строки или номером строки.
  
## <a name="number-property"></a>Number, свойство

 Для определения причины ошибки подпрограммы обработки ошибок зависят от значения `Number` свойства `Err` объекта. Подпрограммы должны протестировать или сохранить релевантные значения свойств в `Err` объекте, прежде чем может возникнуть любая другая ошибка или пока не будет вызвана процедура, которая может вызвать ошибку. Значения свойств в `Err` объекте соответствуют только самой последней ошибке. Сообщение об ошибке, связанное с `Err.Number` , содержится в `Err.Description` .  
  
## <a name="throw-statement"></a>Оператор Throw  

 Ошибка, возникающая при использовании `Err.Raise` метода, задает `Exception` для свойства только что созданный экземпляр <xref:System.Exception> класса. Для поддержки вызова исключений производных типов исключений в `Throw` языке поддерживается инструкция. Это принимает единственный параметр, который является экземпляром исключения, который будет выдаваться. В следующем примере показано, как можно использовать эти функции с существующей поддержкой обработки исключений.

 [!code-vb[VbVbalrErrorHandling#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#17)]  
  
 Обратите внимание, что `On Error GoTo` оператор захватывает все ошибки независимо от класса исключений.
  
## <a name="on-error-resume-next"></a>При возникновении ошибки далее

 `On Error Resume Next` приводит к тому, что выполнение продолжается с оператора, непосредственно следующего за инструкцией, вызвавшей ошибку времени выполнения, или с инструкцией, сразу после последнего вызова процедуры, содержащей `On Error Resume Next` инструкцию. Эта инструкция позволяет продолжить выполнение, несмотря на ошибку времени выполнения. Можно поместить подпрограммы обработки ошибок, в которой возникает ошибка, а не передавать управление в другое место внутри процедуры. `On Error Resume Next`При вызове другой процедуры инструкция становится неактивной, поэтому следует выполнить `On Error Resume Next` инструкцию в каждой вызванной процедуре, если в этой процедуре требуется встроенная обработка ошибок.
  
> [!NOTE]
> `On Error Resume Next`Конструкция может быть предпочтительнее `On Error GoTo` при обработке ошибок, формируемых во время доступа к другим объектам. Проверка `Err` после каждого взаимодействия с объектом устраняет неоднозначность того, к какому объекту был получен доступ в коде. Можно убедиться, какой объект поместил код ошибки `Err.Number` , а также какой объект изначально сгенерировал ошибку (объект, указанный в `Err.Source` ).

## <a name="on-error-goto-0"></a>On Error GoTo 0

 `On Error GoTo 0` отключает обработку ошибок в текущей процедуре. В нем не указывается строка 0 в качестве начала кода обработки ошибок, даже если процедура содержит строку с номером 0. Без `On Error GoTo 0` оператора обработчик ошибок автоматически отключается при выходе из процедуры.

## <a name="on-error-goto--1"></a>On Error GoTo-1

 `On Error GoTo -1` отключает исключение в текущей процедуре. В нем не указывается строка-1 в качестве начала кода обработки ошибок, даже если процедура содержит строку с номером-1. Без `On Error GoTo -1` оператора исключение автоматически отключается при выходе из процедуры.

 Чтобы предотвратить выполнение кода обработки ошибок в случае отсутствия ошибок, поместите `Exit Sub` `Exit Function` оператор, или `Exit Property` непосредственно перед подпрограммой обработки ошибок, как в следующем фрагменте:

 [!code-vb[VbVbalrErrorHandling#18](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#18)]

 Здесь код обработки ошибок следует за `Exit Sub` оператором и предшествует `End Sub` оператору, чтобы отделить ее от потока процедур. Код обработки ошибок можно разместить в любом месте процедуры.

## <a name="untrapped-errors"></a>Неперехваченные ошибки

 Неперехваченные ошибки в объектах возвращаются в управляющее приложение, когда объект выполняется как исполняемый файл. В среде разработки неперехваченные ошибки возвращаются в управляющее приложение только в том случае, если установлены соответствующие параметры. Сведения о том, какие параметры должны быть установлены во время отладки, как их задать, а также определить, может ли узел создавать классы, см. документацию по ведущему приложению.

 При создании объекта, обращающегося к другим объектам, следует попытаться обрабатывать любые необработанные ошибки, которые они передают. Если вы не можете, сопоставьте коды ошибок `Err.Number` с одной из собственных ошибок, а затем передавайте их обратно вызывающему объекту. Необходимо указать ошибку, добавив код ошибки в `VbObjectError` константу. Например, если код ошибки — 1052, назначьте его следующим образом:

 [!code-vb[VbVbalrErrorHandling#19](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#19)]

> [!CAUTION]
> Системные ошибки во время вызовов библиотек динамической компоновки Windows (DLL) не вызывают исключений и не могут быть перехвачены при перехвате ошибок Visual Basic. При вызове функций DLL следует проверять каждое возвращаемое значение на успех или сбой (в соответствии со спецификациями API), а в случае сбоя проверить значение в `Err` `LastDLLError` свойстве объекта.

## <a name="example"></a>Пример

 В этом примере сначала используется `On Error GoTo` оператор, чтобы указать расположение подпрограммы обработки ошибок в процедуре. В этом примере попытка деления на ноль приводит к возникновению ошибки с номером 6. Ошибка обрабатывается в подпрограммы обработки ошибок, а затем Управление возвращается инструкции, вызвавшей ошибку. `On Error GoTo 0`Инструкция отключает перехват ошибок. Затем `On Error Resume Next` оператор используется для задержки перехвата ошибок таким образом, чтобы контекст для ошибки, создаваемой следующей инструкцией, мог быть известен для определенных. Обратите внимание, что `Err.Clear` используется для очистки `Err` свойств объекта после обработки ошибки.

 [!code-vb[VbVbalrErrorHandling#20](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrErrorHandling/VB/Class1.vb#20)]

## <a name="requirements"></a>Требования

 **Пространство имен:** [Microsoft. VisualBasic](../runtime-library-members.md)

 **Сборка:** Библиотека времени выполнения Visual Basic (в Microsoft.VisualBasic.dll)

## <a name="see-also"></a>См. также

- <xref:Microsoft.VisualBasic.Information.Err%2A>
- <xref:Microsoft.VisualBasic.ErrObject.Number%2A>
- <xref:Microsoft.VisualBasic.ErrObject.Description%2A>
- <xref:Microsoft.VisualBasic.ErrObject.LastDllError%2A>
- [End, инструкция](end-statement.md)
- [Оператор Exit](exit-statement.md)
- [Оператор Resume](resume-statement.md)
- [Сообщения об ошибках](../error-messages/index.md)
- [Оператор Try...Catch...Finally](try-catch-finally-statement.md)
