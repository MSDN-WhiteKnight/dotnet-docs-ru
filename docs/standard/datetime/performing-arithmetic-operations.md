---
description: 'Дополнительные сведения: выполнение арифметических операций с датами и временем'
title: Выполнение арифметических операций с датами и временем
ms.date: 04/10/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- times [.NET], arithmetic operations
- dates [.NET], arithmetic operations
- time zones [.NET], arithmetic operations
- arithmetic operations [.NET], dates and times
- dates [.NET], comparing
- DateTime structure, arithmetic operations
- DateTimeOffset structure, arithmetic operations
ms.assetid: 87c7ddf2-f15e-48af-8602-b3642237e6d0
ms.openlocfilehash: 7b39a6dec3abc2206c8eef7566f74aab6614aae6
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/06/2021
ms.locfileid: "99702565"
---
# <a name="performing-arithmetic-operations-with-dates-and-times"></a>Выполнение арифметических операций с датами и временем

Несмотря на то, <xref:System.DateTime> <xref:System.DateTimeOffset> что структуры и предоставляют члены, выполняющие арифметические операции с их значениями, результаты арифметических операций сильно отличаются. В этом разделе рассматриваются эти различия, приводятся сведения о них в степени осведомленности о часовых поясах в данных даты и времени, а также рассматривается выполнение операций с полной поддержкой часовых поясов с использованием данных даты и времени.

## <a name="comparisons-and-arithmetic-operations-with-datetime-values"></a>Сравнения и арифметические операции со значениями типа DateTime

<xref:System.DateTime.Kind%2A?displayProperty=nameWithType>Свойство позволяет <xref:System.DateTimeKind> назначить значение дате и времени, чтобы указать, представляет ли оно местное время, время в формате UTC или время в неопределенном часовом поясе. Однако эти ограниченные сведения о часовом поясе игнорируются при сравнении или выполнении арифметических операций с датами и временем для <xref:System.DateTimeKind> значений. Это демонстрируется в следующем примере, где текущее местное время сравнивается с текущим временем в формате UTC.

[!code-csharp[System.DateTimeOffset.Conceptual#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual2.cs#2)]
[!code-vb[System.DateTimeOffset.Conceptual#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual2.vb#2)]

Метод <xref:System.DateTime.CompareTo%28System.DateTime%29> показывает, что местное время раньше (меньше) времени в поясе UTC, а операция вычитания свидетельствует о том, что разница между временем в поясе UTC и местным временем для систем в тихоокеанском стандартном часовом поясе США составляет семь часов. Но поскольку эти два значения предоставляют различные представления одного момента времени, в этом случае ясно, что интервал времени полностью связан со смещением местного часового пояса от времени в формате UTC.

Более того, <xref:System.DateTime.Kind%2A?displayProperty=nameWithType> свойство не влияет на результаты, возвращаемые <xref:System.DateTime.Kind> методами сравнения и арифметическими операциями (так как сравнение двух идентичных точек во времени указывает), хотя это может повлиять на интерпретацию этих результатов. Пример:

- Результат выполнения любой арифметической операции с двумя значениями даты и времени, <xref:System.DateTime.Kind%2A?displayProperty=nameWithType> свойства которых равны значению <xref:System.DateTimeKind> фактического интервала времени между двумя значениями. Аналогичным образом результат сравнения двух таких значений даты и времени будет точно отражать соотношение между временами.

- Результат любой операции арифметического или сравнения, выполняемый с двумя значениями даты и времени, <xref:System.DateTime.Kind%2A?displayProperty=nameWithType> свойства которых равны <xref:System.DateTimeKind> или в двух значениях даты и времени с различными <xref:System.DateTime.Kind%2A?displayProperty=nameWithType> значениями свойств, отражает разницу в времени между двумя значениями.

- Арифметические операции или операции сравнения, выполняемые над местными значениями даты и времени, не учитывают допустимость или недопустимость конкретных значений; не учитывают они и какие-либо правила коррекции, необходимые при переводе местного часового пояса на зимнее или летнее время.

- В результат любой операции, сравнивающей или вычисляющей разницу между временем в формате UTC и местным временем, входит временной интервал, равный смещению местного часового пояса относительно времени в формате UTC.

- Любая операция, которая сравнивает или вычисляет разницу между неуказанным временем и временем в формате UTC или местным временем, соответствует простому времени. Различия между часовыми поясами не учитываются, и в результате не отражено применение правил коррекции часовых поясов.

- Любая операция, которая сравнивает или вычисляет разницу между двумя неуказанными значениями времени, может включать неизвестный интервал, который отражает временную разницу между двумя различными часовыми поясами.

Существует множество сценариев, в которых разницы часовых поясов не влияют на вычисления даты и времени (для некоторых из них см. раздел [Выбор между DateTime, DateTimeOffset, TimeSpan и TimeZoneInfo](choosing-between-datetime.md)) или, в контексте которого данные даты и времени определяют значение операций сравнения или арифметической операции.

## <a name="comparisons-and-arithmetic-operations-with-datetimeoffset-values"></a>Сравнения и арифметические операции со значениями DateTimeOffset

<xref:System.DateTimeOffset>Значение включает не только дату и время, но и смещение, которое однозначно определяет эту дату и время относительно времени в формате UTC. Это дает возможность определить равенство несколько иначе, чем для <xref:System.DateTimeOffset> значений. В то время как <xref:System.DateTime> значения равны, если они имеют одинаковые значения даты и времени, <xref:System.DateTimeOffset> значения равны, если они ссылаются на один и тот же момент времени. Это делает <xref:System.DateTimeOffset> значение более точным и меньшим при необходимости интерпретации при использовании в сравнениях и в большинстве арифметических операций, определяющих интервал между двумя датами и временем. В следующем примере, который является <xref:System.DateTimeOffset> аналогом предыдущего примера, сравниваемого с локальным и UTC- <xref:System.DateTimeOffset> значениями, показано различие в поведении.

[!code-csharp[System.DateTimeOffset.Conceptual#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual3.cs#3)]
[!code-vb[System.DateTimeOffset.Conceptual#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual3.vb#3)]

В этом примере <xref:System.DateTimeOffset.CompareTo%2A> метод указывает, что текущее местное время и текущее время в формате UTC равны, а вычитание <xref:System.DateTimeOffset.CompareTo(System.DateTimeOffset)> значений указывает, что разница между двумя значениями времени равна <xref:System.TimeSpan.Zero?displayProperty=nameWithType> .

Главным ограничением использования <xref:System.DateTimeOffset> значений в арифметических операциях с датами и временем является то, что хотя <xref:System.DateTimeOffset> значения имеют определенные Часовые пояса, они не поддерживают полную поддержку часовых поясов. Хотя <xref:System.DateTimeOffset> смещение значения отражает смещение часового пояса от времени в формате UTC, когда <xref:System.DateTimeOffset> переменной сначала присваивается значение, она становится несвязанной с часовым поясом впоследствии. Поскольку оно больше не связано напрямую с распознаваемым временем, правила коррекции часовых поясов больше не будут учитываться при сложении и вычитании интервалов даты и времени.

Для иллюстрации переход на летнее время в центральном стандартном часовом поясе США выполняется в 2:00 утра. 9 марта, 2008 г. Это означает, что при прибавлении двух с половиной часов к 1:30 утра 9 марта 2008 г. центрального стандартного времени США должно получиться 5:00 утра 9 марта, 2008 г. Однако, как показано в следующем примере, результатом сложения является 4:00 утра 9 марта, 2008 г. Обратите внимание, что результат этой операции представляет нужный момент времени, хотя это не время в часовом поясе, в котором мы заинтересованы (то есть у него нет ожидаемого смещения часового пояса).

[!code-csharp[System.DateTimeOffset.Conceptual#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual4.cs#4)]
[!code-vb[System.DateTimeOffset.Conceptual#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual4.vb#4)]

## <a name="arithmetic-operations-with-times-in-time-zones"></a>Арифметические операции со временем в часовых поясах

<xref:System.TimeZoneInfo>Класс включает ряд методов преобразования, которые автоматически применяют корректировки при преобразовании времени из одного часового пояса в другой. Вот некоторые из них.

- <xref:System.TimeZoneInfo.ConvertTime%2A>Методы и <xref:System.TimeZoneInfo.ConvertTimeBySystemTimeZoneId%2A> , которые преобразуют время между любыми двумя часовыми поясами.

- <xref:System.TimeZoneInfo.ConvertTimeFromUtc%2A>Методы и <xref:System.TimeZoneInfo.ConvertTimeToUtc%2A> , которые преобразуют время в определенном часовом поясе в формате UTC или преобразуют время в формате UTC в определенный часовой пояс.

Дополнительные сведения см. в разделе [Преобразование времени между часовыми поясами](converting-between-time-zones.md).

<xref:System.TimeZoneInfo>Класс не предоставляет методы, которые автоматически применяют правила коррекции при выполнении арифметических действий с датами и временем. Тем не менее, этого можно добиться, преобразовав время в часовом поясе во время в формате UTC, выполнив арифметическую операцию и преобразовав время UTC обратно во время в часовом поясе. Дополнительные сведения см. в разделе [как использовать Часовые пояса в арифметических действиях с датами и временем](use-time-zones-in-arithmetic.md).

Например, следующий код аналогичен предыдущему коду, в котором 2,5 часа добавлялись к 2:00 утра 9 марта, 2008 г. Тем не менее, поскольку в этом примере перед выполнением арифметических действий над датой и временем центральное стандартное время преобразуется во время в формате UTC, а затем результат преобразуется из времени UTC обратно в центральное стандартное время, полученное время соответствует переходу центрального стандартного часового пояса на летнее время.

[!code-csharp[System.DateTimeOffset.Conceptual#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/cs/Conceptual5.cs#5)]
[!code-vb[System.DateTimeOffset.Conceptual#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.DateTimeOffset.Conceptual/vb/Conceptual5.vb#5)]

## <a name="see-also"></a>См. также

- [Даты, время и часовые пояса](index.md)
- [Практическое руководство. Использование часовых поясов в арифметических операциях с датами и временем](use-time-zones-in-arithmetic.md)
